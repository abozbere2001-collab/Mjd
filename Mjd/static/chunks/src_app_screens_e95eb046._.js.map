{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/MatchesScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useMemo, useRef, useCallback } from 'react';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport type { ScreenProps } from '@/app/page';\nimport { format, addDays, subDays, isToday } from 'date-fns';\nimport { ar } from 'date-fns/locale';\nimport { useAdmin, useAuth, useFirestore } from '@/firebase/provider';\nimport { doc, onSnapshot, collection, getDocs, setDoc, deleteDoc } from 'firebase/firestore';\nimport { Loader2, Search, Star, Crown, ChevronLeft, ChevronRight } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { Button } from '@/components/ui/button';\nimport { SearchSheet, SearchableItem } from '@/components/SearchSheet';\nimport { ProfileButton } from '../AppContentWrapper';\nimport type { Fixture as FixtureType, Favorites, PredictionMatch } from '@/lib/types';\nimport { FixtureItem } from '@/components/FixtureItem';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\nimport { POPULAR_LEAGUES, POPULAR_TEAMS } from '@/lib/popular-data';\nimport { useToast } from '@/hooks/use-toast';\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport { PredictionOdds } from '@/components/PredictionOdds';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\ninterface GroupedFixtures {\n    [leagueName: string]: {\n        league: FixtureType['league'];\n        fixtures: FixtureType[];\n    }\n}\n\nconst popularLeagueIds = new Set(POPULAR_LEAGUES.slice(0, 15).map(l => l.id));\n\nconst FixturesList = React.memo((props: { \n    fixtures: FixtureType[], \n    loading: boolean,\n    hasAnyFavorites: boolean,\n    favoritedLeagueIds: number[],\n    favoritedTeamIds: number[],\n    navigate: ScreenProps['navigate'],\n    pinnedPredictionMatches: Set<number>,\n    onPinToggle: (fixture: FixtureType) => void,\n    isAdmin: boolean,\n    showOdds?: boolean,\n}) => {\n    \n    const { favoriteTeamMatches, otherFixtures } = useMemo(() => {\n        let favoriteTeamMatches: FixtureType[] = [];\n        let otherFixturesList: FixtureType[] = [];\n\n         if (props.hasAnyFavorites) {\n             props.fixtures.forEach(f => {\n                if (props.favoritedTeamIds.includes(f.teams.home.id) || props.favoritedTeamIds.includes(f.teams.away.id)) {\n                    favoriteTeamMatches.push(f);\n                } else if (props.favoritedLeagueIds.includes(f.league.id)) {\n                    otherFixturesList.push(f);\n                }\n            });\n        } else {\n             // If no favorites, show popular leagues only\n            otherFixturesList = props.fixtures.filter(f => popularLeagueIds.has(f.league.id));\n        }\n\n        return { favoriteTeamMatches, otherFixtures: otherFixturesList };\n\n    }, [props.fixtures, props.favoritedTeamIds, props.favoritedLeagueIds, props.hasAnyFavorites]);\n\n\n    const groupedOtherFixtures = useMemo(() => {\n        return otherFixtures.reduce((acc, fixture) => {\n            const leagueName = fixture.league.name;\n            if (!acc[leagueName]) {\n                acc[leagueName] = { league: fixture.league, fixtures: [] };\n            }\n            acc[leagueName].fixtures.push(fixture);\n            return acc;\n        }, {} as GroupedFixtures);\n    }, [otherFixtures]);\n\n\n    if (props.loading) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n        );\n    }\n    \n    const totalFixturesToShow = favoriteTeamMatches.length + otherFixtures.length;\n\n    if (totalFixturesToShow === 0) {\n        const message = props.hasAnyFavorites ? \"لا توجد مباريات لمفضلاتك في هذا اليوم.\" : \"لا توجد مباريات لهذا اليوم.\";\n        return (\n            <div className=\"flex flex-col items-center justify-center text-center text-muted-foreground h-64 p-4\">\n                <p>{message}</p>\n                <Button className=\"mt-4\" onClick={() => props.navigate('AllCompetitions')}>استكشف البطولات</Button>\n            </div>\n        );\n    }\n    \n    const sortedLeagues = Object.keys(groupedOtherFixtures).sort((a,b) => a.localeCompare(b));\n\n    return (\n        <div className=\"space-y-4\">\n            {favoriteTeamMatches.length > 0 && (\n                 <div>\n                    <div className=\"font-semibold text-foreground py-1 px-3 rounded-md bg-card border flex items-center gap-2 text-xs h-6\">\n                        <Star className=\"h-4 w-4 text-yellow-400\" />\n                        <span className=\"truncate\">مباريات فرقك المفضلة</span>\n                    </div>\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1 pt-1\">\n                        {favoriteTeamMatches.map(f => (\n                            <FixtureItem \n                                key={f.fixture.id} \n                                fixture={f} \n                                navigate={props.navigate}\n                                isPinnedForPrediction={props.pinnedPredictionMatches.has(f.fixture.id)}\n                                onPinToggle={props.onPinToggle}\n                                isAdmin={props.isAdmin}\n                                showOdds={props.showOdds}\n                            />\n                        ))}\n                    </div>\n                </div>\n            )}\n\n            {sortedLeagues.map(leagueName => {\n                const { league, fixtures: leagueFixtures } = groupedOtherFixtures[leagueName];\n                return (\n                    <div key={`${league.id}-${league.name}`}>\n                       <div className=\"font-semibold text-foreground py-1 px-3 rounded-md bg-card border flex items-center gap-2 text-xs h-6 cursor-pointer\" onClick={() => props.navigate('CompetitionDetails', { leagueId: league.id, title: league.name, logo: league.logo })}>\n                           <Avatar className=\"h-4 w-4\"><AvatarImage src={league.logo} alt={league.name} /></Avatar>\n                           <span className=\"truncate\">{league.name}</span>\n                       </div>\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-1 pt-1\">\n                            {leagueFixtures.map(f => (\n                                <FixtureItem \n                                    key={f.fixture.id} \n                                    fixture={f} \n                                    navigate={props.navigate}\n                                    isPinnedForPrediction={props.pinnedPredictionMatches.has(f.fixture.id)}\n                                    onPinToggle={props.onPinToggle}\n                                    isAdmin={props.isAdmin}\n                                    showOdds={props.showOdds}\n                                />\n                            ))}\n                        </div>\n                    </div>\n                )\n            })}\n        </div>\n    );\n});\nFixturesList.displayName = 'FixturesList';\n\n\nconst formatDateKey = (date: Date): string => format(date, 'yyyy-MM-dd');\n\nconst getDayLabel = (date: Date) => {\n    if (isToday(date)) return \"اليوم\";\n    return format(date, \"EEEE\", { locale: ar });\n};\n\nconst DateScroller = ({ selectedDateKey, onDateSelect }: {selectedDateKey: string, onDateSelect: (dateKey: string) => void}) => {\n    const dates = useMemo(() => {\n        const today = new Date();\n        const days = [];\n        for (let i = -365; i <= 365; i++) {\n            days.push(addDays(today, i));\n        }\n        return days;\n    }, []);\n    \n    const scrollerRef = useRef<HTMLDivElement>(null);\n    const selectedButtonRef = useRef<HTMLButtonElement>(null);\n\n    useEffect(() => {\n        const scroller = scrollerRef.current;\n        const selectedButton = selectedButtonRef.current;\n        \n        const centerOnSelected = () => {\n            if (scroller && selectedButton) {\n                const scrollerRect = scroller.getBoundingClientRect();\n                const buttonRect = selectedButton.getBoundingClientRect();\n                const scrollOffset = buttonRect.left - scrollerRect.left - (scrollerRect.width / 2) + (buttonRect.width / 2);\n                scroller.scrollTo({ left: scroller.scrollLeft + scrollOffset, behavior: 'smooth' });\n            }\n        };\n        setTimeout(centerOnSelected, 100);\n    }, [selectedDateKey]);\n    \n    const selectedDayName = getDayLabel(new Date(selectedDateKey));\n\n    return (\n        <div className=\"relative bg-card py-2 border-x border-b rounded-b-lg shadow-md flex flex-col items-center\">\n            <h3 className=\"text-sm font-semibold mb-2 text-center text-primary\">{selectedDayName}</h3>\n            <div className=\"flex items-center w-full px-1\">\n                <Button \n                    variant=\"ghost\" \n                    size=\"icon\"\n                    className=\"h-9 w-9 z-10 flex-shrink-0\"\n                    onClick={() => onDateSelect(formatDateKey(subDays(new Date(selectedDateKey), 1)))}\n                >\n                    <ChevronRight className=\"h-5 w-5\" />\n                </Button>\n                <ScrollArea ref={scrollerRef} className=\"w-full whitespace-nowrap mx-1\">\n                    <div className=\"flex flex-row-reverse justify-start items-center h-9\">\n                        {dates.map(date => {\n                            const dateKey = formatDateKey(date);\n                            const isSelected = dateKey === selectedDateKey;\n\n                            return (\n                                <button\n                                    key={dateKey}\n                                    ref={isSelected ? selectedButtonRef : null}\n                                    className={cn(\n                                        \"relative flex items-center justify-center h-8 w-8 rounded-full transition-colors ml-2 flex-shrink-0\",\n                                        \"text-foreground/80 hover:text-primary\",\n                                        isSelected && \"bg-primary text-primary-foreground\"\n                                    )}\n                                    onClick={() => onDateSelect(dateKey)}\n                                >\n                                    <span className=\"font-semibold text-sm\">{format(date, 'd')}</span>\n                                </button>\n                            )\n                        })}\n                    </div>\n                    <ScrollBar orientation=\"horizontal\" className=\"h-0\" />\n                </ScrollArea>\n                <Button \n                    variant=\"ghost\" \n                    size=\"icon\"\n                    className=\"h-9 w-9 z-10 flex-shrink-0\"\n                    onClick={() => onDateSelect(formatDateKey(addDays(new Date(selectedDateKey), 1)))}\n                >\n                    <ChevronLeft className=\"h-5 w-5\" />\n                </Button>\n            </div>\n        </div>\n    );\n}\n\n// Main Screen Component\nexport function MatchesScreen({ navigate, goBack, canGoBack, isVisible, favorites, customNames, setFavorites, onCustomNameChange }: ScreenProps & { isVisible: boolean, setFavorites: React.Dispatch<React.SetStateAction<Partial<Favorites>>>, onCustomNameChange: () => Promise<void> }) {\n  const { user } = useAuth();\n  const { db, isAdmin } = useAdmin();\n  const { toast } = useToast();\n  const [showOdds, setShowOdds] = useState(false);\n  \n  const [selectedDateKey, setSelectedDateKey] = useState<string>(formatDateKey(new Date()));\n  \n  const [matchesCache, setMatchesCache] = useState<Map<string, FixtureType[]>>(new Map());\n  const [loading, setLoading] = useState(true);\n    \n  const [pinnedPredictionMatches, setPinnedPredictionMatches] = useState(new Set<number>());\n\n  useEffect(() => {\n    if (!db || !isAdmin) return;\n    const q = collection(db, \"predictionFixtures\");\n    const unsub = onSnapshot(q, (snapshot) => {\n        const newPinnedSet = new Set<number>();\n        snapshot.forEach(doc => newPinnedSet.add(Number(doc.id)));\n        setPinnedPredictionMatches(newPinnedSet);\n    }, (error) => {\n        console.error(\"Permission error listening to predictions:\", error);\n    });\n    return () => unsub();\n  }, [db, isAdmin]);\n\n  const getDisplayName = useCallback((type: 'team' | 'league', id: number, defaultName: string) => {\n    if (!customNames) return defaultName;\n    const firestoreMap = type === 'team' ? customNames?.teams : customNames?.leagues;\n    const customName = firestoreMap?.get(id);\n    if (customName) return customName;\n\n    const hardcodedMap = type === 'team' ? hardcodedTranslations.teams : hardcodedTranslations.leagues;\n    const hardcodedName = hardcodedMap[id as any];\n    if(hardcodedName) return hardcodedName;\n\n    return defaultName;\n}, [customNames]);\n\n\n  const handlePinToggle = useCallback((fixture: FixtureType) => {\n    if (!db) return;\n    const fixtureId = fixture.fixture.id;\n    const isPinned = pinnedPredictionMatches.has(fixtureId);\n    const docRef = doc(db, 'predictionFixtures', String(fixtureId));\n\n    if (isPinned) {\n        deleteDoc(docRef).then(() => {\n            toast({ title: \"تم إلغاء التثبيت\", description: \"تمت إزالة المباراة من التوقعات.\" });\n        }).catch(err => {\n            errorEmitter.emit('permission-error', new FirestorePermissionError({ path: docRef.path, operation: 'delete' }));\n        });\n    } else {\n        const data: PredictionMatch = { fixtureData: fixture };\n        setDoc(docRef, data).then(() => {\n            toast({ title: \"تم التثبيت\", description: \"أصبحت المباراة متاحة الآن للتوقع.\" });\n        }).catch(err => {\n            errorEmitter.emit('permission-error', new FirestorePermissionError({ path: docRef.path, operation: 'create', requestResourceData: data }));\n        });\n    }\n  }, [db, pinnedPredictionMatches, toast]);\n\n    const fetchAndProcessData = useCallback(async (dateKey: string, abortSignal: AbortSignal) => {\n        setLoading(true);\n\n        try {\n             const res = await fetch(`https://${API_FOOTBALL_HOST}/fixtures?date=${dateKey}`, {\n                signal: abortSignal,\n                headers: {\n                    'x-rapidapi-host': API_FOOTBALL_HOST,\n                    'x-rapidapi-key': API_KEY || '',\n                },\n            });\n            if (!res.ok) throw new Error(`API fetch failed with status ${res.status}`);\n            \n            const data = await res.json();\n            if (abortSignal.aborted) return;\n            \n            const allFixturesToday: FixtureType[] = data.response || [];\n            \n            const processedFixtures = allFixturesToday.map(fixture => ({\n                ...fixture,\n                league: { ...fixture.league, name: getDisplayName('league', fixture.league.id, fixture.league.name) },\n                teams: {\n                    home: { ...fixture.teams.home, name: getDisplayName('team', fixture.teams.home.id, fixture.teams.home.name) },\n                    away: { ...fixture.teams.away, name: getDisplayName('team', fixture.teams.away.id, fixture.teams.away.name) }\n                }\n            }));\n            \n            setMatchesCache(prev => new Map(prev).set(dateKey, processedFixtures));\n\n        } catch (error: any) {\n            if (error.name !== 'AbortError') {\n                console.error(`Failed to fetch data for ${dateKey}:`, error);\n                setMatchesCache(prev => new Map(prev).set(dateKey, [])); // Cache empty array on error\n            }\n        } finally {\n            if (!abortSignal.aborted) setLoading(false);\n        }\n    }, [getDisplayName]);\n\n    const updateLiveData = useCallback(async (dateKey: string, abortSignal: AbortSignal) => {\n        const cachedFixtures = matchesCache.get(dateKey);\n        if (!cachedFixtures) return;\n\n        const liveFixtureIds = cachedFixtures\n            .filter(f => f.fixture.status.short !== 'FT' && f.fixture.status.short !== 'PST' && f.fixture.status.short !== 'CANC')\n            .map(f => f.fixture.id);\n\n        if (liveFixtureIds.length === 0) return;\n        \n        try {\n            const res = await fetch(`https://${API_FOOTBALL_HOST}/fixtures?ids=${liveFixtureIds.join('-')}`, {\n                signal: abortSignal,\n                headers: {\n                    'x-rapidapi-host': API_FOOTBALL_HOST,\n                    'x-rapidapi-key': API_KEY || '',\n                },\n            });\n            if (!res.ok) return;\n\n            const data = await res.json();\n            if (abortSignal.aborted || !data.response) return;\n\n            const updatedFixturesMap = new Map(data.response.map((f: FixtureType) => [f.fixture.id, f]));\n            \n            const newFixtures = cachedFixtures.map(oldFixture => {\n                const updatedFixture = updatedFixturesMap.get(oldFixture.fixture.id);\n                return updatedFixture ? {\n                    ...updatedFixture,\n                    league: { ...updatedFixture.league, name: getDisplayName('league', updatedFixture.league.id, updatedFixture.league.name) },\n                    teams: {\n                        home: { ...updatedFixture.teams.home, name: getDisplayName('team', updatedFixture.teams.home.id, updatedFixture.teams.home.name) },\n                        away: { ...updatedFixture.teams.away, name: getDisplayName('team', updatedFixture.teams.away.id, updatedFixture.teams.away.name) }\n                    }\n                } : oldFixture;\n            });\n            \n            setMatchesCache(prev => new Map(prev).set(dateKey, newFixtures));\n\n        } catch (error: any) {\n            if (error.name !== 'AbortError') console.error(\"Live update failed:\", error);\n        }\n\n    }, [matchesCache, getDisplayName]);\n\n  \n  useEffect(() => {\n      if (!isVisible || !customNames) return;\n\n      const controller = new AbortController();\n      \n      if (!matchesCache.has(selectedDateKey)) {\n          fetchAndProcessData(selectedDateKey, controller.signal);\n      } else {\n          setLoading(false);\n      }\n      \n      const interval = setInterval(() => {\n          if (document.visibilityState === 'visible') {\n            updateLiveData(selectedDateKey, controller.signal);\n          }\n      }, 60000);\n\n      return () => {\n          controller.abort();\n          clearInterval(interval);\n      };\n\n  }, [selectedDateKey, isVisible, customNames, matchesCache, fetchAndProcessData, updateLiveData]);\n\n\n  const handleDateChange = (dateKey: string) => {\n      setSelectedDateKey(dateKey);\n  };\n  \n  const favoritedTeamIds = useMemo(() => (favorites && favorites.teams) ? Object.keys(favorites.teams).map(Number) : [], [favorites]);\n  const favoritedLeagueIds = useMemo(() => (favorites && favorites.leagues) ? Object.keys(favorites.leagues).map(Number) : [], [favorites]);\n  const hasAnyFavorites = favoritedLeagueIds.length > 0 || favoritedTeamIds.length > 0;\n  \n  const allFixturesForDay = matchesCache.get(selectedDateKey) || [];\n\n    const popularItemsForSearch = useMemo((): SearchableItem[] => {\n        if (!customNames) return [];\n        const seen = new Set<string>();\n        \n        return [...POPULAR_TEAMS, ...POPULAR_LEAGUES].map(item => {\n            const type = 'national' in item || 'type' in item ? 'teams' : 'leagues';\n            const key = `${type}-${item.id}`;\n            if (seen.has(key)) return null;\n            seen.add(key);\n    \n            return {\n                id: item.id,\n                type: type as 'teams' | 'leagues',\n                name: getDisplayName(type.slice(0, -1) as 'team' | 'league', item.id, item.name),\n                originalName: item.name,\n                logo: item.logo,\n                originalItem: item as any,\n            };\n        }).filter(Boolean) as SearchableItem[];\n    }, [customNames, getDisplayName]);\n    \n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n        <ScreenHeader \n            title=\"\" \n            canGoBack={false}\n            onBack={() => {}} \n            actions={\n               <div className=\"flex items-center gap-0.5\">\n                  <div\n                    onClick={() => setShowOdds(prev => !prev)}\n                    className={cn(\"flex items-center justify-center h-7 w-7 rounded-md cursor-pointer\", showOdds ? 'bg-accent' : 'hover:bg-accent/50')}\n                  >\n                    <span className=\"text-xs font-mono select-none\">1x2</span>\n                  </div>\n                  <SearchSheet navigate={navigate} favorites={favorites} customNames={customNames} setFavorites={setFavorites} onCustomNameChange={onCustomNameChange} popularItems={popularItemsForSearch}>\n                      <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\">\n                          <Search className=\"h-5 w-5\" />\n                      </Button>\n                  </SearchSheet>\n                  <ProfileButton />\n              </div>\n            }\n        />\n        \n        <div className=\"flex flex-1 flex-col min-h-0\">\n             <div className=\"sticky top-0 z-10 px-1 pt-1 bg-background\">\n                 <DateScroller selectedDateKey={selectedDateKey} onDateSelect={handleDateChange} />\n            </div>\n            \n            <div className=\"flex-1 overflow-y-auto p-1 space-y-4 mt-2\">\n                <FixturesList \n                    fixtures={allFixturesForDay}\n                    loading={loading}\n                    favoritedLeagueIds={favoritedLeagueIds}\n                    favoritedTeamIds={favoritedTeamIds}\n                    hasAnyFavorites={hasAnyFavorites}\n                    navigate={navigate}\n                    pinnedPredictionMatches={pinnedPredictionMatches}\n                    onPinToggle={handlePinToggle}\n                    isAdmin={isAdmin}\n                    showOdds={showOdds}\n                />\n            </div>\n\n        </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 873, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/CompetitionsScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useMemo, useCallback } from 'react';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Star, Plus, Users, Trophy, User as PlayerIcon, Search } from 'lucide-react';\nimport type { ScreenProps } from '@/app/page';\nimport { Button } from '@/components/ui/button';\nimport { useAuth, useFirestore } from '@/firebase/provider';\nimport type { Favorites } from '@/lib/types';\nimport { SearchSheet, SearchableItem } from '@/components/SearchSheet';\nimport { ProfileButton } from '../AppContentWrapper';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { ScrollArea, ScrollBar } from '@/components/ui/scroll-area';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\nimport { POPULAR_LEAGUES, POPULAR_TEAMS } from '@/lib/popular-data';\n\n// --- MAIN SCREEN COMPONENT ---\nexport function CompetitionsScreen({ navigate, goBack, canGoBack, favorites, customNames, setFavorites }: ScreenProps & {setFavorites: (favorites: Partial<Favorites>) => void}) {\n    const { user } = useAuth();\n    \n     const getDisplayName = useCallback((type: 'league' | 'team', id: number, defaultName: string) => {\n        if (!customNames) return defaultName;\n        const key = `${type}s` as 'leagues' | 'teams';\n        const map = customNames[key] as Map<number, string>;\n        const customName = map?.get(id);\n        if (customName) return customName;\n\n        const hardcodedMap = hardcodedTranslations[key];\n        const hardcodedName = hardcodedMap[id as any];\n        if (hardcodedName) return hardcodedName;\n\n        return defaultName;\n    }, [customNames]);\n\n\n    const favoriteTeams = useMemo(() => {\n      if (!favorites?.teams || !customNames) return [];\n      return Object.values(favorites.teams).map(team => ({\n        ...team,\n        name: getDisplayName('team', team.teamId, team.name)\n      }));\n    }, [favorites.teams, customNames, getDisplayName]);\n\n    const favoriteLeagues = useMemo(() => {\n        if (!favorites?.leagues || !customNames) return [];\n        return Object.values(favorites.leagues).map(comp => ({\n            ...comp,\n            name: getDisplayName('league', comp.leagueId, comp.name)\n        }));\n    }, [favorites.leagues, customNames, getDisplayName]);\n\n    const favoritePlayers = useMemo(() => favorites?.players ? Object.values(favorites.players) : [], [favorites.players]);\n    \n    const handleLoginClick = () => {\n        if ((window as any).appNavigate) {\n            (window as any).appNavigate('Welcome');\n        }\n    }\n    \n    const popularItemsForSearch = useMemo((): SearchableItem[] => {\n        if (!customNames) return [];\n        const seen = new Set<string>();\n        \n        return [...POPULAR_TEAMS, ...POPULAR_LEAGUES].map(item => {\n            const type = 'national' in item || 'type' in item ? 'teams' : 'leagues';\n            const key = `${type}-${item.id}`;\n            if (seen.has(key)) return null;\n            seen.add(key);\n    \n            return {\n                id: item.id,\n                type: type as 'teams' | 'leagues',\n                name: getDisplayName(type.slice(0, -1) as 'team' | 'league', item.id, item.name),\n                originalName: item.name,\n                logo: item.logo,\n                originalItem: item as any,\n            };\n        }).filter(Boolean) as SearchableItem[];\n    }, [customNames, getDisplayName]);\n\n    if (!favorites || !customNames) {\n        // You can return a loading spinner here if you want\n        return null;\n    }\n\n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n             <ScreenHeader \n                title={\"اختياراتي\"} \n                onBack={goBack} \n                canGoBack={canGoBack} \n                actions={\n                  <div className=\"flex items-center gap-1\">\n                      <SearchSheet navigate={navigate} favorites={favorites} customNames={customNames} setFavorites={setFavorites} popularItems={popularItemsForSearch}>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\">\n                              <Search className=\"h-5 w-5\" />\n                          </Button>\n                      </SearchSheet>\n                      <ProfileButton />\n                  </div>\n                }\n            />\n            <div className=\"flex-1 flex flex-col min-h-0\">\n                <div className=\"flex-1 overflow-y-auto\">\n                     <div className=\"space-y-6 py-4\">\n                        <ScrollArea className=\"w-full whitespace-nowrap\">\n                            <div className=\"flex w-max space-x-4 px-4 flex-row-reverse\">\n                                 <div className=\"flex flex-col items-center gap-2 w-20 h-[84px] text-center\">\n                                      <SearchSheet navigate={navigate} initialItemType=\"teams\" favorites={favorites} customNames={customNames} setFavorites={setFavorites} popularItems={popularItemsForSearch}>\n                                        <div className=\"flex flex-col items-center justify-center h-14 w-14 bg-card rounded-full cursor-pointer hover:bg-accent/50 transition-colors\">\n                                            <Plus className=\"h-6 w-6 text-primary\" />\n                                        </div>\n                                      </SearchSheet>\n                                      <span className=\"text-xs font-medium truncate w-full text-primary\">أضف</span>\n                                </div>\n                                {favoriteTeams.map((team, index) => (\n                                    <div key={`${team.teamId}-${index}`} className=\"relative flex flex-col items-center gap-2 w-20 text-center cursor-pointer\" onClick={() => navigate('TeamDetails', { teamId: team.teamId })}>\n                                        <Avatar className=\"h-14 w-14 border-2 border-border\">\n                                            <AvatarImage src={team.logo} />\n                                            <AvatarFallback>{team.name.charAt(0)}</AvatarFallback>\n                                        </Avatar>\n                                        <span className=\"text-xs font-medium truncate w-full\">{team.name}</span>\n                                        <Star className=\"absolute top-0 right-0 h-4 w-4 text-yellow-400 fill-current\" />\n                                    </div>\n                                ))}\n                            </div>\n                            <ScrollBar orientation=\"horizontal\" className=\"h-1.5 mt-2\" />\n                        </ScrollArea>\n\n                        <Tabs defaultValue=\"teams\" className=\"w-full px-1\">\n                             <div className=\"bg-card text-card-foreground rounded-b-lg border-x border-b shadow-md\">\n                                <TabsList className=\"grid w-full grid-cols-3 bg-transparent h-11 p-0\">\n                                    <TabsTrigger value=\"players\" className=\"data-[state=active]:shadow-none\"><PlayerIcon className=\"ml-1 h-4 w-4\"/>اللاعبين</TabsTrigger>\n                                    <TabsTrigger value=\"competitions\" className=\"data-[state=active]:shadow-none\"><Trophy className=\"ml-1 h-4 w-4\"/>البطولات</TabsTrigger>\n                                    <TabsTrigger value=\"teams\" className=\"data-[state=active]:shadow-none\"><Users className=\"ml-1 h-4 w-4\"/>الفرق</TabsTrigger>\n                                </TabsList>\n                            </div>\n                            \n                            <TabsContent value=\"teams\" className=\"mt-4 px-3\">\n                                <div className=\"grid grid-cols-4 gap-4\">\n                                     <div className=\"h-[76px] w-full\">\n                                         <SearchSheet navigate={navigate} initialItemType=\"teams\" favorites={favorites} customNames={customNames} setFavorites={setFavorites} popularItems={popularItemsForSearch}>\n                                            <div className=\"flex flex-col items-center justify-center gap-2 text-center p-2 rounded-2xl border-2 border-dashed border-muted-foreground/50 h-full w-full cursor-pointer hover:bg-accent/50 transition-colors\">\n                                                <div className=\"flex items-center justify-center h-10 w-10 bg-primary/10 rounded-full\">\n                                                    <Plus className=\"h-6 w-6 text-primary\" />\n                                                </div>\n                                            </div>\n                                         </SearchSheet>\n                                    </div>\n                                    {favoriteTeams.map((team, index) => \n                                        <div key={`${team.teamId}-${index}`} className=\"relative flex flex-col items-center justify-start gap-1 text-center cursor-pointer h-[76px]\" onClick={() => navigate('TeamDetails', { teamId: team.teamId })}>\n                                            <Avatar className=\"h-12 w-12 border-2 border-border\">\n                                                <AvatarImage src={team.logo} />\n                                                <AvatarFallback>{team.name.charAt(0)}</AvatarFallback>\n                                            </Avatar>\n                                            <span className=\"text-[11px] font-medium truncate w-full\">{team.name}</span>\n                                            <Star className=\"absolute top-1 right-1 h-3 w-3 text-yellow-400 fill-current\" />\n                                        </div>\n                                    )}\n                                </div>\n                            </TabsContent>\n                            \n                            <TabsContent value=\"competitions\" className=\"mt-4 px-3\">\n                                <div className=\"grid grid-cols-4 gap-4\">\n                                    <div className=\"h-[76px] w-full\">\n                                        <SearchSheet navigate={navigate} initialItemType=\"leagues\" favorites={favorites} customNames={customNames} setFavorites={setFavorites} popularItems={popularItemsForSearch}>\n                                            <div className=\"flex flex-col items-center justify-center gap-2 text-center p-2 rounded-2xl border-2 border-dashed border-muted-foreground/50 h-full w-full cursor-pointer hover:bg-accent/50 transition-colors\">\n                                                <div className=\"flex items-center justify-center h-10 w-10 bg-primary/10 rounded-full\">\n                                                    <Plus className=\"h-6 w-6 text-primary\" />\n                                                </div>\n                                            </div>\n                                        </SearchSheet>\n                                    </div>\n                                    {favoriteLeagues.map((comp, index) => \n                                        <div key={`${comp.leagueId}-${index}`} className=\"relative flex flex-col items-center justify-start gap-1 text-center cursor-pointer h-[76px]\" onClick={() => navigate('CompetitionDetails', { title: comp.name, leagueId: comp.leagueId, logo: comp.logo })}>\n                                            <Avatar className=\"h-12 w-12 border-2 border-border p-1\">\n                                                <AvatarImage src={comp.logo} className=\"object-contain\" />\n                                                <AvatarFallback>{comp.name.charAt(0)}</AvatarFallback>\n                                            </Avatar>\n                                             <span className=\"text-[11px] font-medium truncate w-full\">{comp.name}</span>\n                                            <Star className=\"absolute top-1 right-1 h-3 w-3 text-yellow-400 fill-current\" />\n                                        </div>\n                                    )}\n                                </div>\n                            </TabsContent>\n\n                            <TabsContent value=\"players\" className=\"mt-4 px-3\">\n                                <div className=\"grid grid-cols-4 gap-4\">\n                                     <div className=\"h-[76px] w-full\">\n                                        <SearchSheet navigate={navigate} initialItemType=\"teams\" favorites={favorites} customNames={customNames} setFavorites={setFavorites} popularItems={popularItemsForSearch}>\n                                            <div className=\"flex flex-col items-center justify-center gap-2 text-center p-2 rounded-2xl border-2 border-dashed border-muted-foreground/50 h-full w-full cursor-pointer hover:bg-accent/50 transition-colors\">\n                                                <div className=\"flex items-center justify-center h-10 w-10 bg-primary/10 rounded-full\">\n                                                    <Plus className=\"h-6 w-6 text-primary\" />\n                                                </div>\n                                            </div>\n                                        </SearchSheet>\n                                     </div>\n                                     <div className=\"h-[76px] w-full col-span-3 flex items-center justify-center\">\n                                        <p className=\"text-muted-foreground text-center text-sm\">قائمة اللاعبين المفضلين قيد التطوير.</p>\n                                     </div>\n                                </div>\n                            </TabsContent>\n                        </Tabs>\n                         {user && user.isAnonymous && (\n                            <div className=\"px-4 pt-4 text-center\">\n                                 <p className=\"text-sm text-muted-foreground mb-4\">للحفاظ على مفضلاتك ومزامنتها عبر الأجهزة، قم بإنشاء حساب دائم.</p>\n                                <Button onClick={handleLoginClick} className=\"w-full max-w-sm mx-auto\">تسجيل الدخول أو إنشاء حساب</Button>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAfA;;;;;;;;;;;;;AAkBO,SAAS,mBAAmB,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,WAAW,EAAE,YAAY,EAAyE;;IAC3K,MAAM,EAAE,IAAI,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAEtB,MAAM,iBAAiB,CAAA,GAAA,6JAAA,CAAA,cAAW,AAAD;0DAAE,CAAC,MAAyB,IAAY;YACtE,IAAI,CAAC,aAAa,OAAO;YACzB,MAAM,MAAM,GAAG,KAAK,CAAC,CAAC;YACtB,MAAM,MAAM,WAAW,CAAC,IAAI;YAC5B,MAAM,aAAa,KAAK,IAAI;YAC5B,IAAI,YAAY,OAAO;YAEvB,MAAM,eAAe,0IAAA,CAAA,wBAAqB,CAAC,IAAI;YAC/C,MAAM,gBAAgB,YAAY,CAAC,GAAU;YAC7C,IAAI,eAAe,OAAO;YAE1B,OAAO;QACX;yDAAG;QAAC;KAAY;IAGhB,MAAM,gBAAgB,CAAA,GAAA,6JAAA,CAAA,UAAO,AAAD;qDAAE;YAC5B,IAAI,CAAC,WAAW,SAAS,CAAC,aAAa,OAAO,EAAE;YAChD,OAAO,OAAO,MAAM,CAAC,UAAU,KAAK,EAAE,GAAG;6DAAC,CAAA,OAAQ,CAAC;wBACjD,GAAG,IAAI;wBACP,MAAM,eAAe,QAAQ,KAAK,MAAM,EAAE,KAAK,IAAI;oBACrD,CAAC;;QACH;oDAAG;QAAC,UAAU,KAAK;QAAE;QAAa;KAAe;IAEjD,MAAM,kBAAkB,CAAA,GAAA,6JAAA,CAAA,UAAO,AAAD;uDAAE;YAC5B,IAAI,CAAC,WAAW,WAAW,CAAC,aAAa,OAAO,EAAE;YAClD,OAAO,OAAO,MAAM,CAAC,UAAU,OAAO,EAAE,GAAG;+DAAC,CAAA,OAAQ,CAAC;wBACjD,GAAG,IAAI;wBACP,MAAM,eAAe,UAAU,KAAK,QAAQ,EAAE,KAAK,IAAI;oBAC3D,CAAC;;QACL;sDAAG;QAAC,UAAU,OAAO;QAAE;QAAa;KAAe;IAEnD,MAAM,kBAAkB,CAAA,GAAA,6JAAA,CAAA,UAAO,AAAD;uDAAE,IAAM,WAAW,UAAU,OAAO,MAAM,CAAC,UAAU,OAAO,IAAI,EAAE;sDAAE;QAAC,UAAU,OAAO;KAAC;IAErH,MAAM,mBAAmB;QACrB,IAAI,AAAC,OAAe,WAAW,EAAE;YAC5B,OAAe,WAAW,CAAC;QAChC;IACJ;IAEA,MAAM,wBAAwB,CAAA,GAAA,6JAAA,CAAA,UAAO,AAAD;6DAAE;YAClC,IAAI,CAAC,aAAa,OAAO,EAAE;YAC3B,MAAM,OAAO,IAAI;YAEjB,OAAO;mBAAI,gIAAA,CAAA,gBAAa;mBAAK,gIAAA,CAAA,kBAAe;aAAC,CAAC,GAAG;qEAAC,CAAA;oBAC9C,MAAM,OAAO,cAAc,QAAQ,UAAU,OAAO,UAAU;oBAC9D,MAAM,MAAM,GAAG,KAAK,CAAC,EAAE,KAAK,EAAE,EAAE;oBAChC,IAAI,KAAK,GAAG,CAAC,MAAM,OAAO;oBAC1B,KAAK,GAAG,CAAC;oBAET,OAAO;wBACH,IAAI,KAAK,EAAE;wBACX,MAAM;wBACN,MAAM,eAAe,KAAK,KAAK,CAAC,GAAG,CAAC,IAAyB,KAAK,EAAE,EAAE,KAAK,IAAI;wBAC/E,cAAc,KAAK,IAAI;wBACvB,MAAM,KAAK,IAAI;wBACf,cAAc;oBAClB;gBACJ;oEAAG,MAAM,CAAC;QACd;4DAAG;QAAC;QAAa;KAAe;IAEhC,IAAI,CAAC,aAAa,CAAC,aAAa;QAC5B,oDAAoD;QACpD,OAAO;IACX;IAEA,qBACI,6LAAC;QAAI,WAAU;;0BACV,6LAAC,qIAAA,CAAA,eAAY;gBACV,OAAO;gBACP,QAAQ;gBACR,WAAW;gBACX,uBACE,6LAAC;oBAAI,WAAU;;sCACX,6LAAC,oIAAA,CAAA,cAAW;4BAAC,UAAU;4BAAU,WAAW;4BAAW,aAAa;4BAAa,cAAc;4BAAc,cAAc;sCACvH,cAAA,6LAAC,qIAAA,CAAA,SAAM;gCAAC,SAAQ;gCAAQ,MAAK;gCAAO,WAAU;0CAC1C,cAAA,6LAAC,yMAAA,CAAA,SAAM;oCAAC,WAAU;;;;;;;;;;;;;;;;sCAG1B,6LAAC,mIAAA,CAAA,gBAAa;;;;;;;;;;;;;;;;0BAIxB,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;8BACV,cAAA,6LAAC;wBAAI,WAAU;;0CACZ,6LAAC,6IAAA,CAAA,aAAU;gCAAC,WAAU;;kDAClB,6LAAC;wCAAI,WAAU;;0DACV,6LAAC;gDAAI,WAAU;;kEACV,6LAAC,oIAAA,CAAA,cAAW;wDAAC,UAAU;wDAAU,iBAAgB;wDAAQ,WAAW;wDAAW,aAAa;wDAAa,cAAc;wDAAc,cAAc;kEACjJ,cAAA,6LAAC;4DAAI,WAAU;sEACX,cAAA,6LAAC,qMAAA,CAAA,OAAI;gEAAC,WAAU;;;;;;;;;;;;;;;;kEAGtB,6LAAC;wDAAK,WAAU;kEAAmD;;;;;;;;;;;;4CAExE,cAAc,GAAG,CAAC,CAAC,MAAM,sBACtB,6LAAC;oDAAoC,WAAU;oDAA4E,SAAS,IAAM,SAAS,eAAe;4DAAE,QAAQ,KAAK,MAAM;wDAAC;;sEACpL,6LAAC,qIAAA,CAAA,SAAM;4DAAC,WAAU;;8EACd,6LAAC,qIAAA,CAAA,cAAW;oEAAC,KAAK,KAAK,IAAI;;;;;;8EAC3B,6LAAC,qIAAA,CAAA,iBAAc;8EAAE,KAAK,IAAI,CAAC,MAAM,CAAC;;;;;;;;;;;;sEAEtC,6LAAC;4DAAK,WAAU;sEAAuC,KAAK,IAAI;;;;;;sEAChE,6LAAC,qMAAA,CAAA,OAAI;4DAAC,WAAU;;;;;;;mDANV,GAAG,KAAK,MAAM,CAAC,CAAC,EAAE,OAAO;;;;;;;;;;;kDAU3C,6LAAC,6IAAA,CAAA,YAAS;wCAAC,aAAY;wCAAa,WAAU;;;;;;;;;;;;0CAGlD,6LAAC,mIAAA,CAAA,OAAI;gCAAC,cAAa;gCAAQ,WAAU;;kDAChC,6LAAC;wCAAI,WAAU;kDACZ,cAAA,6LAAC,mIAAA,CAAA,WAAQ;4CAAC,WAAU;;8DAChB,6LAAC,mIAAA,CAAA,cAAW;oDAAC,OAAM;oDAAU,WAAU;;sEAAkC,6LAAC,qMAAA,CAAA,OAAU;4DAAC,WAAU;;;;;;wDAAgB;;;;;;;8DAC/G,6LAAC,mIAAA,CAAA,cAAW;oDAAC,OAAM;oDAAe,WAAU;;sEAAkC,6LAAC,yMAAA,CAAA,SAAM;4DAAC,WAAU;;;;;;wDAAgB;;;;;;;8DAChH,6LAAC,mIAAA,CAAA,cAAW;oDAAC,OAAM;oDAAQ,WAAU;;sEAAkC,6LAAC,uMAAA,CAAA,QAAK;4DAAC,WAAU;;;;;;wDAAgB;;;;;;;;;;;;;;;;;;kDAIhH,6LAAC,mIAAA,CAAA,cAAW;wCAAC,OAAM;wCAAQ,WAAU;kDACjC,cAAA,6LAAC;4CAAI,WAAU;;8DACV,6LAAC;oDAAI,WAAU;8DACX,cAAA,6LAAC,oIAAA,CAAA,cAAW;wDAAC,UAAU;wDAAU,iBAAgB;wDAAQ,WAAW;wDAAW,aAAa;wDAAa,cAAc;wDAAc,cAAc;kEAChJ,cAAA,6LAAC;4DAAI,WAAU;sEACX,cAAA,6LAAC;gEAAI,WAAU;0EACX,cAAA,6LAAC,qMAAA,CAAA,OAAI;oEAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;gDAK/B,cAAc,GAAG,CAAC,CAAC,MAAM,sBACtB,6LAAC;wDAAoC,WAAU;wDAA8F,SAAS,IAAM,SAAS,eAAe;gEAAE,QAAQ,KAAK,MAAM;4DAAC;;0EACtM,6LAAC,qIAAA,CAAA,SAAM;gEAAC,WAAU;;kFACd,6LAAC,qIAAA,CAAA,cAAW;wEAAC,KAAK,KAAK,IAAI;;;;;;kFAC3B,6LAAC,qIAAA,CAAA,iBAAc;kFAAE,KAAK,IAAI,CAAC,MAAM,CAAC;;;;;;;;;;;;0EAEtC,6LAAC;gEAAK,WAAU;0EAA2C,KAAK,IAAI;;;;;;0EACpE,6LAAC,qMAAA,CAAA,OAAI;gEAAC,WAAU;;;;;;;uDANV,GAAG,KAAK,MAAM,CAAC,CAAC,EAAE,OAAO;;;;;;;;;;;;;;;;kDAY/C,6LAAC,mIAAA,CAAA,cAAW;wCAAC,OAAM;wCAAe,WAAU;kDACxC,cAAA,6LAAC;4CAAI,WAAU;;8DACX,6LAAC;oDAAI,WAAU;8DACX,cAAA,6LAAC,oIAAA,CAAA,cAAW;wDAAC,UAAU;wDAAU,iBAAgB;wDAAU,WAAW;wDAAW,aAAa;wDAAa,cAAc;wDAAc,cAAc;kEACjJ,cAAA,6LAAC;4DAAI,WAAU;sEACX,cAAA,6LAAC;gEAAI,WAAU;0EACX,cAAA,6LAAC,qMAAA,CAAA,OAAI;oEAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;gDAK/B,gBAAgB,GAAG,CAAC,CAAC,MAAM,sBACxB,6LAAC;wDAAsC,WAAU;wDAA8F,SAAS,IAAM,SAAS,sBAAsB;gEAAE,OAAO,KAAK,IAAI;gEAAE,UAAU,KAAK,QAAQ;gEAAE,MAAM,KAAK,IAAI;4DAAC;;0EACtP,6LAAC,qIAAA,CAAA,SAAM;gEAAC,WAAU;;kFACd,6LAAC,qIAAA,CAAA,cAAW;wEAAC,KAAK,KAAK,IAAI;wEAAE,WAAU;;;;;;kFACvC,6LAAC,qIAAA,CAAA,iBAAc;kFAAE,KAAK,IAAI,CAAC,MAAM,CAAC;;;;;;;;;;;;0EAErC,6LAAC;gEAAK,WAAU;0EAA2C,KAAK,IAAI;;;;;;0EACrE,6LAAC,qMAAA,CAAA,OAAI;gEAAC,WAAU;;;;;;;uDANV,GAAG,KAAK,QAAQ,CAAC,CAAC,EAAE,OAAO;;;;;;;;;;;;;;;;kDAYjD,6LAAC,mIAAA,CAAA,cAAW;wCAAC,OAAM;wCAAU,WAAU;kDACnC,cAAA,6LAAC;4CAAI,WAAU;;8DACV,6LAAC;oDAAI,WAAU;8DACZ,cAAA,6LAAC,oIAAA,CAAA,cAAW;wDAAC,UAAU;wDAAU,iBAAgB;wDAAQ,WAAW;wDAAW,aAAa;wDAAa,cAAc;wDAAc,cAAc;kEAC/I,cAAA,6LAAC;4DAAI,WAAU;sEACX,cAAA,6LAAC;gEAAI,WAAU;0EACX,cAAA,6LAAC,qMAAA,CAAA,OAAI;oEAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;8DAK/B,6LAAC;oDAAI,WAAU;8DACZ,cAAA,6LAAC;wDAAE,WAAU;kEAA4C;;;;;;;;;;;;;;;;;;;;;;;;;;;;4BAKvE,QAAQ,KAAK,WAAW,kBACtB,6LAAC;gCAAI,WAAU;;kDACV,6LAAC;wCAAE,WAAU;kDAAqC;;;;;;kDACnD,6LAAC,qIAAA,CAAA,SAAM;wCAAC,SAAS;wCAAkB,WAAU;kDAA0B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQvG;GArMgB;;QACK,+HAAA,CAAA,UAAO;;;KADZ","debugId":null}},
    {"offset": {"line": 1613, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/AllCompetitionsScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useCallback, useMemo } from 'react';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Star, Pencil, Plus, Search, Users, Trophy, Loader2, RefreshCw, Crown } from 'lucide-react';\nimport type { ScreenProps } from '@/app/page';\nimport { Button } from '@/components/ui/button';\nimport { useAdmin, useAuth, useFirestore } from '@/firebase';\nimport { doc, setDoc, getDocs, writeBatch, getDoc, deleteDoc, deleteField, updateDoc } from 'firebase/firestore';\nimport { RenameDialog } from '@/components/RenameDialog';\nimport { AddCompetitionDialog } from '@/components/AddCompetitionDialog';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport type { Favorites, ManagedCompetition as ManagedCompetitionType, Team, FavoriteTeam, CrownedLeague, CrownedTeam } from '@/lib/types';\nimport { SearchSheet, SearchableItem } from '@/components/SearchSheet';\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport { useToast } from '@/hooks/use-toast';\nimport { getLocalFavorites, setLocalFavorites } from '@/lib/local-favorites';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { ProfileButton } from '../AppContentWrapper';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\nimport { LeagueHeaderItem } from '@/components/LeagueHeaderItem';\nimport { cn } from '@/lib/utils';\nimport { collection } from 'firebase/firestore';\nimport { POPULAR_LEAGUES, POPULAR_TEAMS } from '@/lib/popular-data';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\n// --- TYPE DEFINITIONS ---\ninterface FullLeague {\n  league: { id: number; name: string; type: string; logo: string; };\n  country: { name: string; code: string; flag: string; };\n  seasons: any[];\n}\ninterface NestedGroupedCompetitions {\n    [continent: string]: {\n        [country: string]: FullLeague[];\n    };\n}\ntype RenameType = 'league' | 'team' | 'player' | 'continent' | 'country' | 'coach' | 'status' | 'crown';\ninterface RenameState {\n  id: string | number;\n  name: string;\n  type: RenameType;\n  purpose: 'rename' | 'note' | 'crown';\n  note?: string;\n  originalData?: any;\n  originalName?: string;\n}\n\nconst COMPETITIONS_CACHE_KEY = 'goalstack_all_competitions_cache_v1';\nconst TEAMS_CACHE_KEY = 'goalstack_national_teams_cache_v1';\nconst CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours\n\ninterface Cache<T> {\n    data: T;\n    timestamp: number;\n}\n\nconst getCachedData = <T,>(key: string): T | null => {\n    if (typeof window === 'undefined') return null;\n    try {\n        const cachedItem = localStorage.getItem(key);\n        if (!cachedItem) return null;\n        const { data, timestamp } = JSON.parse(cachedItem) as Cache<T>;\n        if (Date.now() - timestamp > CACHE_DURATION) {\n            localStorage.removeItem(key);\n            return null;\n        }\n        return data;\n    } catch (e) {\n        return null;\n    }\n};\n\nconst setCachedData = <T,>(key: string, data: T) => {\n    if (typeof window === 'undefined') return;\n    try {\n        const cacheItem: Cache<T> = { data, timestamp: Date.now() };\n        localStorage.setItem(key, JSON.stringify(cacheItem));\n    } catch (e) {\n        console.error(`Failed to cache data for key ${key}:`, e);\n    }\n};\n\n// --- CONSTANTS ---\nconst countryToContinent: { [key: string]: string } = {\n    \"World\": \"World\", \"England\": \"Europe\", \"Spain\": \"Europe\", \"Germany\": \"Europe\", \"Italy\": \"Europe\", \"France\": \"Europe\", \"Netherlands\": \"Europe\", \"Portugal\": \"Europe\", \"Belgium\": \"Europe\", \"Russia\": \"Europe\", \"Turkey\": \"Europe\", \"Greece\": \"Europe\", \"Switzerland\": \"Europe\", \"Austria\": \"Europe\", \"Denmark\": \"Europe\", \"Scotland\": \"Europe\", \"Sweden\": \"Europe\", \"Norway\": \"Europe\", \"Poland\": \"Europe\", \"Ukraine\": \"Europe\", \"Czech-Republic\": \"Europe\", \"Croatia\": \"Europe\", \"Romania\": \"Europe\", \"Serbia\": \"Europe\", \"Hungary\": \"Europe\", \"Finland\": \"Europe\", \"Ireland\": \"Europe\", \"Northern-Ireland\": \"Europe\", \"Wales\": \"Europe\", \"Iceland\": \"Europe\", \"Albania\": \"Europe\", \"Georgia\": \"Europe\", \"Latvia\": \"Europe\", \"Estonia\": \"Europe\", \"Lithuania\": \"Europe\", \"Luxembourg\": \"Europe\", \"Faroe-Islands\": \"Europe\", \"Malta\": \"Europe\", \"Andorra\": \"Europe\", \"San-Marino\": \"Europe\", \"Gibraltar\": \"Europe\", \"Kosovo\": \"Europe\", \"Bosnia-and-Herzegovina\": \"Europe\", \"Slovakia\": \"Europe\", \"Slovenia\": \"Europe\", \"Bulgaria\": \"Europe\", \"Cyprus\": \"Europe\", \"Azerbaijan\": \"Europe\", \"Armenia\": \"Europe\", \"Belarus\": \"Europe\", \"Moldova\": \"Europe\", \"North-Macedonia\": \"Europe\", \"Montenegro\": \"Europe\",\n    \"Saudi Arabia\": \"Asia\", \"Japan\": \"Asia\", \"South Korea\": \"Asia\", \"China\": \"Asia\", \"Qatar\": \"Asia\", \"United Arab Emirates\": \"Asia\", \"Iran\": \"Asia\", \"Iraq\": \"Asia\", \"Uzbekistan\": \"Asia\", \"Australia\": \"Asia\", \"Jordan\": \"Asia\", \"Syria\": \"Asia\", \"Lebanon\": \"Asia\", \"Oman\": \"Asia\", \"Kuwait\": \"Asia\", \"Bahrain\": \"Asia\", \"India\": \"Asia\", \"Thailand\": \"Asia\", \"Vietnam\": \"Asia\", \"Malaysia\": \"Asia\", \"Indonesia\": \"Asia\", \"Singapore\": \"Asia\", \"Philippines\": \"Asia\", \"Hong Kong\": \"Asia\", \"Palestine\": \"Asia\", \"Tajikistan\": \"Asia\", \"Turkmenistan\": \"Asia\", \"Kyrgyzstan\": \"Asia\", \"Bangladesh\": \"Asia\", \"Maldives\": \"Asia\", \"Cambodia\": \"Asia\", \"Myanmar\": \"Asia\", \"Yemen\": \"Asia\",\n    \"Egypt\": \"Africa\", \"Morocco\": \"Africa\", \"Tunisia\": \"Africa\", \"Algeria\": \"Africa\", \"Nigeria\": \"Africa\", \"Senegal\": \"Africa\", \"Ghana\": \"Africa\", \"Ivory Coast\": \"Africa\", \"Cameroon\": \"Africa\", \"South Africa\": \"Africa\", \"DR Congo\": \"Africa\", \"Mali\": \"Africa\", \"Burkina Faso\": \"Africa\", \"Guinea\": \"Africa\", \"Zambia\": \"Africa\", \"Cape Verde\": \"Africa\", \"Uganda\": \"Africa\", \"Kenya\": \"Africa\", \"Tanzania\": \"Africa\", \"Sudan\": \"Africa\", \"Libya\": \"Africa\", \"Angola\": \"Africa\", \"Zimbabwe\": \"Africa\", \"Ethiopia\": \"Africa\",\n    \"USA\": \"North America\", \"Mexico\": \"North America\", \"Canada\": \"North America\", \"Costa Rica\": \"North America\", \"Honduras\": \"North America\", \"Panama\": \"North America\", \"Jamaica\": \"North America\", \"El Salvador\": \"North America\", \"Trinidad and Tobago\": \"North America\", \"Guatemala\": \"North America\", \"Nicaragua\": \"North America\", \"Cuba\": \"North America\",\n    \"Brazil\": \"South America\", \"Argentina\": \"South America\", \"Colombia\": \"South America\", \"Chile\": \"South America\", \"Uruguay\": \"South America\", \"Peru\": \"South America\", \"Ecuador\": \"South America\", \"Paraguay\": \"South America\", \"Venezuela\": \"South America\", \"Bolivia\": \"South America\",\n    \"New Zealand\": \"Oceania\", \"Fiji\": \"Oceania\",\n};\n\nconst continentOrder = [\"World\", \"Europe\", \"Asia\", \"Africa\", \"South America\", \"North America\", \"Oceania\", \"Other\"];\nconst WORLD_LEAGUES_KEYWORDS = [\"world\", \"uefa\", \"champions league\", \"europa\", \"copa libertadores\", \"copa sudamericana\", \"caf champions\", \"afc champions\", \"conmebol\", \"concacaf\", \"arab\", \"club world cup\", \"nations league\"];\n\nconst priorityCountries = [ \"England\", \"Spain\", \"Germany\", \"Italy\", \"France\", \"Netherlands\", \"Portugal\", \"Saudi Arabia\", \"Iraq\", \"Japan\", \"Australia\", \"Brazil\", \"Argentina\", \"Egypt\", \"Morocco\", \"Tunisia\", \"Algeria\", \"Qatar\", \"United Arab Emirates\", \"Jordan\", \"Syria\", \"Lebanon\", \"Oman\", \"Kuwait\", \"Bahrain\", \"Sudan\", \"Libya\", \"Yemen\"];\nconst priorityNationalTeams = [\n    6, 28, 5, 4, 7, 2, 8, 9, 10, 12, 13, 27, 21, 769, 768, 775, 25, 24, 22, 17, 15, 19, 20, 29, 31, 23\n];\n\n\n// --- Sorting Logic ---\nconst getLeagueImportance = (leagueName: string): number => {\n    const lowerCaseName = leagueName.toLowerCase();\n    if (lowerCaseName.includes('world cup')) return 1;\n    if (lowerCaseName.includes('champions league')) return 2;\n    if (lowerCaseName.includes('euro') || lowerCaseName.includes('copa america') || lowerCaseName.includes('afc asian cup') || lowerCaseName.includes('africa cup of nations')) return 3;\n    if (lowerCaseName.includes('europa league') || lowerCaseName.includes('afc cup') || lowerCaseName.includes('conference league')) return 4;\n    if (lowerCaseName.includes('nations league') || lowerCaseName.includes('club world cup')) return 5;\n    if (lowerCaseName.includes('friendly')) return 99;\n    if (lowerCaseName.includes('premier league') || lowerCaseName.includes('la liga') || lowerCaseName.includes('serie a') || lowerCaseName.includes('bundesliga') || lowerCaseName.includes('ligue 1') || lowerCaseName.includes('stars league')) return 10;\n    if (lowerCaseName.includes('cup') || lowerCaseName.includes('copa') || lowerCaseName.includes('kfp') || lowerCaseName.includes(\"king's cup\")) return 11;\n    if (lowerCaseName.includes('championship') || lowerCaseName.includes('segunda') || lowerCaseName.includes('serie b') || lowerCaseName.includes('division 2')) return 12;\n    return 50;\n}\n\n\n// --- MAIN SCREEN COMPONENT ---\nexport function AllCompetitionsScreen({ navigate, goBack, canGoBack, favorites, customNames, setFavorites, onCustomNameChange }: ScreenProps & {setFavorites: React.Dispatch<React.SetStateAction<Partial<Favorites>>>, onCustomNameChange: () => Promise<void>}) {\n    const { isAdmin } = useAdmin();\n    const { user } = useAuth();\n    const { db } = useFirestore();\n    const { toast } = useToast();\n    \n    const [renameItem, setRenameItem] = useState<RenameState | null>(null);\n    const [isAddOpen, setAddOpen] = useState(false);\n\n    const [allLeagues, setAllLeagues] = useState<FullLeague[] | null>(null);\n    const [nationalTeams, setNationalTeams] = useState<Team[] | null>(null);\n    const [loadingClubData, setLoadingClubData] = useState(false);\n    const [loadingNationalTeams, setLoadingNationalTeams] = useState(false);\n    \n    const getName = useCallback((type: 'league' | 'team' | 'country' | 'continent', id: string | number, defaultName: string) => {\n        if (!customNames || !id) return defaultName || '';\n        const mapKey = type === 'league' ? 'leagues' : type === 'team' ? 'teams' : type === 'country' ? 'countries' : 'continents';\n        const firestoreMap = customNames[mapKey];\n        \n        const customName = firestoreMap?.get(id as any);\n        if (customName) return customName;\n        \n        const hardcodedKey = `${type}s` as 'leagues' | 'teams' | 'countries' | 'continents';\n        const hardcodedName = hardcodedTranslations[hardcodedKey]?.[id];\n        if (hardcodedName) return hardcodedName;\n\n        return defaultName;\n    }, [customNames]);\n\n\n    const fetchAllCompetitions = useCallback(async () => {\n        const cachedLeagues = getCachedData<FullLeague[]>(COMPETITIONS_CACHE_KEY);\n        if (cachedLeagues) {\n            setAllLeagues(cachedLeagues);\n            return;\n        }\n\n        setLoadingClubData(true);\n        toast({ title: 'جاري جلب بيانات البطولات...', description: 'قد تستغرق هذه العملية دقيقة في المرة الأولى.' });\n        \n        try {\n            const res = await fetch(`https://${API_FOOTBALL_HOST}/leagues`, {\n                headers: {\n                    'x-rapidapi-host': API_FOOTBALL_HOST,\n                    'x-rapidapi-key': API_KEY || '',\n                },\n            });\n            if (!res.ok) throw new Error(\"Failed to fetch leagues\");\n            const data = await res.json();\n            const leaguesData: FullLeague[] = data.response || [];\n            \n            setAllLeagues(leaguesData);\n            setCachedData(COMPETITIONS_CACHE_KEY, leaguesData);\n        } catch (error) {\n             console.error(\"Error fetching all leagues:\", error);\n            toast({ variant: 'destructive', title: \"خطأ\", description: \"فشل في جلب بيانات البطولات.\" });\n        } finally {\n            setLoadingClubData(false);\n        }\n    }, [toast]);\n\n    \n    const sortedGroupedCompetitions = useMemo(() => {\n        if (!customNames || !allLeagues) return {};\n        const grouped: NestedGroupedCompetitions = {};\n\n        allLeagues\n            .filter(l => l.league.type.toLowerCase() === 'cup' || l.league.type.toLowerCase() === 'league')\n            .forEach(league => {\n                const leagueNameLower = league.league.name.toLowerCase();\n                const countryNameLower = league.country.name.toLowerCase();\n                let continent: string;\n\n                if (WORLD_LEAGUES_KEYWORDS.some(keyword => leagueNameLower.includes(keyword)) || countryNameLower === 'world') {\n                    continent = \"World\";\n                } else {\n                    continent = countryToContinent[league.country.name] || \"Other\";\n                }\n\n                if (!grouped[continent]) {\n                    grouped[continent] = {};\n                }\n                const countryKey = league.country.name || \"N/A\";\n                if (!grouped[continent][countryKey]) {\n                    grouped[continent][countryKey] = [];\n                }\n                grouped[continent][countryKey].push(league);\n            });\n        \n        for (const continent in grouped) {\n            for (const country in grouped[continent]) {\n                grouped[continent][country].sort((a, b) => {\n                    const importanceA = getLeagueImportance(a.league.name);\n                    const importanceB = getLeagueImportance(b.league.name);\n                    if (importanceA !== importanceB) {\n                        return importanceA - importanceB;\n                    }\n                    const translatedNameA = getName('league', a.league.id, a.league.name);\n                    const translatedNameB = getName('league', b.league.id, b.league.name);\n                    return translatedNameA.localeCompare(translatedNameB, 'ar');\n                });\n            }\n        }\n        \n        return grouped;\n    }, [allLeagues, getName, customNames]);\n\n    \n    const fetchNationalTeams = useCallback(async () => {\n        const cachedTeams = getCachedData<Team[]>(TEAMS_CACHE_KEY);\n        if (cachedTeams) {\n            setNationalTeams(cachedTeams);\n            return;\n        }\n\n        setLoadingNationalTeams(true);\n        toast({ title: 'جاري جلب بيانات المنتخبات...', description: 'قد تستغرق هذه العملية دقيقة في المرة الأولى.' });\n    \n        try {\n            const res = await fetch(`https://${API_FOOTBALL_HOST}/teams?country=`, {\n                headers: {\n                    'x-rapidapi-host': API_FOOTBALL_HOST,\n                    'x-rapidapi-key': API_KEY || '',\n                },\n            });\n            if(!res.ok) throw new Error(\"Failed to fetch teams\");\n\n            const data = await res.json();\n            const nationalTeamsData = (data.response || []).filter((r: { team: Team }) => r.team.national).map((r: { team: Team}) => r.team);\n            setNationalTeams(nationalTeamsData);\n            setCachedData(TEAMS_CACHE_KEY, nationalTeamsData);\n\n        } catch (error) {\n            console.error(\"Error fetching national teams:\", error);\n            toast({ variant: 'destructive', title: \"خطأ\", description: \"فشل في جلب بيانات المنتخبات الوطنية.\" });\n        } finally {\n            setLoadingNationalTeams(false);\n        }\n    }, [toast]);\n    \n    const groupedNationalTeams = useMemo(() => {\n        if (!nationalTeams || !customNames) return null;\n\n        const processedTeams = nationalTeams.map(team => ({\n            ...team,\n            name: getName('team', team.id, team.name),\n        }));\n\n        const grouped: { [continent: string]: Team[] } = {};\n        processedTeams.forEach(team => {\n            const continent = countryToContinent[team.country || team.name] || \"Other\";\n            if (!grouped[continent]) grouped[continent] = [];\n            grouped[continent].push(team);\n        });\n\n        Object.keys(grouped).forEach(continent => {\n            grouped[continent].sort((a,b) => {\n                const aIsPriority = priorityNationalTeams.includes(a.id);\n                const bIsPriority = priorityNationalTeams.includes(b.id);\n                if (aIsPriority && !bIsPriority) return -1;\n                if (!aIsPriority && bIsPriority) return 1;\n                return a.name.localeCompare(b.name, 'ar');\n            });\n        });\n        \n        return grouped;\n    }, [nationalTeams, getName, customNames]);\n\n    const popularItemsForSearch = useMemo((): SearchableItem[] => {\n        if (!customNames) return [];\n        const seen = new Set<string>();\n        \n        return [...POPULAR_TEAMS, ...POPULAR_LEAGUES].map(item => {\n            const type = 'national' in item || 'type' in item ? 'teams' : 'leagues';\n            const key = `${type}-${item.id}`;\n            if (seen.has(key)) return null;\n            seen.add(key);\n    \n            return {\n                id: item.id,\n                type: type as 'teams' | 'leagues',\n                name: getName(type.slice(0, -1) as 'team' | 'league', item.id, item.name),\n                originalName: item.name,\n                logo: item.logo,\n                originalItem: item as any,\n            };\n        }).filter(Boolean) as SearchableItem[];\n    }, [customNames, getName]);\n\n\n    const handleFavoriteToggle = useCallback((item: { id: number, name: string, logo: string, national?: boolean }, itemType: 'leagues' | 'teams') => {\n        const itemId = item.id;\n        \n        setFavorites(prev => {\n            const newFavorites = JSON.parse(JSON.stringify(prev || {}));\n            if (!newFavorites[itemType]) {\n                newFavorites[itemType] = {};\n            }\n            const isCurrentlyFavorited = !!newFavorites[itemType]?.[itemId];\n    \n            if (isCurrentlyFavorited) {\n                delete newFavorites[itemType]![itemId];\n            } else {\n                if (itemType === 'leagues') {\n                    newFavorites.leagues![itemId] = { name: item.name, leagueId: itemId, logo: item.logo, notificationsEnabled: true };\n                } else {\n                    newFavorites.teams![itemId] = { name: (item as Team).name, teamId: itemId, logo: item.logo, type: (item as Team).national ? 'National' : 'Club' };\n                }\n            }\n            return newFavorites;\n        });\n        \n    }, [setFavorites]);\n    \n\n    const handleOpenCrownDialog = (team: Team) => {\n        if (!user) {\n            toast({ title: 'مستخدم زائر', description: 'يرجى تسجيل الدخول لاستخدام هذه الميزة.' });\n            return;\n        }\n        setRenameItem({\n            id: team.id,\n            name: getName('team', team.id, team.name),\n            type: 'crown',\n            purpose: 'crown',\n            originalData: team,\n            note: favorites?.crownedTeams?.[team.id]?.note || '',\n        });\n    };\n\n    const handleSaveRenameOrNote = (type: RenameType, id: string | number, newName: string, newNote: string = '') => {\n        if (!renameItem || !db) return;\n        const { purpose, originalData, originalName } = renameItem;\n    \n        if (purpose === 'rename' && isAdmin) {\n            const collectionName = `${type}Customizations`;\n            const docRef = doc(db, collectionName, String(id));\n            const data = { customName: newName };\n    \n            const op = (newName && newName.trim() && newName !== originalName) ? setDoc(docRef, data) : deleteDoc(docRef);\n    \n            op.then(() => onCustomNameChange())\n            .catch(serverError => {\n                errorEmitter.emit('permission-error', new FirestorePermissionError({ path: docRef.path, operation: 'write', requestResourceData: data }));\n            });\n    \n        } else if (purpose === 'crown' && user) {\n            const teamId = Number(id);\n            setFavorites(prev => {\n                const newFavorites = JSON.parse(JSON.stringify(prev || {}));\n                if (!newFavorites.crownedTeams) newFavorites.crownedTeams = {};\n                const isCurrentlyCrowned = !!newFavorites.crownedTeams?.[teamId];\n                \n                if (isCurrentlyCrowned) {\n                    delete newFavorites.crownedTeams[teamId];\n                } else {\n                    const crownedData = { teamId, name: (originalData as Team).name, logo: (originalData as Team).logo, note: newNote };\n                    newFavorites.crownedTeams[teamId] = crownedData;\n                }\n                \n                return newFavorites;\n            });\n        }\n    \n        setRenameItem(null);\n    };\n    \n    const handleOpenRename = (type: RenameType, id: number | string, name: string, originalName?: string) => {\n        if (!isAdmin) return;\n        setRenameItem({\n            type: type,\n            id: id,\n            name: name,\n            originalName: originalName || name,\n            purpose: 'rename',\n        });\n    };\n    \n    const handleAdminRefresh = async () => {\n        if (!isAdmin) return;\n        localStorage.removeItem(COMPETITIONS_CACHE_KEY);\n        localStorage.removeItem(TEAMS_CACHE_KEY);\n        toast({ title: 'بدء التحديث...', description: 'جاري تحديث بيانات البطولات والمنتخبات.' });\n        setAllLeagues(null);\n        setNationalTeams(null);\n        await fetchAllCompetitions();\n        await fetchNationalTeams();\n        toast({ title: 'نجاح', description: 'تم تحديث البيانات بنجاح.' });\n    };\n\n    const renderNationalTeams = () => {\n        if (loadingNationalTeams) return <div className=\"flex justify-center p-4\"><Loader2 className=\"h-6 w-6 animate-spin\"/></div>;\n        if (!groupedNationalTeams) return <p className=\"p-4 text-center text-muted-foreground\">اضغط على زر الفتح لعرض المنتخبات.</p>;\n\n\n        return continentOrder.filter(c => groupedNationalTeams[c]).map(continent => (\n            <AccordionItem value={`national-${continent}`} key={`national-${continent}`} className=\"rounded-lg border bg-card/50\">\n                <div className=\"flex items-center px-4 py-3\">\n                    <AccordionTrigger className=\"flex-1 hover:no-underline p-0\">\n                        <h3 className=\"text-lg font-bold\">{getName('continent', continent, continent)}</h3>\n                    </AccordionTrigger>\n                    {isAdmin && (\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9 ml-2\" onClick={(e) => { e.stopPropagation(); handleOpenRename('continent', continent, getName('continent', continent, continent)); }}>\n                            <Pencil className=\"h-4 w-4\"/>\n                        </Button>\n                    )}\n                </div>\n              <AccordionContent className=\"p-1\">\n                <ul className=\"flex flex-col\">{\n                  groupedNationalTeams[continent].map(team => {\n                     const isStarred = !!favorites?.teams?.[team.id];\n                     const isCrowned = !!favorites?.crownedTeams?.[team.id];\n                     const countryName = team.country || team.name;\n                     return (\n                         <li key={team.id} className=\"flex w-full items-center justify-between p-3 h-12 hover:bg-accent/80 transition-colors rounded-md\">\n                           <div className=\"flex items-center gap-3 flex-1 min-w-0 cursor-pointer\" onClick={() => navigate('TeamDetails', { teamId: team.id })}>\n                             <Avatar className=\"h-6 w-6 bg-white\"><AvatarImage src={team.logo} alt={team.name} /></Avatar>\n                             <span className=\"text-sm truncate\">{team.name}</span>\n                           </div>\n                           <div className=\"flex items-center gap-1\">\n                             {isAdmin && (\n                               <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={(e) => { e.stopPropagation(); handleOpenRename('country', countryName, getName('country', countryName, countryName), countryName) }}>\n                                 <Pencil className=\"h-4 w-4 text-muted-foreground/80\" />\n                               </Button>\n                             )}\n                              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={(e) => { e.stopPropagation(); handleOpenCrownDialog(team); }}>\n                                <Crown className={cn(\"h-5 w-5 text-muted-foreground/60\", isCrowned && \"fill-current text-yellow-400\")} />\n                              </Button>\n                             <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={(e) => { e.stopPropagation(); handleFavoriteToggle(team, 'teams'); }}>\n                               <Star className={isStarred ? \"h-5 w-5 text-yellow-400 fill-current\" : \"h-5 w-5 text-muted-foreground/50\"} />\n                             </Button>\n                           </div>\n                         </li>\n                     )\n                  })\n                }</ul>\n              </AccordionContent>\n            </AccordionItem>\n          ));\n    }\n\n\n    const renderClubCompetitions = () => {\n        if (loadingClubData) return <div className=\"flex justify-center p-4\"><Loader2 className=\"h-6 w-6 animate-spin\"/></div>;\n        if (!allLeagues) return <p className=\"p-4 text-center text-muted-foreground\">اضغط على زر الفتح لعرض البطولات.</p>;\n        \n        return continentOrder.filter(c => sortedGroupedCompetitions[c]).map(continent => (\n             <AccordionItem value={`club-${continent}`} key={`club-${continent}`} className=\"rounded-lg border bg-card/50\">\n                <div className=\"flex items-center px-4 py-3\">\n                    <AccordionTrigger className=\"flex-1 hover:no-underline p-0\">\n                        <h3 className=\"text-lg font-bold\">{getName('continent', continent, continent)}</h3>\n                    </AccordionTrigger>\n                    {isAdmin && (\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9 ml-2\" onClick={(e) => { e.stopPropagation(); handleOpenRename('continent', continent, getName('continent', continent, continent)); }}>\n                            <Pencil className=\"h-4 w-4\"/>\n                        </Button>\n                    )}\n                </div>\n                <AccordionContent className=\"p-2 space-y-2\">\n                     <Accordion type=\"multiple\" className=\"w-full space-y-2\">\n                        {Object.keys(sortedGroupedCompetitions[continent]).sort((a,b) => {\n                           const aIsPriority = priorityCountries.includes(a);\n                           const bIsPriority = priorityCountries.includes(b);\n                           if (aIsPriority && !bIsPriority) return -1;\n                           if (!aIsPriority && bIsPriority) return 1;\n                           return getName('country', a, a).localeCompare(getName('country', b, b), 'ar');\n                        }).map(country => (\n                            <AccordionItem value={`country-${country}`} key={country} className=\"rounded-lg border bg-background/50\">\n                                <div className=\"flex items-center px-3 py-2.5\">\n                                    <AccordionTrigger className=\"flex-1 hover:no-underline p-0 text-base\">\n                                        <span className=\"font-semibold\">{getName('country', country, country)}</span>\n                                    </AccordionTrigger>\n                                    {isAdmin && (\n                                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7 ml-2\" onClick={(e) => { e.stopPropagation(); handleOpenRename('country', country, getName('country', country, country)); }}>\n                                            <Pencil className=\"h-3 w-3\"/>\n                                        </Button>\n                                    )}\n                                </div>\n                                <AccordionContent className=\"p-1\">\n                                    {sortedGroupedCompetitions[continent][country].map(({ league }) => (\n                                        <LeagueHeaderItem\n                                            key={league.id}\n                                            league={{leagueId: league.id, name: getName('league', league.id, league.name), logo: league.logo, countryName: country}}\n                                            isFavorited={!!favorites?.leagues?.[league.id]}\n                                            onFavoriteToggle={() => handleFavoriteToggle(league, 'leagues')}\n                                            onRename={() => handleOpenRename('league', league.id, getName('league', league.id, league.name), league.name)}\n                                            onClick={() => navigate('CompetitionDetails', { title: getName('league', league.id, league.name), leagueId: league.id, logo: league.logo })}\n                                            isAdmin={isAdmin}\n                                        />\n                                    ))}\n                                </AccordionContent>\n                             </AccordionItem>\n                        ))}\n                    </Accordion>\n                </AccordionContent>\n             </AccordionItem>\n        ));\n    };\n\n    if (!favorites || !customNames) {\n         return (\n            <div className=\"flex h-full flex-col bg-background\">\n                <ScreenHeader \n                    title={\"البطولات\"} \n                    onBack={goBack} \n                    canGoBack={canGoBack} \n                />\n                <div className=\"flex-1 flex items-center justify-center\">\n                    <Loader2 className=\"h-8 w-8 animate-spin\" />\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader \n                title={\"البطولات\"} \n                onBack={goBack} \n                canGoBack={canGoBack} \n                actions={\n                  <div className=\"flex items-center gap-1\">\n                      <SearchSheet navigate={navigate} favorites={favorites} customNames={customNames} setFavorites={setFavorites} onCustomNameChange={onCustomNameChange} popularItems={popularItemsForSearch}>\n                          <Button variant=\"ghost\" size=\"icon\">\n                              <Search className=\"h-5 w-5\" />\n                          </Button>\n                      </SearchSheet>\n                      {isAdmin && (\n                        <>\n                            <Button size=\"icon\" variant=\"ghost\" onClick={handleAdminRefresh}>\n                                <RefreshCw className=\"h-5 w-5\" />\n                            </Button>\n                            <Button size=\"icon\" variant=\"ghost\" onClick={() => setAddOpen(true)}>\n                                <Plus className=\"h-5 w-5\" />\n                            </Button>\n                        </>\n                      )}\n                      <ProfileButton />\n                  </div>\n                }\n            />\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n                 <Accordion type=\"multiple\" className=\"w-full space-y-2\">\n                    <AccordionItem value=\"national-teams-section\" className=\"rounded-lg border bg-card/50\">\n                        <AccordionTrigger className=\"px-4 py-3 hover:no-underline\" onClick={() => !nationalTeams && fetchNationalTeams()}>\n                            <div className=\"flex items-center gap-3\">\n                                <Users className=\"h-6 w-6 text-primary\"/>\n                                <h3 className=\"text-lg font-bold\">المنتخبات</h3>\n                            </div>\n                        </AccordionTrigger>\n                        <AccordionContent className=\"p-2\">\n                             <Accordion type=\"multiple\" className=\"w-full space-y-2\">\n                                {renderNationalTeams()}\n                             </Accordion>\n                        </AccordionContent>\n                    </AccordionItem>\n                 </Accordion>\n                 \n                 <Accordion type=\"multiple\" className=\"w-full space-y-2\">\n                    <AccordionItem value=\"club-competitions-section\" className=\"rounded-lg border bg-card/50\">\n                        <AccordionTrigger className=\"px-4 py-3 hover:no-underline\" onClick={() => !allLeagues && fetchAllCompetitions()}>\n                            <div className=\"flex items-center gap-3\">\n                                <Trophy className=\"h-6 w-6 text-primary\"/>\n                                <h3 className=\"text-lg font-bold\">البطولات</h3>\n                            </div>\n                        </AccordionTrigger>\n                        <AccordionContent className=\"p-2\">\n                           <Accordion type=\"multiple\" className=\"w-full space-y-2\">\n                               {renderClubCompetitions()}\n                            </Accordion>\n                        </AccordionContent>\n                    </AccordionItem>\n                 </Accordion>\n            </div>\n            \n            {renameItem && <RenameDialog\n                isOpen={!!renameItem}\n                onOpenChange={(isOpen) => !isOpen && setRenameItem(null)}\n                item={renameItem}\n                onSave={(type, id, name, note) => handleSaveRenameOrNote(type, id, name, note || '')}\n            />}\n            <AddCompetitionDialog isOpen={isAddOpen} onOpenChange={(isOpen) => {\n                setAddOpen(isOpen);\n                if(!isOpen) {\n                    onCustomNameChange();\n                }\n            }} />\n        </div>\n    );\n}\n\n    \n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2986, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/NewsScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useMemo } from 'react';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport type { ScreenProps } from '@/app/page';\nimport Image from 'next/image';\nimport { Button } from '@/components/ui/button';\nimport { Plus, Edit, Trash2, Loader2, Search } from 'lucide-react';\nimport { useAdmin, useFirestore } from '@/firebase';\nimport { collection, query, orderBy, doc, deleteDoc, getDocs } from 'firebase/firestore';\nimport type { NewsArticle } from '@/lib/types';\nimport { formatDistanceToNow } from 'date-fns';\nimport { ar } from 'date-fns/locale';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from '@/hooks/use-toast';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { SearchSheet, SearchableItem } from '@/components/SearchSheet';\nimport { ProfileButton } from '../AppContentWrapper';\nimport { POPULAR_LEAGUES, POPULAR_TEAMS } from '@/lib/popular-data';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\n\nexport function NewsScreen({ navigate, goBack, canGoBack, favorites, customNames, setFavorites }: ScreenProps & {setFavorites: (favorites: any) => void}) {\n  const { isAdmin } = useAdmin();\n  const { db } = useFirestore();\n  const [news, setNews] = useState<NewsArticle[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  const getDisplayName = React.useCallback((type: 'team' | 'league', id: number, defaultName: string) => {\n    if (!customNames) return defaultName;\n    const firestoreMap = type === 'team' ? customNames?.teams : customNames?.leagues;\n    const customName = firestoreMap?.get(id);\n    if (customName) return customName;\n\n    const hardcodedMap = type === 'team' ? hardcodedTranslations.teams : hardcodedTranslations.leagues;\n    const hardcodedName = hardcodedMap[id as any];\n    if(hardcodedName) return hardcodedName;\n\n    return defaultName;\n  }, [customNames]);\n  \n  useEffect(() => {\n    if (!db) {\n        setLoading(false);\n        return;\n    }\n    setLoading(true);\n    const newsCollectionRef = collection(db, 'news');\n    const q = query(newsCollectionRef, orderBy('timestamp', 'desc'));\n    \n    getDocs(q).then(snapshot => {\n      const fetchedNews = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as NewsArticle));\n      setNews(fetchedNews);\n      setLoading(false);\n    }).catch(error => {\n      console.error(\"Error fetching news:\", error);\n      const permissionError = new FirestorePermissionError({ path: 'news', operation: 'list' });\n      errorEmitter.emit('permission-error', permissionError);\n      setLoading(false);\n    });\n\n  }, [db]);\n  \n  const handleDelete = (articleId: string) => {\n    if (!db) return;\n    setDeletingId(articleId);\n    const docRef = doc(db, 'news', articleId);\n    deleteDoc(docRef)\n        .then(() => {\n            toast({ title: \"نجاح\", description: \"تم حذف الخبر بنجاح.\" });\n            setNews(prevNews => prevNews.filter(article => article.id !== articleId));\n        })\n        .catch(serverError => {\n            const permissionError = new FirestorePermissionError({ path: docRef.path, operation: 'delete' });\n            errorEmitter.emit('permission-error', permissionError);\n        })\n        .finally(() => setDeletingId(null));\n  };\n\n  const popularItemsForSearch = useMemo((): SearchableItem[] => {\n    if (!customNames) return [];\n    const seen = new Set<string>();\n    \n    return [...POPULAR_TEAMS, ...POPULAR_LEAGUES].map(item => {\n        const type = 'national' in item || 'type' in item ? 'teams' : 'leagues';\n        const key = `${type}-${item.id}`;\n        if (seen.has(key)) return null;\n        seen.add(key);\n\n        return {\n            id: item.id,\n            type: type as 'teams' | 'leagues',\n            name: getDisplayName(type.slice(0, -1) as 'team' | 'league', item.id, item.name),\n            originalName: item.name,\n            logo: item.logo,\n            originalItem: item as any,\n        };\n    }).filter(Boolean) as SearchableItem[];\n  }, [customNames, getDisplayName]);\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader \n        title={\"أخبار\"} \n        onBack={goBack} \n        canGoBack={canGoBack} \n        actions={\n          <div className=\"flex items-center gap-1\">\n              <SearchSheet navigate={navigate} favorites={favorites} customNames={customNames} setFavorites={setFavorites} popularItems={popularItemsForSearch}>\n                  <Button variant=\"ghost\" size=\"icon\">\n                      <Search className=\"h-5 w-5\" />\n                  </Button>\n              </SearchSheet>\n              <ProfileButton />\n          </div>\n        }\n      />\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {loading ? (\n            Array.from({ length: 3 }).map((_, i) => (\n              <Card key={i}>\n                <CardHeader>\n                  <Skeleton className=\"aspect-video w-full mb-4 rounded-md\" />\n                  <Skeleton className=\"h-6 w-4/5\" />\n                </CardHeader>\n                <CardContent><Skeleton className=\"h-4 w-full\" /></CardContent>\n                <CardFooter><Skeleton className=\"h-4 w-24\" /></CardFooter>\n              </Card>\n            ))\n        ) : news.length > 0 ? (\n            news.map((article) => (\n              <Card key={article.id}>\n                {article.imageUrl && (\n                    <CardHeader>\n                        <div className=\"relative aspect-video w-full mb-4\">\n                        <Image \n                            src={article.imageUrl}\n                            alt={article.title}\n                            fill\n                            className=\"rounded-md object-cover\"\n                            data-ai-hint={article.imageHint || \"football match\"}\n                        />\n                        </div>\n                    </CardHeader>\n                )}\n                <CardHeader>\n                  <CardTitle>{article.title}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                   <p className=\"text-muted-foreground whitespace-pre-line\">{article.content}</p>\n                </CardContent>\n                <CardFooter className=\"flex justify-between items-center\">\n                   <p className=\"text-xs text-muted-foreground\">\n                    {article.timestamp ? formatDistanceToNow(article.timestamp.toDate(), { addSuffix: true, locale: ar }) : ''}\n                  </p>\n                  {isAdmin && (\n                    <div className=\"flex gap-2\">\n                       <AlertDialog>\n                          <AlertDialogTrigger asChild>\n                            <Button variant=\"destructive\" size=\"icon\" disabled={deletingId === article.id}>\n                                {deletingId === article.id ? <Loader2 className=\"h-4 w-4 animate-spin\"/> : <Trash2 className=\"h-4 w-4\" />}\n                            </Button>\n                          </AlertDialogTrigger>\n                          <AlertDialogContent>\n                             <AlertDialogHeader>\n                               <AlertDialogTitle>هل أنت متأكد؟</AlertDialogTitle>\n                               <AlertDialogDescription>\n                                 لا يمكن التراجع عن هذا الإجراء. سيتم حذف هذا الخبر بشكل نهائي.\n                               </AlertDialogDescription>\n                             </AlertDialogHeader>\n                             <AlertDialogFooter>\n                               <AlertDialogCancel>إلغاء</AlertDialogCancel>\n                               <AlertDialogAction onClick={() => handleDelete(article.id!)}>حذف</AlertDialogAction>\n                             </AlertDialogFooter>\n                          </AlertDialogContent>\n                       </AlertDialog>\n                       <Button variant=\"outline\" size=\"icon\" onClick={() => navigate('AddEditNews', { article, isEditing: true })}>\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  )}\n                </CardFooter>\n              </Card>\n            ))\n        ) : (\n             <div className=\"text-center text-muted-foreground pt-10\">\n                <p className=\"text-lg font-semibold\">لا توجد أخبار حاليًا.</p>\n                {isAdmin && <p>انقر على زر الإضافة لبدء نشر الأخبار.</p>}\n            </div>\n        )}\n      </div>\n      {isAdmin && (\n          <Button className=\"absolute bottom-24 right-4 h-14 w-14 rounded-full shadow-lg\" size=\"icon\" onClick={() => navigate('AddEditNews', { isEditing: false })}>\n              <Plus className=\"h-6 w-6\" />\n          </Button>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3520, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/SettingsScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useMemo } from 'react';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Button } from '@/components/ui/button';\nimport { ChevronLeft, LogOut, User, Search, Trophy, Settings as SettingsIcon, FileText, FileBadge } from 'lucide-react';\nimport type { ScreenProps } from '@/app/page';\nimport { useToast } from '@/hooks/use-toast';\nimport { signOut as firebaseSignOut } from '@/lib/firebase-client';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { SearchSheet, SearchableItem } from '@/components/SearchSheet';\nimport { ProfileButton } from '../AppContentWrapper';\nimport { POPULAR_LEAGUES, POPULAR_TEAMS } from '@/lib/popular-data';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\n\nexport function SettingsScreen({ navigate, goBack, canGoBack, favorites, customNames, setFavorites }: ScreenProps & {setFavorites: (favorites: any) => void}) {\n  const { toast } = useToast();\n  \n  const mainSettingsItems = [\n      { label: \"الملف الشخصي\", icon: User, action: (navigate: ScreenProps['navigate']) => navigate('Profile') },\n      { label: \"كل البطولات\", icon: Trophy, action: (navigate: ScreenProps['navigate']) => navigate('AllCompetitions') },\n      { label: \"الإعدادات العامة\", icon: SettingsIcon, action: (navigate: ScreenProps['navigate']) => navigate('GeneralSettings')},\n  ];\n\n  const legalSettingsItems = [\n      { label: \"سياسة الخصوصية\", icon: FileBadge, action: (navigate: ScreenProps['navigate']) => navigate('PrivacyPolicy') },\n      { label: \"شروط الخدمة\", icon: FileText, action: (navigate: ScreenProps['navigate']) => navigate('TermsOfService') },\n  ];\n\n  const handleSignOut = async () => {\n    try {\n      await firebaseSignOut();\n      toast({\n        title: \"تم تسجيل الخروج\",\n        description: \"نأمل رؤيتك مرة أخرى قريبا.\",\n      });\n      // The onAuthStateChanged listener in Home will handle navigation\n    } catch (error) {\n       toast({\n        variant: 'destructive',\n        title: \"فشل تسجيل الخروج\",\n        description: \"حدث خطأ أثناء تسجيل الخروج. يرجى المحاولة مرة أخرى.\",\n      });\n    }\n  };\n\n  const getDisplayName = React.useCallback((type: 'team' | 'league', id: number, defaultName: string) => {\n    if (!customNames) return defaultName;\n    const firestoreMap = type === 'team' ? customNames?.teams : customNames?.leagues;\n    const customName = firestoreMap?.get(id);\n    if (customName) return customName;\n\n    const hardcodedMap = type === 'team' ? hardcodedTranslations.teams : hardcodedTranslations.leagues;\n    const hardcodedName = hardcodedMap[id as any];\n    if(hardcodedName) return hardcodedName;\n\n    return defaultName;\n  }, [customNames]);\n  \n  const popularItemsForSearch = useMemo((): SearchableItem[] => {\n    if (!customNames) return [];\n    const seen = new Set<string>();\n    \n    return [...POPULAR_TEAMS, ...POPULAR_LEAGUES].map(item => {\n        const type = 'national' in item || 'type' in item ? 'teams' : 'leagues';\n        const key = `${type}-${item.id}`;\n        if (seen.has(key)) return null;\n        seen.add(key);\n\n        return {\n            id: item.id,\n            type: type as 'teams' | 'leagues',\n            name: getDisplayName(type.slice(0, -1) as 'team' | 'league', item.id, item.name),\n            originalName: item.name,\n            logo: item.logo,\n            originalItem: item as any,\n        };\n    }).filter(Boolean) as SearchableItem[];\n  }, [customNames, getDisplayName]);\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader \n        title={\"المزيد\"} \n        onBack={goBack} \n        canGoBack={canGoBack} \n        actions={\n          <div className=\"flex items-center gap-1\">\n              <SearchSheet navigate={navigate} favorites={favorites} customNames={customNames} setFavorites={setFavorites} popularItems={popularItemsForSearch}>\n                  <Button variant=\"ghost\" size=\"icon\">\n                      <Search className=\"h-5 w-5\" />\n                  </Button>\n              </SearchSheet>\n              <ProfileButton/>\n          </div>\n        }\n      />\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-2\">\n        \n        <div className=\"space-y-2\">\n            {mainSettingsItems.map(item => (\n                <button key={item.label} onClick={() => item.action(navigate)} className=\"flex w-full items-center justify-between rounded-lg bg-card p-4 text-right transition-colors hover:bg-accent/50\">\n                    <div className=\"flex items-center gap-4\">\n                        <item.icon className=\"h-6 w-6 text-primary\"/>\n                        <span className=\"font-medium\">{item.label}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <ChevronLeft className=\"h-5 w-5\"/>\n                    </div>\n                </button>\n            ))}\n        </div>\n\n        <div className=\"pt-4\">\n            <p className=\"px-4 pb-2 text-sm font-semibold text-muted-foreground\">قانوني</p>\n            <div className=\"space-y-2\">\n                {legalSettingsItems.map(item => (\n                    <button key={item.label} onClick={() => item.action(navigate)} className=\"flex w-full items-center justify-between rounded-lg bg-card p-4 text-right transition-colors hover:bg-accent/50\">\n                        <div className=\"flex items-center gap-4\">\n                            <item.icon className=\"h-6 w-6 text-muted-foreground\"/>\n                            <span className=\"font-medium\">{item.label}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2 text-muted-foreground\">\n                            <ChevronLeft className=\"h-5 w-5\"/>\n                        </div>\n                    </button>\n                ))}\n            </div>\n        </div>\n\n\n        <div className=\"pt-8\">\n            <AlertDialog>\n              <AlertDialogTrigger asChild>\n                <Button variant=\"destructive\" className=\"w-full gap-2\">\n                  <LogOut className=\"h-5 w-5\" />\n                  تسجيل الخروج\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>هل أنت متأكد؟</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    سيؤدي هذا الإجراء إلى تسجيل خروجك من حسابك.\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                  <AlertDialogCancel>إلغاء</AlertDialogCancel>\n                  <AlertDialogAction onClick={handleSignOut}>متابعة</AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3951, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/TeamDetailScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useCallback, useRef, useMemo } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { useAdmin, useAuth, useFirestore } from '@/firebase';\nimport { doc, getDoc, setDoc, collection, getDocs, updateDoc, deleteField, writeBatch, deleteDoc, onSnapshot } from 'firebase/firestore';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { Loader2, Pencil, Shirt, Star, Crown } from 'lucide-react';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from '@/components/ui/button';\nimport { RenameDialog } from '@/components/RenameDialog';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\nimport type { Team, Player, Fixture, Standing, TeamStatistics, Favorites, AdminFavorite, CrownedTeam, PredictionMatch } from '@/lib/types';\nimport { CURRENT_SEASON } from '@/lib/constants';\nimport { FixtureItem } from '@/components/FixtureItem';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\nimport { isMatchLive } from '@/lib/matchStatus';\nimport { getLocalFavorites, setLocalFavorites } from '@/lib/local-favorites';\nimport { format, isToday, startOfToday } from 'date-fns';\nimport { ar } from 'date-fns/locale';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\ninterface TeamData {\n    team: Team;\n    venue: {\n        id: number;\n        name: string;\n        address: string;\n        city: string;\n        capacity: number;\n        surface: string;\n        image: string;\n    };\n}\n\nconst TeamHeader = ({ team, venue, isAdmin, onRename }: { team: Team, venue: TeamData['venue'], isAdmin: boolean, onRename: () => void }) => {\n    return (\n        <Card className=\"mb-4 overflow-hidden\">\n            <div className=\"relative h-24 bg-gradient-to-r from-primary/20 to-accent/20\" style={{backgroundImage: `url(${venue?.image})`, backgroundSize: 'cover', backgroundPosition: 'center'}}>\n                <div className=\"absolute inset-0 bg-black/50\" />\n                 <div className=\"absolute top-2 left-2 flex items-center gap-1 z-10\">\n                     {isAdmin && (\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 bg-black/20 hover:bg-black/40\" onClick={onRename}>\n                            <Pencil className=\"h-4 w-4 text-white/80\" />\n                        </Button>\n                    )}\n                </div>\n            </div>\n            <CardContent className=\"pt-2 pb-4 text-center relative flex flex-col items-center\">\n                 <div className=\"relative -mt-12 mb-2\">\n                    <Avatar className=\"h-20 w-20 border-4 border-background\">\n                        <AvatarImage src={team.logo} alt={team.name} />\n                        <AvatarFallback>{team.name.charAt(0)}</AvatarFallback>\n                    </Avatar>\n                </div>\n                <h1 className=\"text-2xl font-bold\">{team.name}</h1>\n                <p className=\"text-muted-foreground\">{venue?.name}</p>\n            </CardContent>\n        </Card>\n    );\n};\n\nconst TeamPlayersTab = ({ teamId, navigate, customNames, onCustomNameChange }: { teamId: number, navigate: ScreenProps['navigate'], customNames: any, onCustomNameChange: () => Promise<void> }) => {\n    const [players, setPlayers] = useState<Player[]>([]);\n    const [loading, setLoading] = useState(true);\n    const { isAdmin } = useAdmin();\n    const { toast } = useToast();\n    const { db } = useFirestore();\n    const [renameItem, setRenameItem] = useState<{ id: number, name: string, originalName: string } | null>(null);\n\n    const getDisplayName = useCallback((id: number, defaultName: string) => {\n        if (!customNames) return defaultName;\n        const customName = customNames?.players.get(id);\n        if (customName) return customName;\n        return hardcodedTranslations.players[id] || defaultName;\n    }, [customNames]);\n\n    useEffect(() => {\n        const fetchPlayers = async () => {\n            setLoading(true);\n            try {\n                const res = await fetch(`https://${API_FOOTBALL_HOST}/players?team=${teamId}&season=${CURRENT_SEASON}`, {\n                    headers: {\n                        'x-rapidapi-host': API_FOOTBALL_HOST,\n                        'x-rapidapi-key': API_KEY || '',\n                    },\n                });\n                const data = await res.json();\n                if (data.response) {\n                    const fetchedPlayers = data.response.map((p: any) => p.player);\n                    setPlayers(fetchedPlayers);\n                }\n            } catch (error) {\n                toast({ variant: 'destructive', title: \"خطأ\", description: \"فشل في جلب قائمة اللاعبين.\" });\n            } finally {\n                setLoading(false);\n            }\n        };\n        fetchPlayers();\n    }, [teamId, toast]);\n\n    const handleSaveRename = (type: string, id: number, newName: string) => {\n        if (!renameItem || !db || !isAdmin) return;\n        const docRef = doc(db, 'playerCustomizations', String(id));\n        const originalName = renameItem.originalName;\n        \n        const op = (newName && newName.trim() && newName.trim() !== originalName) ? setDoc(docRef, { customName: newName }) : deleteDoc(docRef);\n\n        op.then(() => {\n            toast({ title: \"نجاح\", description: \"تم تحديث اسم اللاعب.\" });\n            onCustomNameChange(); // Trigger re-fetch\n        }).catch(serverError => {\n            const permissionError = new FirestorePermissionError({\n                path: docRef.path,\n                operation: (newName && newName.trim() !== originalName) ? 'create' : 'delete',\n                requestResourceData: { customName: newName }\n            });\n            errorEmitter.emit('permission-error', permissionError);\n        });\n        setRenameItem(null);\n    };\n\n\n    if (loading) {\n        return <div className=\"flex justify-center p-8\"><Loader2 className=\"h-6 w-6 animate-spin\" /></div>;\n    }\n    \n    return (\n        <div className=\"space-y-2\">\n            {renameItem && <RenameDialog isOpen={!!renameItem} onOpenChange={(isOpen) => !isOpen && setRenameItem(null)} item={{...renameItem, type: 'player', purpose: 'rename'}} onSave={(type, id, name) => handleSaveRename(type as 'player', Number(id), name)} />}\n            {players.map(player => {\n                if (!player?.id) return null;\n                return (\n                <Card key={player.id} className=\"p-2\">\n                    <div className=\"flex items-center gap-3\">\n                         <div className=\"flex-1 flex items-center gap-3 cursor-pointer\" onClick={() => navigate('PlayerDetails', { playerId: player.id })}>\n                            <Avatar className=\"h-10 w-10\">\n                                <AvatarImage src={player.photo} />\n                                <AvatarFallback>{player.name?.charAt(0)}</AvatarFallback>\n                            </Avatar>\n                            <div>\n                                <p className=\"font-semibold\">{getDisplayName(player.id, player.name)}</p>\n                                <p className=\"text-xs text-muted-foreground\">{player.position}</p>\n                            </div>\n                        </div>\n                        {player.number && (\n                           <div className=\"relative flex items-center justify-center text-primary-foreground\">\n                               <Shirt className=\"h-10 w-10 text-primary bg-primary p-1 rounded-md\" />\n                               <span className=\"absolute text-xs font-bold\">{player.number}</span>\n                           </div>\n                        )}\n                        {isAdmin && (\n                            <Button variant=\"ghost\" size=\"icon\" onClick={() => setRenameItem({ id: player.id, name: getDisplayName(player.id, player.name), originalName: player.name })}>\n                                <Pencil className=\"h-4 w-4\" />\n                            </Button>\n                        )}\n                    </div>\n                </Card>\n            )})}\n        </div>\n    );\n};\n\nconst TeamDetailsTabs = ({ teamId, leagueId, navigate, onPinToggle, pinnedPredictionMatches, isAdmin, customNames }: { teamId: number, leagueId?: number, navigate: ScreenProps['navigate'], onPinToggle: (fixture: Fixture) => void, pinnedPredictionMatches: Set<number>, isAdmin: boolean, customNames: any }) => {\n    const [fixtures, setFixtures] = useState<Fixture[]>([]);\n    const [standings, setStandings] = useState<Standing[]>([]);\n    const [stats, setStats] = useState<TeamStatistics | null>(null);\n    const [loading, setLoading] = useState(true);\n    \n    const listRef = useRef<HTMLDivElement>(null);\n    const dateRefs = useRef<{ [key: string]: HTMLDivElement | null }>({});\n\n    const getDisplayName = useCallback((type: 'team' | 'league', id: number, defaultName: string) => {\n        if (!customNames) return defaultName;\n        const key = `${type}s` as 'teams' | 'leagues';\n        const firestoreMap = customNames[key];\n        const customName = firestoreMap?.get(id);\n        if (customName) return customName;\n\n        const hardcodedMap = hardcodedTranslations[key];\n        const hardcodedName = hardcodedMap[id as any];\n        if (hardcodedName) return hardcodedName;\n\n        return defaultName;\n    }, [customNames]);\n\n    useEffect(() => {\n        let isMounted = true;\n        const fetchData = async () => {\n            if (!teamId) return;\n            setLoading(true);\n\n            try {\n                const headers = {\n                    'x-rapidapi-host': API_FOOTBALL_HOST,\n                    'x-rapidapi-key': API_KEY || '',\n                };\n\n                const [fixturesRes, statsRes] = await Promise.all([\n                    fetch(`https://${API_FOOTBALL_HOST}/fixtures?team=${teamId}&season=${CURRENT_SEASON}`, { headers }),\n                    fetch(`https://${API_FOOTBALL_HOST}/teams/statistics?team=${teamId}&season=${CURRENT_SEASON}${leagueId ? `&league=${leagueId}` : ''}`, { headers })\n                ]);\n\n                if (!isMounted) return;\n                \n                if (!fixturesRes.ok || !statsRes.ok) {\n                    throw new Error(\"API call failed\");\n                }\n\n                const fixturesData = await fixturesRes.json();\n                const statsData = await statsRes.json();\n\n                if (!isMounted) return;\n\n                const sortedFixtures = (fixturesData.response || []).sort((a: Fixture, b: Fixture) => a.fixture.timestamp - b.fixture.timestamp);\n                const teamStats = statsData.response || null;\n\n                setFixtures(sortedFixtures);\n                setStats(teamStats);\n\n                const effectiveLeagueId = leagueId || teamStats?.league?.id;\n\n                if (effectiveLeagueId) {\n                    const standingsRes = await fetch(`https://${API_FOOTBALL_HOST}/standings?league=${effectiveLeagueId}&season=${CURRENT_SEASON}`, { headers });\n                    if (!standingsRes.ok) throw new Error(\"Standings API call failed\");\n                    const standingsData = await standingsRes.json();\n                    if (isMounted) {\n                        setStandings(standingsData.response?.[0]?.league?.standings?.[0] || []);\n                    }\n                } else {\n                    if (isMounted) setStandings([]);\n                }\n\n            } catch (error) {\n                console.error(\"Error fetching team details tabs:\", error);\n            } finally {\n                if (isMounted) setLoading(false);\n            }\n        };\n\n        fetchData();\n        return () => { isMounted = false; };\n    }, [teamId, leagueId]);\n\n\n    const groupedFixtures = useMemo(() => {\n        const processed = fixtures.map(fixture => ({\n            ...fixture,\n            league: { ...fixture.league, name: getDisplayName('league', fixture.league.id, fixture.league.name) },\n            teams: {\n                home: { ...fixture.teams.home, name: getDisplayName('team', fixture.teams.home.id, fixture.teams.home.name) },\n                away: { ...fixture.teams.away, name: getDisplayName('team', fixture.teams.away.id, fixture.teams.away.name) },\n            }\n        }));\n\n        return processed.reduce((acc, fixture) => {\n            const date = format(new Date(fixture.fixture.timestamp * 1000), 'yyyy-MM-dd');\n            if (!acc[date]) acc[date] = [];\n            acc[date].push(fixture);\n            return acc;\n        }, {} as Record<string, Fixture[]>);\n\n    }, [fixtures, getDisplayName]);\n\n     useEffect(() => {\n        if (loading || Object.keys(groupedFixtures).length === 0 || !listRef.current) return;\n\n        const sortedDates = Object.keys(groupedFixtures).sort();\n        const today = startOfToday();\n        \n        let targetDateKey: string | undefined;\n\n        targetDateKey = sortedDates.find(date => {\n            const fixtureDate = new Date(date);\n            return fixtureDate >= today;\n        });\n\n        if (!targetDateKey && sortedDates.length > 0) {\n            const lastMatchDate = sortedDates[sortedDates.length - 1];\n            if (new Date(lastMatchDate) < today) {\n                targetDateKey = lastMatchDate;\n            }\n        }\n\n        if (targetDateKey && dateRefs.current[targetDateKey]) {\n            setTimeout(() => {\n                const element = dateRefs.current[targetDateKey!];\n                if (element && listRef.current) {\n                    const listTop = listRef.current.offsetTop;\n                    const elementTop = element.offsetTop;\n                    listRef.current.scrollTop = elementTop - listTop;\n                }\n            }, 100);\n        }\n    }, [loading, groupedFixtures]);\n    \n    const processedStandings = useMemo(() => {\n        if (!standings) return [];\n        return standings.map(s => ({\n            ...s,\n            team: {\n                ...s.team,\n                name: getDisplayName('team', s.team.id, s.team.name),\n            }\n        }));\n    }, [standings, getDisplayName]);\n\n\n    if (loading || customNames === null) {\n         return <div className=\"flex justify-center p-8\"><Loader2 className=\"h-6 w-6 animate-spin\" /></div>;\n    }\n\n    const sortedDates = Object.keys(groupedFixtures).sort();\n\n    return (\n        <Tabs defaultValue=\"matches\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n                <TabsTrigger value=\"matches\">المباريات</TabsTrigger>\n                <TabsTrigger value=\"standings\">الترتيب</TabsTrigger>\n                <TabsTrigger value=\"stats\">الإحصائيات</TabsTrigger>\n            </TabsList>\n            <TabsContent value=\"matches\" className=\"mt-4\">\n                <div ref={listRef} className=\"max-h-[60vh] overflow-y-auto space-y-4\">\n                    {sortedDates.length > 0 ? sortedDates.map(date => (\n                        <div key={date} ref={el => dateRefs.current[date] = el}>\n                            <h3 className=\"font-bold text-center text-sm text-muted-foreground my-2\">\n                                {format(new Date(date), 'EEEE, d MMMM yyyy', { locale: ar })}\n                            </h3>\n                            <div className=\"space-y-2\">\n                                {groupedFixtures[date].map(fixture => (\n                                    <FixtureItem\n                                        key={fixture.fixture.id}\n                                        fixture={fixture} \n                                        navigate={navigate} \n                                        isPinnedForPrediction={pinnedPredictionMatches.has(fixture.fixture.id)}\n                                        onPinToggle={onPinToggle}\n                                        isAdmin={isAdmin}\n                                    />\n                                ))}\n                            </div>\n                        </div>\n                    )) : <p className=\"text-center text-muted-foreground p-8\">لا توجد مباريات متاحة.</p>}\n                </div>\n            </TabsContent>\n            <TabsContent value=\"standings\" className=\"mt-4\">\n                 {processedStandings.length > 0 ? (\n                    <Table>\n                        <TableHeader>\n                            <TableRow>\n                                <TableHead className=\"text-center font-bold\">نقاط</TableHead>\n                                <TableHead className=\"text-center\">خ</TableHead>\n                                <TableHead className=\"text-center\">ت</TableHead>\n                                <TableHead className=\"text-center\">ف</TableHead>\n                                <TableHead className=\"text-center\">لعب</TableHead>\n                                <TableHead>الفريق</TableHead>\n                                <TableHead className=\"w-[40px] text-right px-2\">#</TableHead>\n                            </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                            {processedStandings.map(s => {\n                                if (!s.team?.id) return null;\n                                return (\n                                <TableRow key={s.team.id} className={cn(s.team.id === teamId && 'bg-primary/10')}>\n                                    <TableCell className=\"text-center font-bold\">{s.points}</TableCell>\n                                    <TableCell className=\"text-center\">{s.all.lose}</TableCell>\n                                    <TableCell className=\"text-center\">{s.all.draw}</TableCell>\n                                    <TableCell className=\"text-center\">{s.all.win}</TableCell>\n                                    <TableCell className=\"text-center\">{s.all.played}</TableCell>\n                                    <TableCell>\n                                        <div className=\"flex items-center gap-2 justify-end\">\n                                            <p className=\"font-semibold truncate\">{s.team.name}</p>\n                                            <Avatar className=\"h-6 w-6\"><AvatarImage src={s.team.logo} /></Avatar>\n                                        </div>\n                                    </TableCell>\n                                    <TableCell className=\"font-bold px-2\">{s.rank}</TableCell>\n                                </TableRow>\n                            )})}\n                        </TableBody>\n                    </Table>\n                ) : <p className=\"text-center text-muted-foreground p-8\">الترتيب غير متاح لهذه البطولة.</p>}\n            </TabsContent>\n            <TabsContent value=\"stats\" className=\"mt-4\">\n                 {stats && stats.league ? (\n                    <Card>\n                        <CardHeader>\n                            <CardTitle>إحصائيات موسم {stats.league.season || CURRENT_SEASON}</CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                             <div className=\"grid grid-cols-2 gap-4 text-center\">\n                                 <div className=\"p-4 bg-card-foreground/5 rounded-lg\">\n                                    <p className=\"font-bold text-2xl\">{stats.fixtures?.played?.total || 0}</p>\n                                    <p className=\"text-sm text-muted-foreground\">مباريات</p>\n                                 </div>\n                                  <div className=\"p-4 bg-card-foreground/5 rounded-lg\">\n                                    <p className=\"font-bold text-2xl\">{stats.fixtures?.wins?.total || 0}</p>\n                                    <p className=\"text-sm text-muted-foreground\">فوز</p>\n                                 </div>\n                                  <div className=\"p-4 bg-card-foreground/5 rounded-lg\">\n                                    <p className=\"font-bold text-2xl\">{stats.fixtures?.draws?.total || 0}</p>\n                                    <p className=\"text-sm text-muted-foreground\">تعادل</p>\n                                 </div>\n                                  <div className=\"p-4 bg-card-foreground/5 rounded-lg\">\n                                    <p className=\"font-bold text-2xl\">{stats.fixtures?.loses?.total || 0}</p>\n                                    <p className=\"text-sm text-muted-foreground\">خسارة</p>\n                                 </div>\n                                  <div className=\"p-4 bg-card-foreground/5 rounded-lg col-span-2\">\n                                    <p className=\"font-bold text-2xl\">{stats.goals?.for?.total?.total || 0}</p>\n                                    <p className=\"text-sm text-muted-foreground\">أهداف</p>\n                                 </div>\n                             </div>\n                        </CardContent>\n                    </Card>\n                ) : <p className=\"text-center text-muted-foreground p-8\">الإحصائيات غير متاحة.</p>}\n            </TabsContent>\n        </Tabs>\n    );\n};\n\n\nexport function TeamDetailScreen({ navigate, goBack, canGoBack, teamId, leagueId, favorites, customNames, setFavorites, onCustomNameChange }: ScreenProps & { teamId: number, leagueId?: number, setFavorites: React.Dispatch<React.SetStateAction<Partial<Favorites>>>, onCustomNameChange: () => Promise<void> }) {\n    const { user } = useAuth();\n    const { db } = useFirestore();\n    const { isAdmin } = useAdmin();\n    const { toast } = useToast();\n    const [teamData, setTeamData] = useState<TeamData | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState<string | null>(null);\n    const [renameItem, setRenameItem] = useState<{ id: number; name: string; note?: string; type: 'team' | 'crown'; purpose: 'rename' | 'crown' | 'note'; originalData: any; originalName?: string; } | null>(null);\n    const [pinnedPredictionMatches, setPinnedPredictionMatches] = useState(new Set<number>());\n    const [activeTab, setActiveTab] = useState('details');\n\n    useEffect(() => {\n        if (!teamId) {\n            setLoading(false);\n            setError(\"Team ID is missing.\");\n            return;\n        };\n        let isMounted = true;\n        let predictionsUnsub: (() => void) | null = null;\n\n        const getTeamInfo = async () => {\n            setLoading(true);\n            setError(null);\n            try {\n                const teamRes = await fetch(`https://${API_FOOTBALL_HOST}/teams?id=${teamId}`, {\n                     headers: {\n                        'x-rapidapi-host': API_FOOTBALL_HOST,\n                        'x-rapidapi-key': API_KEY || '',\n                    },\n                });\n                if (!teamRes.ok) {\n                    throw new Error(`Team API fetch failed with status ${teamRes.status}`);\n                }\n                \n                const data = await teamRes.json();\n                if (isMounted) {\n                    if (data.response?.[0]) {\n                        const teamInfo = data.response[0];\n                        setTeamData(teamInfo);\n                    } else {\n                         // Don't throw an error, just set the error state\n                         setError(\"Team not found in API response.\");\n                    }\n                }\n            } catch (err: any) {\n                console.error(\"Error fetching team info:\", err);\n                if (isMounted) {\n                    setError(err.message || 'فشل في تحميل بيانات الفريق.');\n                }\n            } finally {\n                if (isMounted) setLoading(false);\n            }\n        };\n\n        getTeamInfo();\n\n        if(db) {\n            const q = collection(db, \"predictionFixtures\");\n            predictionsUnsub = onSnapshot(q, (snapshot) => {\n                const newPinnedSet = new Set<number>();\n                snapshot.forEach(doc => newPinnedSet.add(Number(doc.id)));\n                if(isMounted) setPinnedPredictionMatches(newPinnedSet);\n            });\n        }\n\n        return () => {\n            isMounted = false;\n            if(predictionsUnsub) predictionsUnsub();\n        };\n    }, [teamId, db]);\n\n\n    const handlePinToggle = useCallback((fixture: Fixture) => {\n        if (!db) return;\n        const fixtureId = fixture.fixture.id;\n        const isPinned = pinnedPredictionMatches.has(fixtureId);\n        const docRef = doc(db, 'predictionFixtures', String(fixtureId));\n\n        if (isPinned) {\n            deleteDoc(docRef).then(() => {\n                toast({ title: \"تم إلغاء التثبيت\", description: \"تمت إزالة المباراة من التوقعات.\" });\n            }).catch(err => {\n                errorEmitter.emit('permission-error', new FirestorePermissionError({ path: docRef.path, operation: 'delete' }));\n            });\n        } else {\n            const data: PredictionMatch = { fixtureData: fixture };\n            setDoc(docRef, data).then(() => {\n                toast({ title: \"تم التثبيت\", description: \"أصبحت المباراة متاحة الآن للتوقع.\" });\n            }).catch(err => {\n                errorEmitter.emit('permission-error', new FirestorePermissionError({ path: docRef.path, operation: 'create', requestResourceData: data }));\n            });\n        }\n    }, [db, pinnedPredictionMatches, toast]);\n\n    const handleRename = () => {\n        if (!teamData) return;\n        const { team } = teamData;\n        setRenameItem({\n            id: team.id,\n            name: getDisplayName('team', team.id, team.name),\n            type: 'team',\n            purpose: 'rename',\n            originalData: team,\n            originalName: team.name,\n        });\n    };\n    \n    const getDisplayName = useCallback((type: 'team' | 'league', id: number, defaultName: string) => {\n        if (!customNames) return defaultName;\n        const key = `${type}s` as 'teams' | 'leagues';\n        const firestoreMap = customNames[key];\n        const customName = firestoreMap?.get(id);\n        if (customName) return customName;\n\n        const hardcodedMap = hardcodedTranslations[key];\n        const hardcodedName = hardcodedMap[id as any];\n        if (hardcodedName) return hardcodedName;\n\n        return defaultName;\n    }, [customNames]);\n\n\n    if(loading) {\n        return (\n            <div className=\"flex h-full flex-col bg-background\">\n                <ScreenHeader title=\"جاري التحميل...\" onBack={goBack} canGoBack={canGoBack} />\n                <div className=\"flex-1 overflow-y-auto p-1\">\n                    <Skeleton className=\"h-48 w-full mb-4\" />\n                    <Skeleton className=\"h-10 w-full\" />\n                    <div className=\"mt-4 p-4\">\n                        <Skeleton className=\"h-64 w-full\" />\n                    </div>\n                </div>\n            </div>\n        );\n    }\n    \n    if (error) {\n        return (\n            <div className=\"flex h-full flex-col bg-background\">\n                <ScreenHeader title=\"خطأ\" onBack={goBack} canGoBack={canGoBack} />\n                <div className=\"flex-1 flex items-center justify-center text-center p-4\">\n                    <Card>\n                        <CardHeader>\n                            <CardTitle>حدث خطأ</CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                            <p className=\"text-muted-foreground\">{error}</p>\n                            <Button onClick={goBack} className=\"mt-4\">العودة</Button>\n                        </CardContent>\n                    </Card>\n                </div>\n            </div>\n        );\n    }\n\n    if(!teamData || !favorites || !customNames) {\n        return (\n            <div className=\"flex h-full flex-col bg-background\">\n                <ScreenHeader title=\"جاري التحميل...\" onBack={goBack} canGoBack={canGoBack} />\n                <div className=\"flex-1 flex items-center justify-center\">\n                    <Loader2 className=\"h-8 w-8 animate-spin\"/>\n                </div>\n            </div>\n        );\n    }\n\n    const displayTitle = getDisplayName('team', teamId, teamData.team.name);\n\n    return (\n        <div className=\"flex flex-col bg-background h-full\">\n            <ScreenHeader \n                title={\"\"}\n                onBack={goBack} \n                canGoBack={canGoBack} \n            />\n            {renameItem && (\n                <RenameDialog\n                    isOpen={!!renameItem}\n                    onOpenChange={(isOpen) => !isOpen && setRenameItem(null)}\n                    item={renameItem}\n                    onSave={() => {}}\n                />\n            )}\n            <div className=\"flex-1 overflow-y-auto p-1 min-h-0\">\n                <TeamHeader \n                    team={{...teamData.team, name: displayTitle }}\n                    venue={teamData.venue}\n                    isAdmin={isAdmin}\n                    onRename={handleRename}\n                />\n                 <Tabs defaultValue=\"details\" onValueChange={setActiveTab} className=\"w-full\">\n                  <TabsList className=\"grid w-full grid-cols-2\">\n                    <TabsTrigger value=\"details\">التفاصيل</TabsTrigger>\n                    <TabsTrigger value=\"players\">اللاعبون</TabsTrigger>\n                  </TabsList>\n                  <TabsContent value=\"details\" className=\"mt-4\">\n                    <TeamDetailsTabs teamId={teamId} leagueId={leagueId} navigate={navigate} onPinToggle={handlePinToggle} pinnedPredictionMatches={pinnedPredictionMatches} isAdmin={isAdmin} customNames={customNames} />\n                  </TabsContent>\n                  <TabsContent value=\"players\" className=\"mt-4\">\n                    <TeamPlayersTab teamId={teamId} navigate={navigate} customNames={customNames} onCustomNameChange={onCustomNameChange}/>\n                  </TabsContent>\n                </Tabs>\n            </div>\n        </div>\n    );\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5510, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/PlayerDetailScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useCallback } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, getDoc } from 'firebase/firestore';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport type { Player, PlayerStats } from '@/lib/types';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Loader2 } from 'lucide-react';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { CURRENT_SEASON } from '@/lib/constants';\nimport { Separator } from '@/components/ui/separator';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\n// --- TYPE DEFINITIONS ---\ninterface PlayerInfo extends Player {\n    birth: { date: string; place: string; country: string; };\n    nationality: string;\n    height: string;\n    weight:string;\n    injured: boolean;\n}\n\ninterface PlayerData {\n    player: PlayerInfo;\n    statistics: PlayerStats[];\n}\n\ninterface Transfer {\n    date: string;\n    type: string;\n    teams: {\n        in: { id: number; name: string; logo: string; } | null;\n        out: { id: number; name: string; logo: string; } | null;\n    };\n}\n\n\n// --- SUB-COMPONENTS ---\nconst PlayerHeader = ({ player }: { player: PlayerInfo }) => (\n    <Card className=\"mb-4 overflow-hidden\">\n        <div className=\"relative h-24 bg-gradient-to-r from-primary/20 to-accent/20\">\n            <Avatar className=\"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 h-24 w-24 border-4 border-background\">\n                <AvatarImage src={player.photo} alt={player.name} />\n                <AvatarFallback>{player.name.charAt(0)}</AvatarFallback>\n            </Avatar>\n        </div>\n        <CardContent className=\"pt-16 text-center\">\n            <h1 className=\"text-2xl font-bold\">{player.name}</h1>\n            <p className=\"text-muted-foreground\">{player.nationality}</p>\n            <div className=\"mt-4 flex justify-center gap-6 text-sm\">\n                <div className=\"flex flex-col items-center\">\n                    <span className=\"font-bold\">{player.age || '-'}</span>\n                    <span className=\"text-xs text-muted-foreground\">العمر</span>\n                </div>\n                <div className=\"flex flex-col items-center\">\n                    <span className=\"font-bold\">{player.height || '-'}</span>\n                    <span className=\"text-xs text-muted-foreground\">الطول</span>\n                </div>\n                <div className=\"flex flex-col items-center\">\n                    <span className=\"font-bold\">{player.weight || '-'}</span>\n                    <span className=\"text-xs text-muted-foreground\">الوزن</span>\n                </div>\n            </div>\n        </CardContent>\n    </Card>\n);\n\nconst CurrentTeamStats = ({ statistics, navigate }: { statistics: PlayerStats[], navigate: ScreenProps['navigate'] }) => {\n    if (statistics.length === 0) {\n        return (\n             <Card>\n                <CardContent className=\"p-4 text-center text-muted-foreground\">\n                    لا توجد إحصائيات متاحة لهذا الموسم.\n                </CardContent>\n            </Card>\n        );\n    }\n    const currentLeagueStats = statistics[0]; \n\n    return (\n        <Card>\n            <CardHeader>\n                <CardTitle className=\"text-lg\">الأداء هذا الموسم ({currentLeagueStats.league.season})</CardTitle>\n            </CardHeader>\n            <CardContent>\n                 <div \n                    className=\"flex items-center gap-3 mb-6 p-3 rounded-lg bg-card-foreground/5 cursor-pointer\"\n                    onClick={() => navigate('CompetitionDetails', { leagueId: currentLeagueStats.league.id })}\n                >\n                    <Avatar className=\"h-12 w-12\"><AvatarImage src={currentLeagueStats.team.logo} /></Avatar>\n                    <div>\n                        <p className=\"font-bold\">{currentLeagueStats.team.name}</p>\n                        <p className=\"text-xs text-muted-foreground\">{currentLeagueStats.league.name}</p>\n                    </div>\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-4 text-center\">\n                    <div>\n                        <p className=\"font-bold text-xl\">{currentLeagueStats.games.appearences || 0}</p>\n                        <p className=\"text-xs text-muted-foreground\">مباريات</p>\n                    </div>\n                    <div>\n                        <p className=\"font-bold text-xl\">{currentLeagueStats.goals.total || 0}</p>\n                        <p className=\"text-xs text-muted-foreground\">أهداف</p>\n                    </div>\n                    <div>\n                        <p className=\"font-bold text-xl\">{currentLeagueStats.goals.assists || 0}</p>\n                        <p className=\"text-xs text-muted-foreground\">صناعة</p>\n                    </div>\n                     <div>\n                        <p className=\"font-bold text-xl\">{currentLeagueStats.cards.yellow || 0}</p>\n                        <p className=\"text-xs text-muted-foreground\">بطاقات صفراء</p>\n                    </div>\n                     <div>\n                        <p className=\"font-bold text-xl\">{currentLeagueStats.cards.red + currentLeagueStats.cards.yellowred || 0}</p>\n                        <p className=\"text-xs text-muted-foreground\">بطاقات حمراء</p>\n                    </div>\n                     <div>\n                        <p className=\"font-bold text-xl\">{currentLeagueStats.games.rating ? parseFloat(currentLeagueStats.games.rating).toFixed(1) : '-'}</p>\n                        <p className=\"text-xs text-muted-foreground\">تقييم</p>\n                    </div>\n                </div>\n            </CardContent>\n        </Card>\n    );\n};\n\nconst CareerHistory = ({ transfers, navigate }: { transfers: Transfer[], navigate: ScreenProps['navigate'] }) => {\n    const careerTeams = React.useMemo(() => {\n        if (!transfers || transfers.length === 0) return [];\n        const teamsMap = new Map<number, { name: string; logo: string }>();\n        transfers.forEach(t => {\n            if (t.teams?.in) teamsMap.set(t.teams.in.id, t.teams.in);\n            if (t.teams?.out) teamsMap.set(t.teams.out.id, t.teams.out);\n        });\n        return Array.from(teamsMap.values()).reverse();\n    }, [transfers]);\n\n    if (careerTeams.length === 0) {\n        return null;\n    }\n\n    return (\n        <Card>\n            <CardHeader><CardTitle className=\"text-lg\">مسيرة اللاعب</CardTitle></CardHeader>\n            <CardContent className=\"space-y-2\">\n                {careerTeams.map((team, index) => (\n                    <React.Fragment key={team.id}>\n                        <div \n                            className=\"flex items-center gap-3 p-3 rounded-lg hover:bg-accent cursor-pointer\"\n                             onClick={() => navigate('TeamDetails', {teamId: team.id })}\n                        >\n                            <Avatar><AvatarImage src={team.logo} alt={team.name} /></Avatar>\n                            <span className=\"font-semibold\">{team.name}</span>\n                        </div>\n                        {index < careerTeams.length - 1 && <Separator />}\n                    </React.Fragment>\n                ))}\n            </CardContent>\n        </Card>\n    );\n}\n\n// --- MAIN SCREEN COMPONENT ---\nexport function PlayerDetailScreen({ navigate, goBack, canGoBack, playerId }: ScreenProps & { playerId: number }) {\n  const { db } = useFirestore();\n  const [displayTitle, setDisplayTitle] = useState(\"ملف اللاعب\");\n  const [playerData, setPlayerData] = useState<PlayerData | null>(null);\n  const [transfers, setTransfers] = useState<Transfer[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!playerId) return;\n\n    const getPlayerInfo = async () => {\n        setLoading(true);\n        try {\n            const headers = {\n                'x-rapidapi-host': API_FOOTBALL_HOST,\n                'x-rapidapi-key': API_KEY || '',\n            };\n\n            // Fetch main player data for the current season\n            const playerRes = await fetch(`https://${API_FOOTBALL_HOST}/players?id=${playerId}&season=${CURRENT_SEASON}`, { headers });\n            if (playerRes.ok) {\n                const data = await playerRes.json();\n                if (data.response?.[0]) {\n                    const playerInfo = data.response[0];\n                    setPlayerData(playerInfo);\n                    const name = playerInfo.player.name;\n\n                    // Check for custom name in Firestore\n                    if (db) {\n                         const customNameDocRef = doc(db, \"playerCustomizations\", String(playerId));\n                         try {\n                             const customNameDocSnap = await getDoc(customNameDocRef);\n                             if (customNameDocSnap.exists()) {\n                                 setDisplayTitle(customNameDocSnap.data().customName);\n                             } else {\n                                setDisplayTitle(name);\n                             }\n                         } catch (error) {\n                            const permissionError = new FirestorePermissionError({\n                                path: customNameDocRef.path,\n                                operation: 'get',\n                            });\n                            errorEmitter.emit('permission-error', permissionError);\n                            setDisplayTitle(name); // fallback to original name\n                         }\n                    } else {\n                        setDisplayTitle(name);\n                    }\n                }\n            }\n\n            // Fetch transfer data for career history\n            const transferRes = await fetch(`https://${API_FOOTBALL_HOST}/transfers?player=${playerId}`, { headers });\n            if (transferRes.ok) {\n                 const data = await transferRes.json();\n                 setTransfers(data.response || []);\n            }\n\n        } catch (error) {\n            console.error(\"Error fetching player info:\", error);\n        } finally {\n            setLoading(false);\n        }\n    };\n    \n    getPlayerInfo();\n    \n  }, [db, playerId]);\n\n  if(loading) {\n     return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader title=\"جاري التحميل...\" onBack={goBack} canGoBack={canGoBack} />\n             <div className=\"p-4 space-y-4\">\n                <Skeleton className=\"h-48 w-full\" />\n                <Skeleton className=\"h-40 w-full\" />\n                <Skeleton className=\"h-24 w-full\" />\n            </div>\n        </div>\n    );\n  }\n  \n  if(!playerData) {\n     return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader title=\"خطأ\" onBack={goBack} canGoBack={canGoBack} />\n            <p className=\"text-center p-8\">لم يتم العثور على بيانات اللاعب.</p>\n        </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col bg-background h-full\">\n      <ScreenHeader \n        title={displayTitle}\n        onBack={goBack} \n        canGoBack={canGoBack} \n      />\n      \n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        <PlayerHeader player={{...playerData.player, name: displayTitle}} />\n        <CurrentTeamStats statistics={playerData.statistics} navigate={navigate} />\n        <CareerHistory transfers={transfers} navigate={navigate}/>\n      </div>\n    </div>\n  );\n}\n\n    "],"names":[],"mappings":";;;AAmBgB;;AAhBhB;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;;AAfA;;;;;;;;;;;;AAiBA,MAAM,oBAAoB;AAC1B,MAAM;AA0BN,yBAAyB;AACzB,MAAM,eAAe,CAAC,EAAE,MAAM,EAA0B,iBACpD,6LAAC,mIAAA,CAAA,OAAI;QAAC,WAAU;;0BACZ,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC,qIAAA,CAAA,SAAM;oBAAC,WAAU;;sCACd,6LAAC,qIAAA,CAAA,cAAW;4BAAC,KAAK,OAAO,KAAK;4BAAE,KAAK,OAAO,IAAI;;;;;;sCAChD,6LAAC,qIAAA,CAAA,iBAAc;sCAAE,OAAO,IAAI,CAAC,MAAM,CAAC;;;;;;;;;;;;;;;;;0BAG5C,6LAAC,mIAAA,CAAA,cAAW;gBAAC,WAAU;;kCACnB,6LAAC;wBAAG,WAAU;kCAAsB,OAAO,IAAI;;;;;;kCAC/C,6LAAC;wBAAE,WAAU;kCAAyB,OAAO,WAAW;;;;;;kCACxD,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAK,WAAU;kDAAa,OAAO,GAAG,IAAI;;;;;;kDAC3C,6LAAC;wCAAK,WAAU;kDAAgC;;;;;;;;;;;;0CAEpD,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAK,WAAU;kDAAa,OAAO,MAAM,IAAI;;;;;;kDAC9C,6LAAC;wCAAK,WAAU;kDAAgC;;;;;;;;;;;;0CAEpD,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAK,WAAU;kDAAa,OAAO,MAAM,IAAI;;;;;;kDAC9C,6LAAC;wCAAK,WAAU;kDAAgC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAtB9D;AA6BN,MAAM,mBAAmB,CAAC,EAAE,UAAU,EAAE,QAAQ,EAAoE;IAChH,IAAI,WAAW,MAAM,KAAK,GAAG;QACzB,qBACK,6LAAC,mIAAA,CAAA,OAAI;sBACF,cAAA,6LAAC,mIAAA,CAAA,cAAW;gBAAC,WAAU;0BAAwC;;;;;;;;;;;IAK3E;IACA,MAAM,qBAAqB,UAAU,CAAC,EAAE;IAExC,qBACI,6LAAC,mIAAA,CAAA,OAAI;;0BACD,6LAAC,mIAAA,CAAA,aAAU;0BACP,cAAA,6LAAC,mIAAA,CAAA,YAAS;oBAAC,WAAU;;wBAAU;wBAAoB,mBAAmB,MAAM,CAAC,MAAM;wBAAC;;;;;;;;;;;;0BAExF,6LAAC,mIAAA,CAAA,cAAW;;kCACP,6LAAC;wBACE,WAAU;wBACV,SAAS,IAAM,SAAS,sBAAsB;gCAAE,UAAU,mBAAmB,MAAM,CAAC,EAAE;4BAAC;;0CAEvF,6LAAC,qIAAA,CAAA,SAAM;gCAAC,WAAU;0CAAY,cAAA,6LAAC,qIAAA,CAAA,cAAW;oCAAC,KAAK,mBAAmB,IAAI,CAAC,IAAI;;;;;;;;;;;0CAC5E,6LAAC;;kDACG,6LAAC;wCAAE,WAAU;kDAAa,mBAAmB,IAAI,CAAC,IAAI;;;;;;kDACtD,6LAAC;wCAAE,WAAU;kDAAiC,mBAAmB,MAAM,CAAC,IAAI;;;;;;;;;;;;;;;;;;kCAIpF,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;;kDACG,6LAAC;wCAAE,WAAU;kDAAqB,mBAAmB,KAAK,CAAC,WAAW,IAAI;;;;;;kDAC1E,6LAAC;wCAAE,WAAU;kDAAgC;;;;;;;;;;;;0CAEjD,6LAAC;;kDACG,6LAAC;wCAAE,WAAU;kDAAqB,mBAAmB,KAAK,CAAC,KAAK,IAAI;;;;;;kDACpE,6LAAC;wCAAE,WAAU;kDAAgC;;;;;;;;;;;;0CAEjD,6LAAC;;kDACG,6LAAC;wCAAE,WAAU;kDAAqB,mBAAmB,KAAK,CAAC,OAAO,IAAI;;;;;;kDACtE,6LAAC;wCAAE,WAAU;kDAAgC;;;;;;;;;;;;0CAEhD,6LAAC;;kDACE,6LAAC;wCAAE,WAAU;kDAAqB,mBAAmB,KAAK,CAAC,MAAM,IAAI;;;;;;kDACrE,6LAAC;wCAAE,WAAU;kDAAgC;;;;;;;;;;;;0CAEhD,6LAAC;;kDACE,6LAAC;wCAAE,WAAU;kDAAqB,mBAAmB,KAAK,CAAC,GAAG,GAAG,mBAAmB,KAAK,CAAC,SAAS,IAAI;;;;;;kDACvG,6LAAC;wCAAE,WAAU;kDAAgC;;;;;;;;;;;;0CAEhD,6LAAC;;kDACE,6LAAC;wCAAE,WAAU;kDAAqB,mBAAmB,KAAK,CAAC,MAAM,GAAG,WAAW,mBAAmB,KAAK,CAAC,MAAM,EAAE,OAAO,CAAC,KAAK;;;;;;kDAC7H,6LAAC;wCAAE,WAAU;kDAAgC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMrE;MA1DM;AA4DN,MAAM,gBAAgB,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAgE;;IACxG,MAAM,cAAc,6JAAA,CAAA,UAAK,CAAC,OAAO;8CAAC;YAC9B,IAAI,CAAC,aAAa,UAAU,MAAM,KAAK,GAAG,OAAO,EAAE;YACnD,MAAM,WAAW,IAAI;YACrB,UAAU,OAAO;sDAAC,CAAA;oBACd,IAAI,EAAE,KAAK,EAAE,IAAI,SAAS,GAAG,CAAC,EAAE,KAAK,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,EAAE;oBACvD,IAAI,EAAE,KAAK,EAAE,KAAK,SAAS,GAAG,CAAC,EAAE,KAAK,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,GAAG;gBAC9D;;YACA,OAAO,MAAM,IAAI,CAAC,SAAS,MAAM,IAAI,OAAO;QAChD;6CAAG;QAAC;KAAU;IAEd,IAAI,YAAY,MAAM,KAAK,GAAG;QAC1B,OAAO;IACX;IAEA,qBACI,6LAAC,mIAAA,CAAA,OAAI;;0BACD,6LAAC,mIAAA,CAAA,aAAU;0BAAC,cAAA,6LAAC,mIAAA,CAAA,YAAS;oBAAC,WAAU;8BAAU;;;;;;;;;;;0BAC3C,6LAAC,mIAAA,CAAA,cAAW;gBAAC,WAAU;0BAClB,YAAY,GAAG,CAAC,CAAC,MAAM,sBACpB,6LAAC,6JAAA,CAAA,UAAK,CAAC,QAAQ;;0CACX,6LAAC;gCACG,WAAU;gCACT,SAAS,IAAM,SAAS,eAAe;wCAAC,QAAQ,KAAK,EAAE;oCAAC;;kDAEzD,6LAAC,qIAAA,CAAA,SAAM;kDAAC,cAAA,6LAAC,qIAAA,CAAA,cAAW;4CAAC,KAAK,KAAK,IAAI;4CAAE,KAAK,KAAK,IAAI;;;;;;;;;;;kDACnD,6LAAC;wCAAK,WAAU;kDAAiB,KAAK,IAAI;;;;;;;;;;;;4BAE7C,QAAQ,YAAY,MAAM,GAAG,mBAAK,6LAAC,wIAAA,CAAA,YAAS;;;;;;uBAR5B,KAAK,EAAE;;;;;;;;;;;;;;;;AAchD;GAlCM;MAAA;AAqCC,SAAS,mBAAmB,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAsC;;IAC9G,MAAM,EAAE,EAAE,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,eAAY,AAAD;IAC1B,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACjD,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAqB;IAChE,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAc,EAAE;IACzD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;wCAAE;YACR,IAAI,CAAC,UAAU;YAEf,MAAM;8DAAgB;oBAClB,WAAW;oBACX,IAAI;wBACA,MAAM,UAAU;4BACZ,mBAAmB;4BACnB,kBAAkB,WAAW;wBACjC;wBAEA,gDAAgD;wBAChD,MAAM,YAAY,MAAM,MAAM,CAAC,QAAQ,EAAE,kBAAkB,YAAY,EAAE,SAAS,QAAQ,EAAE,0HAAA,CAAA,iBAAc,EAAE,EAAE;4BAAE;wBAAQ;wBACxH,IAAI,UAAU,EAAE,EAAE;4BACd,MAAM,OAAO,MAAM,UAAU,IAAI;4BACjC,IAAI,KAAK,QAAQ,EAAE,CAAC,EAAE,EAAE;gCACpB,MAAM,aAAa,KAAK,QAAQ,CAAC,EAAE;gCACnC,cAAc;gCACd,MAAM,OAAO,WAAW,MAAM,CAAC,IAAI;gCAEnC,qCAAqC;gCACrC,IAAI,IAAI;oCACH,MAAM,mBAAmB,CAAA,GAAA,sKAAA,CAAA,MAAG,AAAD,EAAE,IAAI,wBAAwB,OAAO;oCAChE,IAAI;wCACA,MAAM,oBAAoB,MAAM,CAAA,GAAA,sKAAA,CAAA,SAAM,AAAD,EAAE;wCACvC,IAAI,kBAAkB,MAAM,IAAI;4CAC5B,gBAAgB,kBAAkB,IAAI,GAAG,UAAU;wCACvD,OAAO;4CACJ,gBAAgB;wCACnB;oCACJ,EAAE,OAAO,OAAO;wCACb,MAAM,kBAAkB,IAAI,4HAAA,CAAA,2BAAwB,CAAC;4CACjD,MAAM,iBAAiB,IAAI;4CAC3B,WAAW;wCACf;wCACA,sIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,oBAAoB;wCACtC,gBAAgB,OAAO,4BAA4B;oCACtD;gCACL,OAAO;oCACH,gBAAgB;gCACpB;4BACJ;wBACJ;wBAEA,yCAAyC;wBACzC,MAAM,cAAc,MAAM,MAAM,CAAC,QAAQ,EAAE,kBAAkB,kBAAkB,EAAE,UAAU,EAAE;4BAAE;wBAAQ;wBACvG,IAAI,YAAY,EAAE,EAAE;4BACf,MAAM,OAAO,MAAM,YAAY,IAAI;4BACnC,aAAa,KAAK,QAAQ,IAAI,EAAE;wBACrC;oBAEJ,EAAE,OAAO,OAAO;wBACZ,QAAQ,KAAK,CAAC,+BAA+B;oBACjD,SAAU;wBACN,WAAW;oBACf;gBACJ;;YAEA;QAEF;uCAAG;QAAC;QAAI;KAAS;IAEjB,IAAG,SAAS;QACT,qBACG,6LAAC;YAAI,WAAU;;8BACX,6LAAC,qIAAA,CAAA,eAAY;oBAAC,OAAM;oBAAkB,QAAQ;oBAAQ,WAAW;;;;;;8BAChE,6LAAC;oBAAI,WAAU;;sCACZ,6LAAC,uIAAA,CAAA,WAAQ;4BAAC,WAAU;;;;;;sCACpB,6LAAC,uIAAA,CAAA,WAAQ;4BAAC,WAAU;;;;;;sCACpB,6LAAC,uIAAA,CAAA,WAAQ;4BAAC,WAAU;;;;;;;;;;;;;;;;;;IAIlC;IAEA,IAAG,CAAC,YAAY;QACb,qBACG,6LAAC;YAAI,WAAU;;8BACX,6LAAC,qIAAA,CAAA,eAAY;oBAAC,OAAM;oBAAM,QAAQ;oBAAQ,WAAW;;;;;;8BACrD,6LAAC;oBAAE,WAAU;8BAAkB;;;;;;;;;;;;IAGzC;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,qIAAA,CAAA,eAAY;gBACX,OAAO;gBACP,QAAQ;gBACR,WAAW;;;;;;0BAGb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAa,QAAQ;4BAAC,GAAG,WAAW,MAAM;4BAAE,MAAM;wBAAY;;;;;;kCAC/D,6LAAC;wBAAiB,YAAY,WAAW,UAAU;wBAAE,UAAU;;;;;;kCAC/D,6LAAC;wBAAc,WAAW;wBAAW,UAAU;;;;;;;;;;;;;;;;;;AAIvD;IA1GgB;;QACC,+HAAA,CAAA,eAAY;;;MADb","debugId":null}},
    {"offset": {"line": 6274, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/AdminFavoriteTeamScreen.tsx"],"sourcesContent":["\n\n\"use client\";\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Loader2 } from 'lucide-react';\nimport type { Fixture } from '@/lib/types';\nimport { useToast } from '@/hooks/use-toast';\nimport { FixtureItem } from '@/components/FixtureItem';\nimport { CURRENT_SEASON } from '@/lib/constants';\nimport { isMatchLive } from '@/lib/matchStatus';\nimport { Card, CardContent } from '@/components/ui/card';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\n// --- Main Screen Component ---\nexport function AdminFavoriteTeamScreen({ navigate, goBack, canGoBack, teamId, teamName }: ScreenProps & { teamId: number; teamName: string; }) {\n    const [allFixtures, setAllFixtures] = useState<Fixture[]>([]);\n    const [loading, setLoading] = useState(true);\n    const { toast } = useToast();\n    const listRef = useRef<HTMLDivElement>(null);\n    const firstUpcomingMatchRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        const fetchFixtures = async () => {\n            if (!teamId) {\n                setLoading(false);\n                return\n            };\n            setLoading(true);\n            try {\n                const url = `https://${API_FOOTBALL_HOST}/fixtures?team=${teamId}&season=${CURRENT_SEASON}`;\n                const res = await fetch(url, {\n                    headers: {\n                        'x-rapidapi-host': API_FOOTBALL_HOST,\n                        'x-rapidapi-key': API_KEY || '',\n                    },\n                });\n                if (!res.ok) throw new Error(`API fetch failed with status: ${res.status}`);\n                \n                const data = await res.json();\n                const fixtures: Fixture[] = data.response || [];\n                // Sort all fixtures chronologically\n                fixtures.sort((a, b) => a.fixture.timestamp - b.fixture.timestamp);\n                setAllFixtures(fixtures);\n            } catch (error) {\n                console.error(\"Error fetching fixtures:\", error);\n                toast({\n                    variant: \"destructive\",\n                    title: \"خطأ في الشبكة\",\n                    description: \"فشل في جلب المباريات. يرجى التحقق من اتصالك بالإنترنت.\",\n                });\n            } finally {\n                setLoading(false);\n            }\n        };\n        fetchFixtures();\n    }, [teamId, toast]);\n\n    // This effect handles scrolling to the first upcoming match\n    useEffect(() => {\n        if (!loading && allFixtures.length > 0 && listRef.current && firstUpcomingMatchRef.current) {\n            // Use a small timeout to ensure the DOM is ready for scrolling\n            setTimeout(() => {\n                if (firstUpcomingMatchRef.current && listRef.current) {\n                    const listTop = listRef.current.offsetTop;\n                    const itemTop = firstUpcomingMatchRef.current.offsetTop;\n                    // Scroll the list so that the upcoming match is near the top\n                    listRef.current.scrollTop = itemTop - listTop - 10;\n                }\n            }, 100);\n        }\n    }, [loading, allFixtures]);\n\n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader title={teamName} onBack={goBack} canGoBack={canGoBack} />\n            <div ref={listRef} className=\"flex-1 overflow-y-auto p-2\">\n                {loading ? (\n                    <div className=\"flex items-center justify-center h-64\">\n                        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                    </div>\n                ) : allFixtures.length > 0 ? (\n                    <div className=\"space-y-2\">\n                        {allFixtures.map((fixture, index) => {\n                             const isUpcomingOrLive = isMatchLive(fixture.fixture.status) || new Date(fixture.fixture.timestamp * 1000) > new Date();\n                             // Find the very first upcoming/live match in the sorted list\n                             const isFirstUpcoming = isUpcomingOrLive && !allFixtures.slice(0, index).some(f => isMatchLive(f.fixture.status) || new Date(f.fixture.timestamp * 1000) > new Date());\n                            \n                            return (\n                                <div key={fixture.fixture.id} ref={isFirstUpcoming ? firstUpcomingMatchRef : null}>\n                                    <FixtureItem fixture={fixture} navigate={navigate} />\n                                </div>\n                            );\n                        })}\n                    </div>\n                ) : (\n                    <Card className=\"mt-4\">\n                        <CardContent className=\"p-6\">\n                            <p className=\"text-center text-muted-foreground\">لا توجد مباريات متاحة لهذا الفريق.</p>\n                        </CardContent>\n                    </Card>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6477, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/ProfileScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useEffect } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { useAuth, useFirestore } from '@/firebase/provider';\nimport { updateUserDisplayName } from '@/lib/firebase-client';\nimport { useToast } from '@/hooks/use-toast';\nimport { Loader2, Copy } from 'lucide-react';\nimport { doc, onSnapshot } from 'firebase/firestore';\nimport type { UserProfile } from '@/lib/types';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport function ProfileScreen({ navigate, goBack, canGoBack, headerActions, isNewUserFlow = false, onFlowComplete }: ScreenProps & { isNewUserFlow?: boolean, onFlowComplete?: () => void }) {\n  const { user } = useAuth();\n  const { db } = useFirestore();\n  const { toast } = useToast();\n  \n  const [profile, setProfile] = useState<UserProfile | null>(null);\n  const [displayName, setDisplayName] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n\n  useEffect(() => {\n    if (!user || !db) {\n        setLoading(false);\n        return;\n    };\n    \n    setLoading(true);\n    const unsub = onSnapshot(doc(db, 'users', user.uid), (doc) => {\n        if (doc.exists()) {\n            const data = doc.data() as UserProfile;\n            setProfile(data);\n            setDisplayName(data.displayName || '');\n        }\n        setLoading(false);\n    });\n\n    return () => unsub();\n\n  }, [user, db]);\n\n  const handleSave = async () => {\n    if (!user || !displayName.trim() || displayName.trim().length < 3) {\n      toast({\n        variant: 'destructive',\n        title: 'خطأ',\n        description: 'يجب أن يتكون اسم العرض من 3 أحرف على الأقل.',\n      });\n      return;\n    }\n    if (!db) {\n      toast({\n        variant: 'destructive',\n        title: 'خطأ',\n        description: 'خدمة قاعدة البيانات غير متاحة حاليًا.',\n      });\n      return;\n    }\n    \n    setSaving(true);\n    try {\n      await updateUserDisplayName(user, displayName.trim(), db);\n      toast({\n        title: 'تم الحفظ بنجاح',\n        description: 'تم تحديث اسم العرض الخاص بك.',\n      });\n      if (isNewUserFlow && onFlowComplete) {\n        onFlowComplete();\n      }\n    } catch (error) {\n      console.error(\"Error updating display name:\", error);\n      toast({\n        variant: 'destructive',\n        title: 'فشل التحديث',\n        description: 'حدث خطأ أثناء تحديث اسمك. يرجى المحاولة مرة أخرى.',\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast({\n        title: 'تم النسخ',\n        description: 'تم نسخ معرّف المستخدم بنجاح.',\n    });\n  }\n  \n  const isAnonymousUser = user?.isAnonymous;\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader title=\"الملف الشخصي\" onBack={goBack} canGoBack={!isNewUserFlow && canGoBack} actions={headerActions} />\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {loading ? (\n          <Card>\n            <CardHeader className=\"items-center text-center\">\n                 <Skeleton className=\"h-24 w-24 rounded-full\" />\n                 <div className=\"w-full space-y-2 pt-2\">\n                    <Skeleton className=\"h-6 w-40 mx-auto\" />\n                    <Skeleton className=\"h-4 w-60 mx-auto\" />\n                 </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                    <Skeleton className=\"h-5 w-24\" />\n                    <Skeleton className=\"h-10 w-full\" />\n                </div>\n                 <Skeleton className=\"h-10 w-full\" />\n            </CardContent>\n          </Card>\n        ) : profile ? (\n          <>\n            <Card>\n              <CardHeader className=\"items-center text-center\">\n                <Avatar className=\"h-24 w-24 border-2 border-primary mb-4\">\n                  <AvatarImage src={profile.photoURL} alt={profile.displayName} />\n                  <AvatarFallback>{profile.displayName?.charAt(0)}</AvatarFallback>\n                </Avatar>\n                <CardTitle>{isNewUserFlow ? \"اختر اسم العرض الخاص بك\" : profile.displayName}</CardTitle>\n                <CardDescription>{isAnonymousUser ? 'حساب زائر' : profile.email}</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"displayName\">اسم العرض</Label>\n                  <Input\n                    id=\"displayName\"\n                    value={displayName}\n                    onChange={(e) => setDisplayName(e.target.value)}\n                    placeholder=\"اختر اسمًا يظهر للمستخدمين الآخرين\"\n                    disabled={isAnonymousUser}\n                  />\n                   {isAnonymousUser && <p className=\"text-xs text-muted-foreground\">لا يمكن للزوار تغيير اسم العرض. قم بإنشاء حساب دائم.</p>}\n                </div>\n                <Button onClick={handleSave} disabled={saving || loading || displayName === profile.displayName || isAnonymousUser} className=\"w-full\">\n                  {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : 'حفظ التغييرات'}\n                </Button>\n              </CardContent>\n            </Card>\n\n            {!isNewUserFlow && user && (\n                 <Card>\n                    <CardHeader>\n                        <CardTitle>معلومات فنية</CardTitle>\n                        <CardDescription>\n                            يمكنك استخدام هذا المعرف للبحث عن بياناتك في قاعدة البيانات.\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                        <Label>معرّف المستخدم (User ID)</Label>\n                        <div className=\"flex items-center gap-2\">\n                            <Input \n                                readOnly \n                                value={user.uid} \n                                className=\"text-xs text-muted-foreground\"\n                                dir=\"ltr\"\n                            />\n                            <Button variant=\"outline\" size=\"icon\" onClick={() => copyToClipboard(user.uid)}>\n                                <Copy className=\"h-4 w-4\" />\n                            </Button>\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n          </>\n        ) : (\n            <p className=\"text-center text-muted-foreground pt-8\">لم يتم العثور على ملفك الشخصي.</p>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6931, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/SeasonPredictionsScreen.tsx"],"sourcesContent":["\n\n\"use client\";\n\nimport React from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Card, CardHeader, CardTitle } from '@/components/ui/card';\nimport { PREMIER_LEAGUE_ID, LALIGA_ID, SERIE_A_ID, BUNDESLIGA_ID, CHAMPIONS_LEAGUE_ID } from '@/lib/constants';\n\nconst leagues = [\n    { id: PREMIER_LEAGUE_ID, name: \"الدوري الإنجليزي\", logo: \"https://media.api-sports.io/football/leagues/39.png\" },\n    { id: LALIGA_ID, name: \"الدوري الإسباني\", logo: \"https://media.api-sports.io/football/leagues/140.png\" },\n    { id: SERIE_A_ID, name: \"الدوري الإيطالي\", logo: \"https://media.api-sports.io/football/leagues/135.png\" },\n    { id: BUNDESLIGA_ID, name: \"الدوري الألماني\", logo: \"https://media.api-sports.io/football/leagues/78.png\" },\n    { id: CHAMPIONS_LEAGUE_ID, name: \"دوري أبطال أوروبا\", logo: \"https://media.api-sports.io/football/leagues/2.png\"},\n];\n\n\nexport function SeasonPredictionsScreen({ navigate, goBack, canGoBack, headerActions }: ScreenProps) {\n    \n    const handleLeagueSelect = (leagueId: number, leagueName: string) => {\n        navigate('SeasonTeamSelection', { leagueId, leagueName });\n    };\n\n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader title=\"توقعات الموسم\" onBack={goBack} canGoBack={true} />\n            <div className=\"flex-1 overflow-y-auto p-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                    {leagues.map(league => (\n                        <Card \n                            key={league.id} \n                            className=\"cursor-pointer hover:bg-accent/50 transition-colors\"\n                            onClick={() => handleLeagueSelect(league.id, league.name)}\n                        >\n                            <CardHeader className=\"items-center text-center\">\n                                <img src={league.logo} alt={league.name} className=\"w-20 h-20 object-contain mb-4\" />\n                                <CardTitle className=\"text-base\">{league.name}</CardTitle>\n                            </CardHeader>\n                        </Card>\n                    ))}\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;AAMA;AACA;AACA;AANA;;;;;AAQA,MAAM,UAAU;IACZ;QAAE,IAAI,0HAAA,CAAA,oBAAiB;QAAE,MAAM;QAAoB,MAAM;IAAsD;IAC/G;QAAE,IAAI,0HAAA,CAAA,YAAS;QAAE,MAAM;QAAmB,MAAM;IAAuD;IACvG;QAAE,IAAI,0HAAA,CAAA,aAAU;QAAE,MAAM;QAAmB,MAAM;IAAuD;IACxG;QAAE,IAAI,0HAAA,CAAA,gBAAa;QAAE,MAAM;QAAmB,MAAM;IAAsD;IAC1G;QAAE,IAAI,0HAAA,CAAA,sBAAmB;QAAE,MAAM;QAAqB,MAAM;IAAoD;CACnH;AAGM,SAAS,wBAAwB,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAE,aAAa,EAAe;IAE/F,MAAM,qBAAqB,CAAC,UAAkB;QAC1C,SAAS,uBAAuB;YAAE;YAAU;QAAW;IAC3D;IAEA,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC,qIAAA,CAAA,eAAY;gBAAC,OAAM;gBAAgB,QAAQ;gBAAQ,WAAW;;;;;;0BAC/D,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;8BACV,QAAQ,GAAG,CAAC,CAAA,uBACT,6LAAC,mIAAA,CAAA,OAAI;4BAED,WAAU;4BACV,SAAS,IAAM,mBAAmB,OAAO,EAAE,EAAE,OAAO,IAAI;sCAExD,cAAA,6LAAC,mIAAA,CAAA,aAAU;gCAAC,WAAU;;kDAClB,6LAAC;wCAAI,KAAK,OAAO,IAAI;wCAAE,KAAK,OAAO,IAAI;wCAAE,WAAU;;;;;;kDACnD,6LAAC,mIAAA,CAAA,YAAS;wCAAC,WAAU;kDAAa,OAAO,IAAI;;;;;;;;;;;;2BAN5C,OAAO,EAAE;;;;;;;;;;;;;;;;;;;;;AAc1C;KA3BgB","debugId":null}},
    {"offset": {"line": 7056, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/SeasonTeamSelectionScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { useAuth, useFirestore } from '@/firebase/provider';\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\nimport type { Team, SeasonPrediction } from '@/lib/types';\nimport { CURRENT_SEASON } from '@/lib/constants';\nimport { Loader2, Trophy, Check } from 'lucide-react';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\ninterface SeasonTeamSelectionScreenProps extends ScreenProps {\n    leagueId: number;\n    leagueName: string;\n}\n\nconst TeamListItem = React.memo(({ team, isPredictedChampion, onChampionSelect, onTeamClick, disabled }: { team: Team, isPredictedChampion: boolean, onChampionSelect: () => void, onTeamClick: () => void, disabled: boolean }) => {\n    return (\n        <div className=\"flex items-center p-2 border rounded-lg bg-card\">\n            <div \n                className=\"flex-1 flex items-center gap-3 cursor-pointer\"\n                onClick={onTeamClick}\n            >\n                <Avatar className=\"h-8 w-8\"><AvatarImage src={team.logo} /></Avatar>\n                <span className=\"font-semibold\">{team.name}</span>\n            </div>\n            <Button variant=\"ghost\" size=\"icon\" onClick={onChampionSelect} disabled={disabled}>\n                <Trophy className={cn(\"h-6 w-6 text-muted-foreground transition-colors\", isPredictedChampion && \"text-yellow-400 fill-current\")} />\n            </Button>\n        </div>\n    );\n});\nTeamListItem.displayName = 'TeamListItem';\n\n\nexport function SeasonTeamSelectionScreen({ navigate, goBack, canGoBack, headerActions, leagueId, leagueName }: SeasonTeamSelectionScreenProps) {\n    const { user } = useAuth();\n    const { db } = useFirestore();\n    const { toast } = useToast();\n    const [teams, setTeams] = useState<{ team: Team }[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    \n    // Tracks the saved prediction from Firestore\n    const [savedChampionId, setSavedChampionId] = useState<number | undefined>();\n    // Tracks the user's current selection before saving\n    const [stagedChampionId, setStagedChampionId] = useState<number | undefined>();\n    \n    const hasPredictionBeenSaved = !!savedChampionId;\n\n\n    const privatePredictionDocRef = useMemo(() => {\n        if (!user || !db) return null;\n        return doc(db, 'seasonPredictions', `${user.uid}_${leagueId}_${CURRENT_SEASON}`);\n    }, [user, db, leagueId]);\n\n    // Fetch teams\n    useEffect(() => {\n        setLoading(true);\n        const fetchTeams = async () => {\n            try {\n                const res = await fetch(`https://${API_FOOTBALL_HOST}/teams?league=${leagueId}&season=${CURRENT_SEASON}`, {\n                    headers: {\n                        'x-rapidapi-host': API_FOOTBALL_HOST,\n                        'x-rapidapi-key': API_KEY || '',\n                    },\n                });\n                const data = await res.json();\n                const rawTeams = data.response || [];\n                const translatedTeams = rawTeams.map((teamData: { team: Team }) => ({\n                    ...teamData,\n                    team: {\n                        ...teamData.team,\n                        name: hardcodedTranslations.teams[teamData.team.id] || teamData.team.name,\n                    }\n                }));\n                setTeams(translatedTeams);\n            } catch (e) {\n                console.error('Failed to fetch teams:', e);\n                toast({ variant: 'destructive', title: 'خطأ', description: 'فشل في تحميل الفرق.' });\n            } finally {\n                setLoading(false);\n            }\n        };\n        fetchTeams();\n    }, [leagueId, toast]);\n\n    // Fetch existing prediction\n    useEffect(() => {\n        if (!privatePredictionDocRef) return;\n        getDoc(privatePredictionDocRef)\n            .then(docSnap => {\n                if (docSnap.exists()) {\n                    const data = docSnap.data() as SeasonPrediction;\n                    if(data.predictedChampionId) {\n                        setSavedChampionId(data.predictedChampionId);\n                        setStagedChampionId(data.predictedChampionId);\n                    }\n                }\n            })\n            .catch(error => {\n                const permissionError = new FirestorePermissionError({ path: privatePredictionDocRef.path, operation: 'get' });\n                errorEmitter.emit('permission-error', permissionError);\n            });\n    }, [privatePredictionDocRef]);\n    \n    const handleStagingSelect = (teamId: number) => {\n        if (hasPredictionBeenSaved) {\n            toast({\n                variant: 'destructive',\n                title: 'التوقع مقفل',\n                description: 'لقد قمت بتثبيت توقعك لهذا الموسم ولا يمكن تغييره.',\n            });\n            return;\n        }\n        setStagedChampionId(prev => prev === teamId ? undefined : teamId);\n    };\n\n\n    const handleSavePrediction = useCallback(async () => {\n        if (hasPredictionBeenSaved || !stagedChampionId || !privatePredictionDocRef || !user || !db) return;\n        \n        setSaving(true);\n\n        const privateData: Partial<SeasonPrediction> = {\n            userId: user.uid,\n            leagueId,\n            leagueName,\n            season: CURRENT_SEASON,\n            predictedChampionId: stagedChampionId,\n            timestamp: new Date()\n        };\n        \n        // Ensure the document exists before updating\n        await setDoc(privatePredictionDocRef, {}, { merge: true });\n\n        setDoc(privatePredictionDocRef, privateData, { merge: true })\n            .then(() => {\n                toast({\n                    title: 'تم حفظ التوقع',\n                    description: 'تم تسجيل توقعك لبطل الموسم بنجاح.',\n                });\n                setSavedChampionId(stagedChampionId);\n            })\n            .catch((serverError) => {\n                const permissionError = new FirestorePermissionError({\n                    path: privatePredictionDocRef.path,\n                    operation: 'update',\n                    requestResourceData: privateData\n                });\n                errorEmitter.emit('permission-error', permissionError);\n            })\n            .finally(() => {\n                setSaving(false);\n            });\n\n    }, [stagedChampionId, privatePredictionDocRef, user, db, leagueId, leagueName, hasPredictionBeenSaved, toast]);\n\n\n    const handleTeamClick = (teamId: number, teamName: string) => {\n        navigate('SeasonPlayerSelection', { leagueId, leagueName, teamId, teamName });\n    };\n\n    const showSaveButton = !hasPredictionBeenSaved && stagedChampionId !== undefined;\n\n    if (loading) {\n        return (\n            <div className=\"flex h-full flex-col bg-background\">\n                <ScreenHeader title={`اختيار بطل ${leagueName}`} onBack={goBack} canGoBack={true} />\n                <div className=\"flex justify-center p-8\"><Loader2 className=\"h-8 w-8 animate-spin\" /></div>\n            </div>\n        );\n    }\n    \n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader title={`توقع بطل ${leagueName}`} onBack={goBack} canGoBack={true} />\n            <div className='p-4 text-center text-sm text-muted-foreground border-b'>\n                 <p>\n                    {hasPredictionBeenSaved \n                        ? 'لقد قمت بتثبيت توقعك لهذا الدوري. يمكنك الآن اختيار الهداف.'\n                        : 'اختر الفريق البطل بالضغط على أيقونة الكأس.'\n                    }\n                </p>\n                <p className=\"mt-2\">ثم اضغط على أي فريق لاختيار الهداف من لاعبيه.</p>\n            </div>\n            <div className=\"flex-1 overflow-y-auto space-y-2 p-4\">\n                {teams.length > 0 ? (\n                     teams.map(({team}) => {\n                        if (!team) return null;\n                        return(\n                            <TeamListItem\n                                key={team.id}\n                                team={team}\n                                isPredictedChampion={stagedChampionId === team.id}\n                                onChampionSelect={() => handleStagingSelect(team.id)}\n                                onTeamClick={() => handleTeamClick(team.id, team.name)}\n                                disabled={hasPredictionBeenSaved && stagedChampionId !== team.id}\n                            />\n                        )\n                    })\n                ) : (\n                    <p className=\"text-center pt-8 text-muted-foreground\">لا توجد فرق متاحة لهذا الدوري.</p>\n                )}\n            </div>\n            \n            {showSaveButton && (\n                <div className=\"p-4 border-t bg-background/90 backdrop-blur-sm sticky bottom-0\">\n                    <Button className=\"w-full\" size=\"lg\" onClick={handleSavePrediction} disabled={saving}>\n                        {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <><Check className=\"mr-2 h-4 w-4\" /> حفظ التوقع</>}\n                    </Button>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 7481, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/SeasonPlayerSelectionScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { useAuth, useFirestore } from '@/firebase/provider';\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\nimport type { Player, SeasonPrediction } from '@/lib/types';\nimport { CURRENT_SEASON } from '@/lib/constants';\nimport { Loader2, Check } from 'lucide-react';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { FootballIcon } from '@/components/icons/FootballIcon';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\ninterface SeasonPlayerSelectionScreenProps extends ScreenProps {\n    leagueId: number;\n    leagueName: string;\n    teamId: number;\n    teamName:string;\n}\n\ninterface PlayerResponse {\n    player: Player;\n    statistics: any[];\n}\n\n\nconst PlayerListItem = React.memo(({ player, isPredictedTopScorer, onScorerSelect, disabled }: { player: Player, isPredictedTopScorer: boolean, onScorerSelect: (playerId: number) => void, disabled: boolean }) => {\n    return (\n        <div className=\"flex items-center p-2 border rounded-lg bg-card\">\n             <div className=\"flex-1 flex items-center gap-3\">\n                <Avatar className=\"h-10 w-10\"><AvatarImage src={player.photo} /></Avatar>\n                <div>\n                   <p className=\"font-semibold\">{player.name}</p>\n                   <p className=\"text-xs text-muted-foreground\">{player.position}</p>\n                </div>\n            </div>\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => onScorerSelect(player.id)} disabled={disabled}>\n                <FootballIcon className={cn(\"h-6 w-6 text-muted-foreground transition-colors\", isPredictedTopScorer && \"text-yellow-400\")} />\n            </Button>\n        </div>\n    );\n});\nPlayerListItem.displayName = 'PlayerListItem';\n\n\nexport function SeasonPlayerSelectionScreen({ navigate, goBack, canGoBack, headerActions, leagueId, leagueName, teamId, teamName }: SeasonPlayerSelectionScreenProps) {\n    const { user } = useAuth();\n    const { db } = useFirestore();\n    const { toast } = useToast();\n    const [players, setPlayers] = useState<PlayerResponse[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    \n    const [savedTopScorerId, setSavedTopScorerId] = useState<number | undefined>();\n    const [stagedTopScorerId, setStagedTopScorerId] = useState<number | undefined>();\n\n    const hasPredictionBeenSaved = !!savedTopScorerId;\n\n\n    const privatePredictionDocRef = useMemo(() => {\n        if (!user || !db) return null;\n        return doc(db, 'seasonPredictions', `${user.uid}_${leagueId}_${CURRENT_SEASON}`);\n    }, [user, db, leagueId]);\n\n    // Fetch players with pagination\n    useEffect(() => {\n        const fetchAllPlayers = async () => {\n            setLoading(true);\n            const playerMap = new Map<number, PlayerResponse>();\n            let currentPage = 1;\n            let totalPages = 1;\n\n            try {\n                while (currentPage <= totalPages) {\n                    const res = await fetch(`https://${API_FOOTBALL_HOST}/players?team=${teamId}&season=${CURRENT_SEASON}&page=${currentPage}`, {\n                        headers: {\n                            'x-rapidapi-host': API_FOOTBALL_HOST,\n                            'x-rapidapi-key': API_KEY || '',\n                        },\n                    });\n                    const data = await res.json();\n                    \n                    if (data.response) {\n                        data.response.forEach((playerResponse: PlayerResponse) => {\n                            if (!playerMap.has(playerResponse.player.id)) {\n                                const translatedPlayer = {\n                                    ...playerResponse,\n                                    player: {\n                                        ...playerResponse.player,\n                                        name: hardcodedTranslations.players[playerResponse.player.id] || playerResponse.player.name\n                                    }\n                                };\n                                playerMap.set(playerResponse.player.id, translatedPlayer);\n                            }\n                        });\n                    }\n\n                    if (data.paging && data.paging.total > currentPage) {\n                        totalPages = data.paging.total;\n                        currentPage++;\n                    } else {\n                        break;\n                    }\n                }\n                setPlayers(Array.from(playerMap.values()));\n            } catch (e) {\n                console.error('Failed to fetch players:', e);\n                toast({ variant: 'destructive', title: 'خطأ', description: 'فشل في تحميل اللاعبين.' });\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchAllPlayers();\n    }, [teamId, toast]);\n\n    // Fetch existing prediction\n    useEffect(() => {\n        if (!privatePredictionDocRef) return;\n        getDoc(privatePredictionDocRef)\n            .then(docSnap => {\n                if (docSnap.exists()) {\n                    const data = docSnap.data() as SeasonPrediction;\n                    if(data.predictedTopScorerId) {\n                        setSavedTopScorerId(data.predictedTopScorerId);\n                        setStagedTopScorerId(data.predictedTopScorerId);\n                    }\n                }\n            })\n            .catch(error => {\n                const permissionError = new FirestorePermissionError({ path: privatePredictionDocRef.path, operation: 'get' });\n                errorEmitter.emit('permission-error', permissionError);\n            });\n    }, [privatePredictionDocRef]);\n    \n    const handleStagingSelect = (playerId: number) => {\n        if (hasPredictionBeenSaved) {\n             toast({\n                variant: 'destructive',\n                title: 'التوقع مقفل',\n                description: 'لقد قمت بتثبيت توقعك لهذا الموسم ولا يمكن تغييره.',\n            });\n            return;\n        }\n        setStagedTopScorerId(prev => prev === playerId ? undefined : playerId);\n    };\n\n    const handleSavePrediction = useCallback(async () => {\n        if (hasPredictionBeenSaved || !stagedTopScorerId || !privatePredictionDocRef || !user || !db) return;\n        \n        setSaving(true);\n        const privateData: Partial<SeasonPrediction> = {\n            userId: user.uid,\n            leagueId: leagueId,\n            leagueName: leagueName,\n            season: CURRENT_SEASON,\n            predictedTopScorerId: stagedTopScorerId,\n            timestamp: new Date(),\n        };\n\n        // Ensure the document exists before updating\n        await setDoc(privatePredictionDocRef, {}, { merge: true });\n\n        setDoc(privatePredictionDocRef, privateData, { merge: true })\n            .then(() => {\n                toast({\n                    title: 'تم حفظ التوقع',\n                    description: 'تم تسجيل توقعك لهداف الموسم بنجاح.',\n                });\n                setSavedTopScorerId(stagedTopScorerId);\n            })\n            .catch((serverError) => {\n                const permissionError = new FirestorePermissionError({\n                    path: privatePredictionDocRef.path,\n                    operation: 'update',\n                    requestResourceData: privateData\n                });\n                errorEmitter.emit('permission-error', permissionError);\n            })\n            .finally(() => {\n                setSaving(false);\n            });\n\n    }, [stagedTopScorerId, privatePredictionDocRef, user, db, leagueId, leagueName, hasPredictionBeenSaved, toast]);\n\n    const showSaveButton = !hasPredictionBeenSaved && stagedTopScorerId !== undefined;\n\n\n    if (loading) {\n        return (\n            <div className=\"flex h-full flex-col bg-background\">\n                <ScreenHeader title={`اختيار هداف من ${teamName}`} onBack={goBack} canGoBack={true} />\n                <div className=\"flex justify-center p-8\"><Loader2 className=\"h-8 w-8 animate-spin\" /></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader title={`اختيار هداف من ${teamName}`} onBack={goBack} canGoBack={true} />\n             <div className='p-4 text-center text-sm text-muted-foreground border-b'>\n                <p>\n                    {hasPredictionBeenSaved\n                        ? 'لقد قمت بتثبيت توقعك لهداف هذا الدوري.'\n                        : 'اختر الهداف المتوقع للدوري بالضغط على أيقونة الكرة.'}\n                </p>\n            </div>\n            <div className=\"flex-1 overflow-y-auto space-y-2 p-4\">\n                {players.length > 0 ? (\n                     players.map(playerResponse => {\n                        const { player } = playerResponse;\n                        if (!player) return null;\n                        return (\n                            <PlayerListItem\n                                key={player.id}\n                                player={player}\n                                isPredictedTopScorer={stagedTopScorerId === player.id}\n                                onScorerSelect={handleStagingSelect}\n                                disabled={hasPredictionBeenSaved && stagedTopScorerId !== player.id}\n                            />\n                        )\n                     })\n                ) : (\n                    <p className=\"text-center pt-8 text-muted-foreground\">لا يوجد لاعبون متاحون لهذا الفريق.</p>\n                )}\n            </div>\n\n            {showSaveButton && (\n                <div className=\"p-4 border-t bg-background/90 backdrop-blur-sm sticky bottom-0\">\n                    <Button className=\"w-full\" size=\"lg\" onClick={handleSavePrediction} disabled={saving}>\n                        {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <><Check className=\"mr-2 h-4 w-4\" /> حفظ توقع الهداف</>}\n                    </Button>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 7919, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/AddEditNewsScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, setDoc, addDoc, collection } from 'firebase/firestore';\nimport { useToast } from '@/hooks/use-toast';\nimport { Loader2, Upload } from 'lucide-react';\nimport type { NewsArticle } from '@/lib/types';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport Image from 'next/image';\n\ninterface AddEditNewsScreenProps extends ScreenProps {\n  article?: NewsArticle;\n  isEditing: boolean;\n}\n\nexport function AddEditNewsScreen({ goBack, canGoBack, article, isEditing }: AddEditNewsScreenProps) {\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [imageUrl, setImageUrl] = useState('');\n  const [imageHint, setImageHint] = useState('');\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\n  const [saving, setSaving] = useState(false);\n  const { db } = useFirestore();\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n\n  useEffect(() => {\n    if (isEditing && article) {\n      setTitle(article.title);\n      setContent(article.content);\n      setImageUrl(article.imageUrl || '');\n      setImageHint(article.imageHint || '');\n      setImagePreview(article.imageUrl || null);\n    }\n  }, [isEditing, article]);\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      setSelectedFile(file);\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setImagePreview(reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleSave = async () => {\n    if (!title.trim() || !content.trim()) {\n      toast({\n        variant: 'destructive',\n        title: 'خطأ',\n        description: 'الرجاء ملء حقلي العنوان والمحتوى.',\n      });\n      return;\n    }\n    if (!db) return;\n\n    setSaving(true);\n    let finalImageUrl: string | undefined = imageUrl.trim() || undefined;\n\n    if (selectedFile) {\n        // If a file is selected, its preview (Data URI) becomes the image URL\n        finalImageUrl = imagePreview || undefined;\n    }\n\n    const newsData: Omit<NewsArticle, 'id'> = {\n      title: title.trim(),\n      content: content.trim(),\n      timestamp: new Date(),\n      ...(finalImageUrl && { imageUrl: finalImageUrl }),\n      ...(imageHint.trim() && { imageHint: imageHint.trim() }),\n    };\n\n    const collectionRef = collection(db, 'news');\n    const operation = isEditing && article?.id \n        ? setDoc(doc(collectionRef, article.id), newsData, { merge: true })\n        : addDoc(collectionRef, newsData);\n\n    operation.then(() => {\n        toast({ title: 'نجاح', description: isEditing ? 'تم تحديث الخبر بنجاح.' : 'تم نشر الخبر بنجاح.' });\n        goBack();\n    }).catch(serverError => {\n        const permissionError = new FirestorePermissionError({\n            path: isEditing && article?.id ? `news/${article.id}` : 'news',\n            operation: isEditing ? 'update' : 'create',\n            requestResourceData: newsData,\n        });\n        errorEmitter.emit('permission-error', permissionError);\n    }).finally(() => {\n        setSaving(false);\n    });\n  };\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader title={isEditing ? 'تعديل الخبر' : 'إضافة خبر جديد'} onBack={goBack} canGoBack={true} />\n      <div className=\"flex-1 overflow-y-auto p-4\">\n        <Card>\n          <CardContent className=\"space-y-6 pt-6\">\n\n             {imagePreview && (\n              <div className=\"relative aspect-video w-full\">\n                <Image src={imagePreview} alt=\"معاينة الصورة\" fill className=\"rounded-md object-cover\" />\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"title\">العنوان</Label>\n              <Input id=\"title\" value={title} onChange={(e) => setTitle(e.target.value)} placeholder=\"عنوان الخبر الرئيسي\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"content\">المحتوى</Label>\n              <Textarea id=\"content\" value={content} onChange={(e) => setContent(e.target.value)} placeholder=\"اكتب تفاصيل الخبر هنا...\" rows={10} />\n            </div>\n           \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"imageUrl\">رابط الصورة (اختياري)</Label>\n              <Input id=\"imageUrl\" value={imageUrl} onChange={(e) => setImageUrl(e.target.value)} placeholder=\"https://example.com/image.jpg\" dir=\"ltr\" disabled={!!selectedFile} />\n            </div>\n            \n            <div className=\"relative flex items-center\">\n              <div className=\"flex-grow border-t border-muted\"></div>\n              <span className=\"flex-shrink mx-4 text-xs text-muted-foreground\">أو</span>\n              <div className=\"flex-grow border-t border-muted\"></div>\n            </div>\n\n            <div className=\"space-y-2\">\n                <Label htmlFor=\"fileUpload\">رفع صورة من الجهاز (اختياري)</Label>\n                <Button variant=\"outline\" className=\"w-full\" onClick={() => fileInputRef.current?.click()}>\n                    <Upload className=\"ml-2 h-4 w-4\"/>\n                    {selectedFile ? `تم اختيار: ${selectedFile.name}` : \"اختيار ملف\"}\n                </Button>\n                <Input \n                    id=\"fileUpload\"\n                    type=\"file\" \n                    ref={fileInputRef} \n                    onChange={handleFileChange} \n                    className=\"hidden\"\n                    accept=\"image/*\"\n                />\n            </div>\n            \n             <div className=\"space-y-2\">\n              <Label htmlFor=\"imageHint\">تلميح للصورة (اختياري)</Label>\n              <Input id=\"imageHint\" value={imageHint} onChange={(e) => setImageHint(e.target.value)} placeholder=\"مثال: football match\" />\n               <p className=\"text-xs text-muted-foreground\">كلمتان كحد أقصى لوصف الصورة لمساعدة الذكاء الاصطناعي.</p>\n            </div>\n\n            <Button onClick={handleSave} disabled={saving} className=\"w-full\">\n              {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : (isEditing ? 'حفظ التعديلات' : 'نشر الخبر')}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAEA;AACA;AACA;;;AAjBA;;;;;;;;;;;;;;;AAwBO,SAAS,kBAAkB,EAAE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,SAAS,EAA0B;;IACjG,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC3C,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAe;IAC9D,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IAChE,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,EAAE,EAAE,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,eAAY,AAAD;IAC1B,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,WAAQ,AAAD;IACzB,MAAM,eAAe,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAoB;IAG9C,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;uCAAE;YACR,IAAI,aAAa,SAAS;gBACxB,SAAS,QAAQ,KAAK;gBACtB,WAAW,QAAQ,OAAO;gBAC1B,YAAY,QAAQ,QAAQ,IAAI;gBAChC,aAAa,QAAQ,SAAS,IAAI;gBAClC,gBAAgB,QAAQ,QAAQ,IAAI;YACtC;QACF;sCAAG;QAAC;QAAW;KAAQ;IAEvB,MAAM,mBAAmB,CAAC;QACxB,MAAM,OAAO,MAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QACpC,IAAI,MAAM;YACR,gBAAgB;YAChB,MAAM,SAAS,IAAI;YACnB,OAAO,SAAS,GAAG;gBACjB,gBAAgB,OAAO,MAAM;YAC/B;YACA,OAAO,aAAa,CAAC;QACvB;IACF;IAEA,MAAM,aAAa;QACjB,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,QAAQ,IAAI,IAAI;YACpC,MAAM;gBACJ,SAAS;gBACT,OAAO;gBACP,aAAa;YACf;YACA;QACF;QACA,IAAI,CAAC,IAAI;QAET,UAAU;QACV,IAAI,gBAAoC,SAAS,IAAI,MAAM;QAE3D,IAAI,cAAc;YACd,sEAAsE;YACtE,gBAAgB,gBAAgB;QACpC;QAEA,MAAM,WAAoC;YACxC,OAAO,MAAM,IAAI;YACjB,SAAS,QAAQ,IAAI;YACrB,WAAW,IAAI;YACf,GAAI,iBAAiB;gBAAE,UAAU;YAAc,CAAC;YAChD,GAAI,UAAU,IAAI,MAAM;gBAAE,WAAW,UAAU,IAAI;YAAG,CAAC;QACzD;QAEA,MAAM,gBAAgB,CAAA,GAAA,sKAAA,CAAA,aAAU,AAAD,EAAE,IAAI;QACrC,MAAM,YAAY,aAAa,SAAS,KAClC,CAAA,GAAA,sKAAA,CAAA,SAAM,AAAD,EAAE,CAAA,GAAA,sKAAA,CAAA,MAAG,AAAD,EAAE,eAAe,QAAQ,EAAE,GAAG,UAAU;YAAE,OAAO;QAAK,KAC/D,CAAA,GAAA,sKAAA,CAAA,SAAM,AAAD,EAAE,eAAe;QAE5B,UAAU,IAAI,CAAC;YACX,MAAM;gBAAE,OAAO;gBAAQ,aAAa,YAAY,0BAA0B;YAAsB;YAChG;QACJ,GAAG,KAAK,CAAC,CAAA;YACL,MAAM,kBAAkB,IAAI,4HAAA,CAAA,2BAAwB,CAAC;gBACjD,MAAM,aAAa,SAAS,KAAK,CAAC,KAAK,EAAE,QAAQ,EAAE,EAAE,GAAG;gBACxD,WAAW,YAAY,WAAW;gBAClC,qBAAqB;YACzB;YACA,sIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,oBAAoB;QAC1C,GAAG,OAAO,CAAC;YACP,UAAU;QACd;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,qIAAA,CAAA,eAAY;gBAAC,OAAO,YAAY,gBAAgB;gBAAkB,QAAQ;gBAAQ,WAAW;;;;;;0BAC9F,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC,mIAAA,CAAA,OAAI;8BACH,cAAA,6LAAC,mIAAA,CAAA,cAAW;wBAAC,WAAU;;4BAEnB,8BACA,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,gIAAA,CAAA,UAAK;oCAAC,KAAK;oCAAc,KAAI;oCAAgB,IAAI;oCAAC,WAAU;;;;;;;;;;;0CAIjE,6LAAC;gCAAI,WAAU;;kDACb,6LAAC,oIAAA,CAAA,QAAK;wCAAC,SAAQ;kDAAQ;;;;;;kDACvB,6LAAC,oIAAA,CAAA,QAAK;wCAAC,IAAG;wCAAQ,OAAO;wCAAO,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wCAAG,aAAY;;;;;;;;;;;;0CAEzF,6LAAC;gCAAI,WAAU;;kDACb,6LAAC,oIAAA,CAAA,QAAK;wCAAC,SAAQ;kDAAU;;;;;;kDACzB,6LAAC,uIAAA,CAAA,WAAQ;wCAAC,IAAG;wCAAU,OAAO;wCAAS,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;wCAAG,aAAY;wCAA2B,MAAM;;;;;;;;;;;;0CAGnI,6LAAC;gCAAI,WAAU;;kDACb,6LAAC,oIAAA,CAAA,QAAK;wCAAC,SAAQ;kDAAW;;;;;;kDAC1B,6LAAC,oIAAA,CAAA,QAAK;wCAAC,IAAG;wCAAW,OAAO;wCAAU,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;wCAAG,aAAY;wCAAgC,KAAI;wCAAM,UAAU,CAAC,CAAC;;;;;;;;;;;;0CAGxJ,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;;;;;;kDACf,6LAAC;wCAAK,WAAU;kDAAiD;;;;;;kDACjE,6LAAC;wCAAI,WAAU;;;;;;;;;;;;0CAGjB,6LAAC;gCAAI,WAAU;;kDACX,6LAAC,oIAAA,CAAA,QAAK;wCAAC,SAAQ;kDAAa;;;;;;kDAC5B,6LAAC,qIAAA,CAAA,SAAM;wCAAC,SAAQ;wCAAU,WAAU;wCAAS,SAAS,IAAM,aAAa,OAAO,EAAE;;0DAC9E,6LAAC,yMAAA,CAAA,SAAM;gDAAC,WAAU;;;;;;4CACjB,eAAe,CAAC,WAAW,EAAE,aAAa,IAAI,EAAE,GAAG;;;;;;;kDAExD,6LAAC,oIAAA,CAAA,QAAK;wCACF,IAAG;wCACH,MAAK;wCACL,KAAK;wCACL,UAAU;wCACV,WAAU;wCACV,QAAO;;;;;;;;;;;;0CAId,6LAAC;gCAAI,WAAU;;kDACd,6LAAC,oIAAA,CAAA,QAAK;wCAAC,SAAQ;kDAAY;;;;;;kDAC3B,6LAAC,oIAAA,CAAA,QAAK;wCAAC,IAAG;wCAAY,OAAO;wCAAW,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;wCAAG,aAAY;;;;;;kDAClG,6LAAC;wCAAE,WAAU;kDAAgC;;;;;;;;;;;;0CAGhD,6LAAC,qIAAA,CAAA,SAAM;gCAAC,SAAS;gCAAY,UAAU;gCAAQ,WAAU;0CACtD,uBAAS,6LAAC,oNAAA,CAAA,UAAO;oCAAC,WAAU;;;;;2CAA6B,YAAY,kBAAkB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOtG;GAjJgB;;QAQC,+HAAA,CAAA,eAAY;QACT,+HAAA,CAAA,WAAQ;;;KATZ","debugId":null}},
    {"offset": {"line": 8331, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/ManagePinnedMatchScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, getDoc, setDoc, deleteDoc, addDoc, collection } from 'firebase/firestore';\nimport { useToast } from '@/hooks/use-toast';\nimport { Loader2, Upload, Trash2 } from 'lucide-react';\nimport type { PinnedMatch } from '@/lib/types';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport Image from 'next/image';\nimport { Switch } from '@/components/ui/switch';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\"\n\nexport function ManagePinnedMatchScreen({ goBack, canGoBack, headerActions, matchId }: ScreenProps & { matchId?: string | null }) {\n    const [match, setMatch] = useState<Partial<PinnedMatch>>({ isEnabled: true });\n    const [loading, setLoading] = useState(true);\n    const [saving, setSaving] = useState(false);\n    const [deleting, setDeleting] = useState(false);\n    const [isDeleteAlertOpen, setDeleteAlertOpen] = useState(false);\n    const { db } = useFirestore();\n    const { toast } = useToast();\n    const homeLogoInputRef = useRef<HTMLInputElement>(null);\n    const awayLogoInputRef = useRef<HTMLInputElement>(null);\n\n    const isEditing = !!matchId;\n    \n    useEffect(() => {\n        if (!db) {\n          setLoading(true);\n          return;\n        }\n        if (isEditing && matchId) {\n            setLoading(true);\n            const docRef = doc(db, 'pinnedIraqiMatches', matchId);\n        \n            getDoc(docRef).then(docSnap => {\n                if (docSnap.exists()) {\n                    setMatch({ id: docSnap.id, ...docSnap.data() } as PinnedMatch);\n                }\n            }).catch(error => {\n                const permissionError = new FirestorePermissionError({ path: docRef.path, operation: 'get' });\n                errorEmitter.emit('permission-error', permissionError);\n            }).finally(() => {\n                setLoading(false);\n            });\n        } else {\n            // This is 'create' mode\n            setMatch({ isEnabled: true });\n            setLoading(false);\n        }\n    }, [db, matchId, isEditing]);\n\n\n    const handleInputChange = (field: keyof PinnedMatch, value: string | boolean) => {\n        setMatch(prev => ({ ...prev, [field]: value }));\n    };\n\n    const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>, team: 'home' | 'away') => {\n        const file = event.target.files?.[0];\n        if (file) {\n            const reader = new FileReader();\n            reader.onloadend = () => {\n                const logoField = team === 'home' ? 'homeTeamLogo' : 'awayTeamLogo';\n                handleInputChange(logoField, reader.result as string);\n            };\n            reader.readAsDataURL(file);\n        }\n    };\n    \n    const handleSave = async () => {\n        if (!db) return;\n        setSaving(true);\n        \n        const dataToSave: Omit<PinnedMatch, 'id'> = {\n            isEnabled: match.isEnabled ?? true,\n            homeTeamName: match.homeTeamName || '',\n            homeTeamLogo: match.homeTeamLogo || '',\n            awayTeamName: match.awayTeamName || '',\n            awayTeamLogo: match.awayTeamLogo || '',\n            competitionName: match.competitionName || '',\n            matchDate: match.matchDate || '',\n            matchTime: match.matchTime || '',\n        };\n\n        const operation = isEditing && matchId\n            ? setDoc(doc(db, 'pinnedIraqiMatches', matchId), dataToSave)\n            : addDoc(collection(db, 'pinnedIraqiMatches'), dataToSave);\n\n        operation\n            .then(() => {\n                toast({ title: 'نجاح', description: isEditing ? 'تم تحديث المباراة المثبتة.' : 'تمت إضافة المباراة المثبتة.' });\n                goBack();\n            })\n            .catch(serverError => {\n                const permissionError = new FirestorePermissionError({ \n                    path: `pinnedIraqiMatches/${isEditing ? matchId : ''}`, \n                    operation: isEditing ? 'update' : 'create', \n                    requestResourceData: dataToSave \n                });\n                errorEmitter.emit('permission-error', permissionError);\n            })\n            .finally(() => setSaving(false));\n    };\n\n    const handleDelete = async () => {\n        if (!db || !isEditing || !matchId) return;\n        setDeleting(true);\n        const docRef = doc(db, 'pinnedIraqiMatches', matchId);\n        deleteDoc(docRef)\n         .then(() => {\n                toast({ title: 'نجاح', description: 'تم حذف المباراة المثبتة.' });\n                goBack();\n            })\n            .catch(serverError => {\n                const permissionError = new FirestorePermissionError({ path: docRef.path, operation: 'delete' });\n                errorEmitter.emit('permission-error', permissionError);\n            })\n            .finally(() => {\n                setDeleting(false);\n                setDeleteAlertOpen(false);\n            });\n    }\n\n    if (loading) {\n        return (\n             <div className=\"flex h-full flex-col bg-background\">\n                <ScreenHeader title={isEditing ? \"تعديل المباراة المثبتة\" : \"إضافة مباراة للتثبيت\"} onBack={goBack} canGoBack={true} />\n                <div className=\"flex-1 flex items-center justify-center\">\n                    <Loader2 className=\"h-8 w-8 animate-spin\" />\n                </div>\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n        <ScreenHeader title={isEditing ? \"تعديل المباراة المثبتة\" : \"إضافة مباراة للتثبيت\"} onBack={goBack} canGoBack={true} actions={\n             isEditing && (\n                <AlertDialog open={isDeleteAlertOpen} onOpenChange={setDeleteAlertOpen}>\n                    <AlertDialogTrigger asChild>\n                        <Button variant=\"destructive\" size=\"icon\">\n                            <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent>\n                        <AlertDialogHeader>\n                            <AlertDialogTitle>هل أنت متأكد من الحذف؟</AlertDialogTitle>\n                            <AlertDialogDescription>\n                                سيؤدي هذا إلى حذف البطاقة بالكامل. لا يمكن التراجع عن هذا الإجراء.\n                            </AlertDialogDescription>\n                        </AlertDialogHeader>\n                        <AlertDialogFooter>\n                            <AlertDialogCancel>إلغاء</AlertDialogCancel>\n                            <AlertDialogAction onClick={handleDelete} disabled={deleting}>\n                                {deleting ? <Loader2 className=\"h-4 w-4 animate-spin\"/> : 'حذف'}\n                            </AlertDialogAction>\n                        </AlertDialogFooter>\n                    </AlertDialogContent>\n                </AlertDialog>\n             )\n        } />\n        <div className=\"flex-1 overflow-y-auto p-4\">\n            <Card>\n            <CardContent className=\"space-y-6 pt-6\">\n                <div className=\"flex items-center justify-between rounded-lg border p-4\">\n                    <Label htmlFor=\"isEnabled\" className=\"flex flex-col gap-1\">\n                        <span>تفعيل البطاقة</span>\n                        <span className=\"font-normal leading-snug text-muted-foreground\">\n                            قم بإلغاء التفعيل لإخفاء البطاقة مؤقتًا من شاشة العراق.\n                        </span>\n                    </Label>\n                    <Switch\n                        id=\"isEnabled\"\n                        checked={match.isEnabled}\n                        onCheckedChange={(checked) => handleInputChange('isEnabled', checked)}\n                    />\n                </div>\n\n                <div className=\"space-y-2\">\n                    <Label>الفريق المضيف</Label>\n                    <div className=\"flex items-center gap-2\">\n                        <Input value={match.homeTeamName || ''} onChange={(e) => handleInputChange('homeTeamName', e.target.value)} placeholder=\"اسم الفريق المضيف\" />\n                         <Button variant=\"outline\" size=\"icon\" className=\"flex-shrink-0\" onClick={() => homeLogoInputRef.current?.click()}>\n                            {match.homeTeamLogo ? <Image src={match.homeTeamLogo} alt=\"\" width={24} height={24} /> : <Upload className=\"h-4 w-4\"/>}\n                         </Button>\n                         <Input type=\"file\" ref={homeLogoInputRef} onChange={(e) => handleFileChange(e, 'home')} className=\"hidden\" accept=\"image/*\"/>\n                    </div>\n                </div>\n\n                 <div className=\"space-y-2\">\n                    <Label>الفريق الضيف</Label>\n                    <div className=\"flex items-center gap-2\">\n                        <Input value={match.awayTeamName || ''} onChange={(e) => handleInputChange('awayTeamName', e.target.value)} placeholder=\"اسم الفريق الضيف\" />\n                         <Button variant=\"outline\" size=\"icon\" className=\"flex-shrink-0\" onClick={() => awayLogoInputRef.current?.click()}>\n                             {match.awayTeamLogo ? <Image src={match.awayTeamLogo} alt=\"\" width={24} height={24} /> : <Upload className=\"h-4 w-4\"/>}\n                         </Button>\n                         <Input type=\"file\" ref={awayLogoInputRef} onChange={(e) => handleFileChange(e, 'away')} className=\"hidden\" accept=\"image/*\"/>\n                    </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                    <Label htmlFor=\"competitionName\">اسم البطولة</Label>\n                    <Input id=\"competitionName\" value={match.competitionName || ''} onChange={(e) => handleInputChange('competitionName', e.target.value)} placeholder=\"مثال: دوري نجوم العراق\" />\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                     <div className=\"space-y-2\">\n                        <Label htmlFor=\"matchDate\">التاريخ</Label>\n                        <Input id=\"matchDate\" value={match.matchDate || ''} onChange={(e) => handleInputChange('matchDate', e.target.value)} placeholder=\"مثال: السبت، 25 مايو\" />\n                    </div>\n                     <div className=\"space-y-2\">\n                        <Label htmlFor=\"matchTime\">الوقت</Label>\n                        <Input id=\"matchTime\" value={match.matchTime || ''} onChange={(e) => handleInputChange('matchTime', e.target.value)} placeholder=\"مثال: 09:00 مساءً\" />\n                    </div>\n                </div>\n\n                <Button onClick={handleSave} disabled={saving} className=\"w-full\">\n                {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : 'حفظ التغييرات'}\n                </Button>\n            </CardContent>\n            </Card>\n        </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 8972, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/NotificationSettingsScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport type { ScreenProps } from '@/app/page';\nimport { useAuth, useFirestore } from '@/firebase';\nimport { collection, doc, updateDoc, getDocs, setDoc } from 'firebase/firestore';\nimport type { Favorites } from '@/lib/types';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Newspaper } from 'lucide-react';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\n\n\nexport function NotificationSettingsScreen({ navigate, goBack, canGoBack, headerActions, favorites, customNames }: ScreenProps) {\n  const { user } = useAuth();\n  const { db } = useFirestore();\n\n  const getDisplayName = useCallback((type: 'league' | 'team', id: number, defaultName: string) => {\n    if (!customNames) return defaultName;\n    const key = `${type}s` as 'leagues' | 'teams';\n    const map = customNames[key] as Map<number, string>;\n    const customName = map?.get(id);\n    if(customName) return customName;\n    \n    const hardcodedName = hardcodedTranslations[key]?.[id];\n    if (hardcodedName) return hardcodedName;\n\n    return defaultName;\n  }, [customNames]);\n\n  const handleToggleNotification = (type: 'leagues' | 'general', itemId: number | string) => {\n    if (!user || !db || !favorites) return;\n\n    let fieldPath: string;\n    let currentStatus: boolean;\n\n    if (type === 'leagues') {\n        fieldPath = `leagues.${itemId}.notificationsEnabled`;\n        currentStatus = favorites.leagues?.[itemId as number]?.notificationsEnabled ?? true;\n    } else { // general notifications like news, comments\n        fieldPath = `notificationsEnabled.${itemId}`;\n        currentStatus = favorites.notificationsEnabled?.[itemId as 'news'] ?? true;\n    }\n    \n    const newStatus = !currentStatus;\n\n    const docRef = doc(db, 'users', user.uid, 'favorites', 'data');\n    const updateData = { [fieldPath]: newStatus };\n    \n    setDoc(docRef, updateData, { merge: true }).catch(serverError => {\n      const permissionError = new FirestorePermissionError({ path: docRef.path, operation: 'update', requestResourceData: updateData });\n      errorEmitter.emit('permission-error', permissionError);\n    });\n  };\n\n  const favoriteLeagues = useMemo(() => {\n    if (!favorites?.leagues || !customNames) return [];\n    return Object.values(favorites.leagues).map(comp => ({\n        ...comp,\n        name: getDisplayName('league', comp.leagueId, comp.name)\n    }));\n  }, [favorites, customNames, getDisplayName]);\n\n  const NotificationControlItem = ({ item, type }: { item: any, type: 'leagues' }) => {\n    const id = item.leagueId;\n    const isEnabled = favorites?.[type]?.[id]?.notificationsEnabled ?? true;\n\n    return (\n        <div key={id} className=\"flex items-center justify-between p-3 border-b last:border-b-0\">\n            <div className=\"flex items-center gap-3\">\n                <Avatar className=\"h-8 w-8\">\n                    <AvatarImage src={item.logo} alt={item.name} className={'object-contain p-1'} />\n                    <AvatarFallback>{item.name.charAt(0)}</AvatarFallback>\n                </Avatar>\n                <Label htmlFor={`notif-${id}`} className=\"font-semibold cursor-pointer\">{item.name}</Label>\n            </div>\n            <Switch\n                id={`notif-${id}`}\n                checked={isEnabled}\n                onCheckedChange={() => handleToggleNotification(type, id)}\n            />\n        </div>\n    );\n  }\n  \n  if (!favorites || !customNames) {\n    return (\n      <div className=\"flex h-full flex-col bg-background\">\n        <ScreenHeader title=\"إعدادات الإشعارات\" onBack={goBack} canGoBack={true} actions={headerActions} />\n         <div className=\"p-4 space-y-4\">\n            {Array.from({ length: 8 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-4 p-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1\"><Skeleton className=\"h-4 w-3/4\" /></div>\n                 <Skeleton className=\"h-6 w-12\" />\n              </div>\n            ))}\n          </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader title=\"إعدادات الإشعارات\" onBack={goBack} canGoBack={true} actions={headerActions} />\n      \n      <div className=\"flex-1 overflow-y-auto pt-4 space-y-6\">\n        <Card className=\"mx-4\">\n            <CardHeader><CardTitle>الإشعارات العامة</CardTitle></CardHeader>\n            <CardContent className=\"divide-y p-0\">\n                 <div className=\"flex items-center justify-between p-3\">\n                    <div className=\"flex items-center gap-3\">\n                        <Newspaper className=\"h-6 w-6 text-primary\" />\n                        <Label htmlFor=\"notif-news\" className=\"font-semibold cursor-pointer\">إشعارات الأخبار</Label>\n                    </div>\n                    <Switch\n                        id=\"notif-news\"\n                        checked={favorites?.notificationsEnabled?.news ?? true}\n                        onCheckedChange={() => handleToggleNotification('general', 'news')}\n                    />\n                </div>\n            </CardContent>\n        </Card>\n\n         {favoriteLeagues.length === 0 ? (\n            <p className=\"text-center text-muted-foreground pt-10 px-4\">أضف بطولات إلى مفضلتك للتحكم في إشعاراتها بشكل منفصل.</p>\n         ) : (\n            <Card className=\"mx-4\">\n                <CardHeader><CardTitle>إشعارات البطولات المفضلة</CardTitle></CardHeader>\n                <CardContent className=\"p-0\">\n                    <div className=\"rounded-lg border\">\n                        {favoriteLeagues.map((league) => <NotificationControlItem key={league.leagueId} item={league} type=\"leagues\"/>)}\n                    </div>\n                </CardContent>\n            </Card>\n         )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 9369, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/GeneralSettingsScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React from 'react';\nimport { useTheme } from \"@/components/theme-provider\";\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Label } from '@/components/ui/label';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Sun, Moon, Laptop, Gem, UserCog, Globe, Sparkles } from 'lucide-react';\nimport { useAuth, useAdmin } from '@/firebase';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\n\nexport function GeneralSettingsScreen({ navigate, goBack, canGoBack, headerActions }: ScreenProps) {\n  const { theme, setTheme } = useTheme();\n  const { isProUser } = useAuth();\n  const { isAdmin, makeAdmin } = useAdmin();\n  const { toast } = useToast();\n\n  const handleMakeAdmin = async () => {\n    await makeAdmin();\n    toast({\n        title: \"تمت الترقية!\",\n        description: \"لقد حصلت على صلاحيات المدير.\",\n    });\n  }\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader title={\"الإعدادات العامة\"} onBack={goBack} canGoBack={true} actions={headerActions} />\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-6\">\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-3\">\n              <Sparkles className=\"h-6 w-6\" />\n              <div>\n                <CardTitle>{\"مظهر التطبيق\"}</CardTitle>\n                <CardDescription>{\"اختر المظهر المفضل لديك.\"}</CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <RadioGroup value={theme} onValueChange={setTheme} className=\"grid grid-cols-3 gap-2 sm:gap-4\">\n               <Label htmlFor=\"dark\" className=\"flex flex-col items-center justify-center rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer\">\n                <RadioGroupItem value=\"dark\" id=\"dark\" className=\"sr-only\" />\n                <Moon className=\"mb-2 h-5 w-5\" />\n                {\"داكن\"}\n              </Label>\n              <Label htmlFor=\"light\" className=\"flex flex-col items-center justify-center rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer\">\n                <RadioGroupItem value=\"light\" id=\"light\" className=\"sr-only\" />\n                <Sun className=\"mb-2 h-5 w-5\" />\n                {\"فاتح\"}\n              </Label>\n              <Label htmlFor=\"system\" className=\"flex flex-col items-center justify-center rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer\">\n                <RadioGroupItem value=\"system\" id=\"system\" className=\"sr-only\" />\n                <Laptop className=\"mb-2 h-5 w-5\" />\n                {\"النظام\"}\n              </Label>\n            </RadioGroup>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-3\">\n              <Globe className=\"h-6 w-6\" />\n              <div>\n                <CardTitle>{\"لغة التطبيق\"}</CardTitle>\n                <CardDescription>{\"اختر لغة العرض.\"}</CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <RadioGroup defaultValue=\"ar\" className=\"grid grid-cols-2 gap-2 sm:gap-4\">\n              <Label htmlFor=\"ar\" className=\"flex items-center justify-center gap-2 rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer\">\n                <RadioGroupItem value=\"ar\" id=\"ar\" />\n                {\"العربية\"}\n              </Label>\n              <Label htmlFor=\"en\" className=\"flex items-center justify-center gap-2 rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer\">\n                <RadioGroupItem value=\"en\" id=\"en\" />\n                {\"English\"}\n              </Label>\n            </RadioGroup>\n            <p className=\"text-xs text-muted-foreground mt-4 text-center\">ملاحظة: تغيير اللغة قيد التطوير حاليًا.</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n           <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                    <UserCog className=\"h-6 w-6\" />\n                    <div>\n                        <CardTitle>{\"إعدادات الحساب\"}</CardTitle>\n                        <CardDescription>{\"قم بترقية حسابك أو تعديل صلاحياتك.\"}</CardDescription>\n                    </div>\n                </div>\n            </CardHeader>\n          <CardContent className=\"space-y-4\">\n             {!isProUser && (\n                <Button onClick={() => navigate('GoPro')} className=\"w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white hover:opacity-90\">\n                    <Gem className=\"ml-2 h-4 w-4\" />\n                    الترقية إلى النسخة الإحترافية\n                </Button>\n            )}\n             {/*\n             !isAdmin && (\n                <Button onClick={handleMakeAdmin} variant=\"secondary\" className=\"w-full\">\n                    الترقية إلى مدير\n                </Button>\n            )\n            */}\n            {isAdmin && <p className=\"text-sm text-center text-muted-foreground\">أنت مدير بالفعل.</p>}\n          </CardContent>\n        </Card>\n\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 9816, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/GoProScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Check, Gem, Loader2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\nimport { purchaseSubscription } from '@/lib/revenuecat-client';\nimport { useAuth } from '@/firebase';\n\nconst proFeatures = [\n    \"تجربة خالية من الإعلانات تمامًا\",\n    \"أولوية في الحصول على الميزات الجديدة\",\n    \"دعم فني متميز\",\n    \"شارة مستخدم احترافي (قريبًا)\",\n];\n\nconst subscriptionPlans = [\n    {\n        name: \"شهري\",\n        identifier: \"monthly\",\n        price: \"4.99\",\n        description: \"فاتورة كل شهر، ألغِ في أي وقت.\",\n        isPopular: false,\n    },\n    {\n        name: \"سنوي\",\n        identifier: \"yearly\",\n        price: \"49.99\",\n        description: \"وفر 20% مع الخطة السنوية.\",\n        isPopular: true,\n    },\n];\n\n\nexport function GoProScreen({ navigate, goBack, canGoBack }: ScreenProps) {\n  const { toast } = useToast();\n  const { setProUser } = useAuth();\n  const [loadingPlan, setLoadingPlan] = useState<string | null>(null);\n\n  const handleSubscribe = async (planIdentifier: string, planName: string) => {\n    setLoadingPlan(planIdentifier);\n    try {\n        const isSuccess = await purchaseSubscription(planIdentifier);\n\n        if (isSuccess) {\n            // In a real app, this would be handled by a backend webhook.\n            // For prototyping, we set it directly after the mock purchase succeeds.\n            await setProUser(true);\n            \n            toast({\n                title: \"🎉 تمت الترقية بنجاح!\",\n                description: `أصبحت الآن من مستخدمي نبض الملاعب برو.`,\n            });\n            goBack(); // Go back to settings screen\n        } else {\n             toast({\n                variant: 'destructive',\n                title: \"فشلت عملية الشراء\",\n                description: \"حدث خطأ ما أثناء محاولة إتمام عملية الشراء.\",\n             });\n        }\n    } catch (error: any) {\n         toast({\n            variant: 'destructive',\n            title: \"خطأ\",\n            description: error.message || \"فشلت عملية الشراء. يرجى المحاولة مرة أخرى.\",\n        });\n    } finally {\n        setLoadingPlan(null);\n    }\n  }\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader title={\"النسخة الاحترافية\"} onBack={goBack} canGoBack={canGoBack} />\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-6\">\n        <div className=\"text-center space-y-2\">\n            <Gem className=\"mx-auto h-12 w-12 text-yellow-400\" />\n            <h1 className=\"text-3xl font-bold\">نبض الملاعب برو</h1>\n            <p className=\"text-muted-foreground\">احصل على تجربة احترافية ومميزة.</p>\n        </div>\n\n        <Card>\n            <CardHeader>\n                <CardTitle>ميزات النسخة الاحترافية</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n                {proFeatures.map((feature, index) => (\n                     <div key={index} className=\"flex items-center gap-3\">\n                        <Check className=\"h-5 w-5 text-green-500\" />\n                        <span className=\"text-sm font-medium\">{feature}</span>\n                    </div>\n                ))}\n            </CardContent>\n        </Card>\n\n         <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {subscriptionPlans.map((plan) => (\n                <Card key={plan.name} className={cn(\"flex flex-col\", plan.isPopular && \"border-primary border-2\")}>\n                    {plan.isPopular && (\n                        <div className=\"bg-primary text-primary-foreground text-xs font-bold text-center py-1 rounded-t-lg\">\n                            الأكثر شيوعًا\n                        </div>\n                    )}\n                    <CardHeader className=\"text-center\">\n                        <CardTitle className=\"text-2xl\">{plan.name}</CardTitle>\n                        <CardDescription>{plan.description}</CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"flex-1 text-center\">\n                        <p className=\"text-4xl font-bold\">${plan.price}</p>\n                        <p className=\"text-muted-foreground text-sm\">/ {plan.name === 'شهري' ? 'شهر' : 'سنة'}</p>\n                    </CardContent>\n                    <CardFooter>\n                         <Button className=\"w-full\" onClick={() => handleSubscribe(plan.identifier, plan.name)} disabled={!!loadingPlan}>\n                            {loadingPlan === plan.identifier ? <Loader2 className=\"h-4 w-4 animate-spin\"/> : 'اشترك الآن'}\n                        </Button>\n                    </CardFooter>\n                </Card>\n            ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 10132, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/ManageTopScorersScreen.tsx"],"sourcesContent":["\n\n\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, setDoc, collection, query, orderBy, onSnapshot, writeBatch, getDocs } from 'firebase/firestore';\nimport { useToast } from '@/hooks/use-toast';\nimport { Loader2, Upload } from 'lucide-react';\nimport type { ManualTopScorer } from '@/lib/types';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\n\nconst NUM_SCORERS = 20;\n\nexport function ManageTopScorersScreen({ navigate, goBack, canGoBack, headerActions }: ScreenProps) {\n  const [scorers, setScorers] = useState<Partial<Omit<ManualTopScorer, 'rank'>>[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const { db } = useFirestore();\n  const { toast } = useToast();\n  const fileInputRefs = useRef<(HTMLInputElement | null)[]>([]);\n\n  useEffect(() => {\n    if (!db) return;\n    setLoading(true);\n    const scorersRef = collection(db, 'iraqiLeagueTopScorers');\n    const q = query(scorersRef, orderBy('rank', 'asc'));\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n        const fetchedScorers = new Map<number, Omit<ManualTopScorer, 'rank'>>();\n        snapshot.docs.forEach(doc => {\n            const data = doc.data() as ManualTopScorer;\n            if (data.rank && data.rank > 0 && data.rank <= NUM_SCORERS) {\n                const { rank, ...rest } = data;\n                fetchedScorers.set(rank, rest);\n            }\n        });\n\n        const newScorersList = Array.from({ length: NUM_SCORERS }, (_, i) => {\n            const rank = i + 1;\n            return fetchedScorers.get(rank) || { playerName: '', teamName: '', goals: 0, playerPhoto: '' };\n        });\n\n        setScorers(newScorersList);\n        setLoading(false);\n    }, (error) => {\n        const permissionError = new FirestorePermissionError({ path: 'iraqiLeagueTopScorers', operation: 'list' });\n        errorEmitter.emit('permission-error', permissionError);\n        setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [db]);\n\n  const handleInputChange = (index: number, field: keyof Omit<ManualTopScorer, 'rank'>, value: string | number) => {\n    setScorers(prevScorers => {\n      const newScorers = [...prevScorers];\n      const updatedScorer = { ...newScorers[index], [field]: value };\n      newScorers[index] = updatedScorer;\n      return newScorers;\n    });\n  };\n  \n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>, index: number) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        handleInputChange(index, 'playerPhoto', reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleSave = async () => {\n    if (!db) return;\n    setSaving(true);\n\n    try {\n      const batch = writeBatch(db);\n\n      // First, get all existing documents to delete them\n      const existingDocsSnapshot = await getDocs(collection(db, 'iraqiLeagueTopScorers'));\n      existingDocsSnapshot.forEach(doc => {\n        batch.delete(doc.ref);\n      });\n\n      // Then, set the new documents for scorers that have a name\n      scorers.forEach((scorer, index) => {\n        if (scorer.playerName && scorer.playerName.trim()) {\n          const rank = index + 1;\n          const docRef = doc(db, 'iraqiLeagueTopScorers', String(rank));\n          \n          const dataToSave: Partial<ManualTopScorer> = {\n            rank: rank,\n            playerName: scorer.playerName.trim(),\n            teamName: scorer.teamName?.trim() ?? '',\n            goals: Number(scorer.goals) || 0,\n          };\n          \n          if (scorer.playerPhoto) {\n            dataToSave.playerPhoto = scorer.playerPhoto;\n          }\n\n          batch.set(docRef, dataToSave);\n        }\n      });\n      \n      await batch.commit();\n\n      toast({ title: 'نجاح', description: 'تم حفظ قائمة الهدافين.' });\n      goBack();\n    } catch (error) {\n       const permissionError = new FirestorePermissionError({ path: 'iraqiLeagueTopScorers', operation: 'write' });\n       errorEmitter.emit('permission-error', permissionError);\n       toast({\n        variant: \"destructive\",\n        title: \"فشل الحفظ\",\n        description: \"حدث خطأ أثناء حفظ القائمة. تأكد من صلاحياتك.\",\n      });\n    } finally {\n        setSaving(false);\n    }\n  };\n  \n  if(loading) {\n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader title=\"إدارة الهدافين\" onBack={goBack} canGoBack={true} />\n            <div className=\"flex justify-center items-center flex-1\">\n                <Loader2 className=\"h-8 w-8 animate-spin\" />\n            </div>\n        </div>\n    )\n  }\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader title=\"إدارة الهدافين\" onBack={goBack} canGoBack={true} />\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {scorers.map((scorer, index) => (\n          <Card key={index}>\n            <CardContent className=\"flex items-center gap-2 p-3\">\n              <span className=\"font-bold text-lg w-8 text-center\">{index + 1}</span>\n               <button onClick={() => fileInputRefs.current[index]?.click()} className=\"flex-shrink-0\">\n                  <Avatar className=\"h-12 w-12 cursor-pointer\">\n                    <AvatarImage src={scorer.playerPhoto} />\n                    <AvatarFallback><Upload className=\"h-5 w-5\" /></AvatarFallback>\n                  </Avatar>\n                </button>\n                <input\n                    type=\"file\"\n                    ref={el => fileInputRefs.current[index] = el}\n                    onChange={(e) => handleFileChange(e, index)}\n                    className=\"hidden\"\n                    accept=\"image/*\"\n                />\n              <div className=\"flex-1 space-y-2\">\n                <Input\n                  placeholder=\"اسم اللاعب\"\n                  value={scorer.playerName || ''}\n                  onChange={(e) => handleInputChange(index, 'playerName', e.target.value)}\n                />\n                 <Input\n                  placeholder=\"اسم الفريق\"\n                  value={scorer.teamName || ''}\n                  onChange={(e) => handleInputChange(index, 'teamName', e.target.value)}\n                />\n              </div>\n              <Input\n                type=\"number\"\n                placeholder=\"الأهداف\"\n                value={scorer.goals || ''}\n                onChange={(e) => handleInputChange(index, 'goals', Number(e.target.value))}\n                className=\"w-24 text-center\"\n              />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n      <div className=\"p-4 border-t bg-background\">\n        <Button className=\"w-full\" onClick={handleSave} disabled={saving}>\n          {saving ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : 'حفظ القائمة'}\n        </Button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 10506, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/IraqScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useMemo, useRef, useCallback } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ProfileButton } from '../AppContentWrapper';\nimport { Button } from '@/components/ui/button';\nimport { Crown, Search, X, Loader2, Trophy, BarChart, Users as UsersIcon, RefreshCw, CalendarDays, ThumbsUp } from 'lucide-react';\nimport { SearchSheet } from '@/components/SearchSheet';\nimport { useAdmin, useAuth, useFirestore } from '@/firebase';\nimport type { CrownedTeam, Favorites, Fixture, Standing, TopScorer, Prediction, Team, Player, UserScore, PredictionMatch, UserProfile } from '@/lib/types';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { ScrollArea, ScrollBar } from '@/components/ui/scroll-area';\nimport { collection, onSnapshot, doc, updateDoc, deleteField, setDoc, query, where, getDocs, writeBatch, getDoc, orderBy, limit } from 'firebase/firestore';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { useToast } from '@/hooks/use-toast';\nimport { FixtureItem } from '@/components/FixtureItem';\nimport { isMatchLive } from '@/lib/matchStatus';\nimport { CURRENT_SEASON } from '@/lib/constants';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { format, addDays, subDays, isToday, isYesterday, isTomorrow } from 'date-fns';\nimport { ar } from 'date-fns/locale';\nimport PredictionCard from '@/components/PredictionCard';\nimport { FootballIcon } from '@/components/icons/FootballIcon';\nimport { cn } from '@/lib/utils';\nimport {Skeleton} from \"@/components/ui/skeleton\";\nimport { setLocalFavorites } from '@/lib/local-favorites';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\nconst CrownedTeamScroller = ({\n  crownedTeams,\n  onSelectTeam,\n  onRemove,\n  selectedTeamId,\n  navigate,\n}: {\n  crownedTeams: CrownedTeam[];\n  onSelectTeam: (teamId: number) => void;\n  onRemove: (teamId: number) => void;\n  selectedTeamId: number | null;\n  navigate: ScreenProps['navigate'];\n}) => {\n  if (crownedTeams.length === 0) {\n    return (\n      <div className=\"text-center text-muted-foreground py-4 px-4\">\n        <p className=\"mb-4\">\n          قم بتتويج فريقك المفضل بالضغط على أيقونة التاج 👑 في صفحة تفاصيل الفريق لتبقى على اطلاع دائم بآخر أخباره ومبارياته هنا.\n        </p>\n        <Button onClick={() => navigate('AllCompetitions')}>استكشف</Button>\n      </div>\n    );\n  }\n\n  return (\n    <ScrollArea className=\"w-full whitespace-nowrap\">\n      <div className=\"flex w-max space-x-4 px-4 flex-row-reverse\">\n        {crownedTeams.map(team => (\n          <div\n            key={team.teamId}\n            className=\"relative flex flex-col items-center gap-1 w-20 text-center cursor-pointer group\"\n            onClick={() => onSelectTeam(team.teamId)}\n          >\n            <Avatar className={`h-12 w-12 border-2 ${selectedTeamId === team.teamId ? 'border-primary' : 'border-yellow-400'}`}>\n              <AvatarImage src={team.logo} />\n              <AvatarFallback>{team.name.charAt(0)}</AvatarFallback>\n            </Avatar>\n            <span className=\"text-[11px] font-medium truncate w-full\">{team.name}</span>\n            <p className=\"text-[10px] text-muted-foreground truncate w-full\">{team.note}</p>\n            <button \n              onClick={(e) => { e.stopPropagation(); onRemove(team.teamId); }}\n              className=\"absolute top-0 left-0 h-5 w-5 bg-background/80 rounded-full flex items-center justify-center border border-destructive\"\n            >\n              <X className=\"h-3 w-3 text-destructive\"/>\n            </button>\n          </div>\n        ))}\n      </div>\n      <ScrollBar orientation=\"horizontal\" />\n    </ScrollArea>\n  );\n};\n\nconst TeamFixturesDisplay = ({ teamId, navigate }: { teamId: number; navigate: ScreenProps['navigate'] }) => {\n    const [allFixtures, setAllFixtures] = useState<Fixture[]>([]);\n    const [loading, setLoading] = useState(true);\n    const { toast } = useToast();\n    const listRef = useRef<HTMLDivElement>(null);\n    const firstUpcomingMatchIndex = useRef<number>(-1);\n\n    useEffect(() => {\n        let isMounted = true;\n        const fetchFixtures = async () => {\n            if (!teamId) {\n                setLoading(false);\n                return;\n            };\n            setLoading(true);\n            try {\n                const url = `https://${API_FOOTBALL_HOST}/fixtures?team=${teamId}&season=${CURRENT_SEASON}`;\n                const res = await fetch(url, {\n                    headers: {\n                        'x-rapidapi-host': API_FOOTBALL_HOST,\n                        'x-rapidapi-key': API_KEY || '',\n                    },\n                });\n                if (!isMounted) return;\n                if (!res.ok) throw new Error(`API fetch failed with status: ${res.status}`);\n                \n                const data = await res.json();\n                const fixtures: Fixture[] = data.response || [];\n                fixtures.sort((a, b) => a.fixture.timestamp - b.fixture.timestamp);\n                \n                const now = new Date();\n                const upcomingIndex = fixtures.findIndex(f => {\n                    const fixtureDate = new Date(f.fixture.timestamp * 1000);\n                    return isMatchLive(f.fixture.status) || fixtureDate >= now;\n                });\n\n                if(isMounted) {\n                    setAllFixtures(fixtures);\n                    firstUpcomingMatchIndex.current = upcomingIndex > -1 ? upcomingIndex : (fixtures.length > 0 ? fixtures.length - 1 : -1);\n                }\n\n            } catch (error) {\n                console.error(\"Error fetching fixtures:\", error);\n                if(isMounted) {\n                    toast({\n                        variant: \"destructive\",\n                        title: \"خطأ في الشبكة\",\n                        description: \"فشل في جلب المباريات. يرجى التحقق من اتصالك بالإنترنت.\",\n                    });\n                }\n            } finally {\n                if(isMounted) setLoading(false);\n            }\n        };\n        fetchFixtures();\n\n        return () => { isMounted = false; }\n    }, [teamId, toast]);\n\n    useEffect(() => {\n        if (!loading && firstUpcomingMatchIndex.current > -1 && listRef.current) {\n            setTimeout(() => {\n                const itemElement = listRef.current?.children[firstUpcomingMatchIndex.current] as HTMLDivElement;\n                if (itemElement) {\n                    listRef.current?.scrollTo({\n                        top: itemElement.offsetTop - 10,\n                        behavior: 'smooth'\n                    });\n                }\n            }, 200);\n        }\n    }, [loading, allFixtures]);\n\n    if (loading) {\n      return (\n        <div className=\"flex items-center justify-center h-64\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      );\n    }\n\n    if (allFixtures.length === 0) {\n      return (\n        <Card className=\"mt-4\">\n            <CardContent className=\"p-6\">\n                <p className=\"text-center text-muted-foreground\">لا توجد مباريات متاحة لهذا الفريق.</p>\n            </CardContent>\n        </Card>\n      );\n    }\n\n    return (\n        <div ref={listRef} className=\"h-full overflow-y-auto space-y-2\">\n            {allFixtures.map((fixture, index) => (\n                <div key={fixture.fixture.id}>\n                    <FixtureItem fixture={fixture} navigate={navigate} />\n                </div>\n            ))}\n        </div>\n    );\n};\n\nexport function IraqScreen({ navigate, goBack, canGoBack, favorites, setFavorites, customNames, onCustomNameChange }: ScreenProps & {setFavorites: (favorites: any) => void, onCustomNameChange?: () => void}) {\n  const { user } = useAuth();\n  const { db } = useFirestore();\n  const [selectedTeamId, setSelectedTeamId] = useState<number | null>(null);\n  \n  const getDisplayName = useCallback((type: 'team' | 'league', id: number, defaultName: string) => {\n    if (!customNames) return defaultName;\n    const key = `${type}s` as 'teams' | 'leagues';\n    const firestoreMap = customNames[key];\n    const customName = firestoreMap?.get(id);\n    if (customName) return customName;\n\n    const hardcodedMap = hardcodedTranslations[key];\n    const hardcodedName = hardcodedMap[id as any];\n    if (hardcodedName) return hardcodedName;\n\n    return defaultName;\n  }, [customNames]);\n  \n  const crownedTeams = useMemo(() => {\n    if (!favorites?.crownedTeams) return [];\n    return Object.values(favorites.crownedTeams).map(team => ({\n        ...team,\n        name: getDisplayName('team', team.teamId, team.name)\n    }));\n  }, [favorites?.crownedTeams, getDisplayName]);\n  \n  useEffect(() => {\n    if(crownedTeams.length > 0 && !selectedTeamId) {\n      setSelectedTeamId(crownedTeams[0].teamId);\n    }\n    if (crownedTeams.length === 0) {\n      setSelectedTeamId(null);\n    }\n  }, [crownedTeams, selectedTeamId]);\n\n\n const handleRemoveCrowned = useCallback((teamIdToRemove: number) => {\n    const newFavorites = JSON.parse(JSON.stringify(favorites || {}));\n    if (newFavorites.crownedTeams?.[teamIdToRemove]) {\n        delete newFavorites.crownedTeams[teamIdToRemove];\n    }\n    setFavorites(newFavorites);\n}, [favorites, setFavorites]);\n  \n  const handleSelectTeam = (teamId: number) => {\n    setSelectedTeamId(teamId);\n  }\n  \n  if (!user) {\n    return (\n       <div className=\"flex h-full flex-col bg-background\">\n          <ScreenHeader title=\"ملعبي\" onBack={goBack} canGoBack={canGoBack} />\n           <div className=\"flex-1 flex flex-col items-center justify-center text-center p-8\">\n              <Crown className=\"h-16 w-16 text-muted-foreground mb-4\"/>\n              <h2 className=\"text-xl font-bold\">ميزة حصرية للمستخدمين المسجلين</h2>\n              <p className=\"text-muted-foreground mb-6\">\n                قم بتسجيل الدخول لتتويج فرقك وبطولاتك المفضلة.\n              </p>\n              <Button onClick={() => navigate('Welcome')}>تسجيل الدخول</Button>\n           </div>\n       </div>\n    )\n  }\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <ScreenHeader\n        title=\"ملعبي\"\n        onBack={goBack}\n        canGoBack={canGoBack}\n        actions={\n          <div className=\"flex items-center gap-1\">\n              <SearchSheet navigate={navigate} favorites={favorites} customNames={customNames} setFavorites={setFavorites} onCustomNameChange={onCustomNameChange}>\n                  <Button variant=\"ghost\" size=\"icon\">\n                      <Search className=\"h-5 w-5\" />\n                  </Button>\n              </SearchSheet>\n              <ProfileButton />\n          </div>\n        }\n      />\n      <div className=\"flex-1 flex flex-col min-h-0\">\n          <div className=\"py-4 border-b\">\n            <CrownedTeamScroller \n              crownedTeams={crownedTeams} \n              onSelectTeam={handleSelectTeam}\n              onRemove={handleRemoveCrowned} \n              selectedTeamId={selectedTeamId}\n              navigate={navigate}\n            />\n          </div>\n          <div className=\"flex-1 overflow-y-auto p-4\">\n            {selectedTeamId ? (\n              <TeamFixturesDisplay teamId={selectedTeamId} navigate={navigate} />\n            ) : (\n              crownedTeams.length > 0 && (\n                 <div className=\"flex items-center justify-center h-full text-muted-foreground text-center p-4\">\n                  <p>اختر فريقًا من الأعلى لعرض مبارياته.</p>\n                </div>\n              )\n            )}\n          </div>\n      </div>\n    </div>\n  );\n}\n\n    "],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 11084, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/PredictionsScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState, useMemo, useRef, useCallback } from 'react';\nimport type { ScreenProps } from '@/app/page';\nimport { ScreenHeader } from '@/components/ScreenHeader';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ProfileButton } from '../AppContentWrapper';\nimport { Button } from '@/components/ui/button';\nimport { Crown, Search, X, Loader2, Trophy, BarChart, Users as UsersIcon, RefreshCw, CalendarDays, ThumbsUp, ChevronLeft, ChevronRight } from 'lucide-react';\nimport { SearchSheet, SearchableItem } from '@/components/SearchSheet';\nimport { useAdmin, useAuth, useFirestore } from '@/firebase';\nimport type { CrownedTeam, Favorites, Fixture, Standing, TopScorer, Prediction, Team, Player, UserScore, PredictionMatch, UserProfile } from '@/lib/types';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { ScrollArea, ScrollBar } from '@/components/ui/scroll-area';\nimport { collection, onSnapshot, doc, updateDoc, deleteField, setDoc, query, where, getDocs, writeBatch, getDoc, orderBy, limit } from 'firebase/firestore';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { useToast } from '@/hooks/use-toast';\nimport PredictionCard from '@/components/PredictionCard';\nimport { cn } from '@/lib/utils';\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { format, addDays, subDays, isToday, isYesterday, isTomorrow } from 'date-fns';\nimport { ar } from 'date-fns/locale';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { POPULAR_LEAGUES, POPULAR_TEAMS } from '@/lib/popular-data';\nimport { hardcodedTranslations } from '@/lib/hardcoded-translations';\n\nconst API_FOOTBALL_HOST = 'v3.football.api-sports.io';\nconst API_KEY = process.env.NEXT_PUBLIC_API_FOOTBALL_KEY;\n\nconst calculatePoints = (prediction: Prediction, fixture: Fixture): number => {\n  if (!['FT', 'AET', 'PEN'].includes(fixture.fixture.status.short)) {\n    return 0;\n  }\n\n  if (fixture.goals.home === null || fixture.goals.away === null) {\n    return 0;\n  }\n\n  // The UI for prediction is swapped (home on left, away on right in RTL).\n  // `prediction.homeGoals` holds the predicted away score.\n  // `prediction.awayGoals` holds the predicted home score.\n  // We must compare them against the actual scores in the correct order.\n  const predHome = prediction.awayGoals;\n  const predAway = prediction.homeGoals;\n\n  const actualHome = fixture.goals.home;\n  const actualAway = fixture.goals.away;\n\n  // Exact score: 3 points\n  if (actualHome === predHome && actualAway === predAway) {\n    return 3;\n  }\n\n  // Correct outcome (win/loss/draw): 1 point\n  const actualWinner = actualHome > actualAway ? 'home' : actualHome < actualAway ? 'away' : 'draw';\n  const predWinner = predHome > predAway ? 'home' : predHome < predAway ? 'away' : 'draw';\n\n  if (actualWinner === predWinner) {\n    return 1;\n  }\n\n  return 0;\n};\n\nconst LeaderboardDisplay = React.memo(({ leaderboard, loadingLeaderboard, userScore, userId }: { leaderboard: UserScore[], loadingLeaderboard: boolean, userScore: UserScore | null, userId: string | undefined }) => {\n    if (loadingLeaderboard) {\n        return (\n            <div className=\"space-y-2 p-4\">\n                {Array.from({ length: 5 }).map((_, i) => (\n                    <div key={i} className=\"flex items-center gap-4 p-2\">\n                        <Skeleton className=\"h-4 w-4\" />\n                        <Skeleton className=\"h-8 w-8 rounded-full\" />\n                        <div className=\"flex-1\"><Skeleton className=\"h-4 w-3/4\" /></div>\n                        <Skeleton className=\"h-4 w-8\" />\n                    </div>\n                ))}\n            </div>\n        );\n    }\n\n    if (leaderboard.length === 0) {\n        return <p className=\"text-center text-muted-foreground p-8\">لا يوجد مشاركون في لوحة الصدارة بعد.</p>;\n    }\n    \n    const isUserInTop100 = leaderboard.some(s => s.userId === userId);\n\n    return (\n        <div className=\"space-y-2\">\n            <Table>\n                <TableHeader>\n                    <TableRow>\n                        <TableHead>الترتيب</TableHead>\n                        <TableHead className=\"text-right\">المستخدم</TableHead>\n                        <TableHead className=\"text-center\">النقاط</TableHead>\n                    </TableRow>\n                </TableHeader>\n                <TableBody>\n                    {leaderboard.map(score => (\n                        <TableRow key={score.userId} className={cn(score.userId === userId && \"bg-primary/10\")}>\n                            <TableCell>{score.rank}</TableCell>\n                            <TableCell className=\"text-right\">\n                                <div className=\"flex items-center gap-2 justify-end\">\n                                    {score.userName}\n                                    <Avatar className=\"h-6 w-6\"><AvatarImage src={score.userPhoto}/></Avatar>\n                                </div>\n                            </TableCell>\n                            <TableCell className=\"text-center font-bold\">{score.totalPoints}</TableCell>\n                        </TableRow>\n                    ))}\n                </TableBody>\n            </Table>\n            {userScore && !isUserInTop100 && (\n                 <Card className=\"bg-primary/10 mt-4\">\n                    <CardContent className=\"p-0\">\n                         <Table>\n                             <TableBody>\n                                <TableRow className=\"border-t-2 border-primary/50\">\n                                    <TableCell>{userScore.rank || '-'}</TableCell>\n                                    <TableCell className=\"text-right\">\n                                        <div className=\"flex items-center gap-2 justify-end\">\n                                            {userScore.userName}\n                                            <Avatar className=\"h-6 w-6\"><AvatarImage src={userScore.userPhoto}/></Avatar>\n                                        </div>\n                                    </TableCell>\n                                    <TableCell className=\"text-center font-bold\">{userScore.totalPoints}</TableCell>\n                                </TableRow>\n                             </TableBody>\n                         </Table>\n                    </CardContent>\n                 </Card>\n            )}\n        </div>\n    );\n});\nLeaderboardDisplay.displayName = 'LeaderboardDisplay';\n\n\nconst formatDateKey = (date: Date): string => format(date, 'yyyy-MM-dd');\n\nconst DateScroller = ({ selectedDateKey, onDateSelect }: {selectedDateKey: string, onDateSelect: (dateKey: string) => void}) => {\n    const dates = useMemo(() => {\n        const today = new Date();\n        return Array.from({ length: 30 }, (_, i) => addDays(today, i - 15));\n    }, []);\n    \n    const scrollerRef = useRef<HTMLDivElement>(null);\n    const selectedButtonRef = useRef<HTMLButtonElement>(null);\n\n    useEffect(() => {\n        const scroller = scrollerRef.current;\n        const selectedButton = selectedButtonRef.current;\n\n        if (scroller && selectedButton) {\n            const scrollerRect = scroller.getBoundingClientRect();\n            const selectedRect = selectedButton.getBoundingClientRect();\n            const scrollOffset = selectedRect.left - scrollerRect.left - (scrollerRect.width / 2) + (selectedRect.width / 2);\n            scroller.scrollTo({ left: scroller.scrollLeft + scrollOffset, behavior: 'smooth' });\n        }\n    }, [selectedDateKey]);\n\n    return (\n        <div className=\"relative bg-card py-2 border-x border-b rounded-b-lg shadow-md -mt-1 flex items-center justify-center\">\n             <Button \n                variant=\"ghost\" \n                size=\"icon\"\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8\"\n                onClick={() => onDateSelect(formatDateKey(addDays(new Date(selectedDateKey), 1)))}\n             >\n                <ChevronRight className=\"h-5 w-5\" />\n             </Button>\n            <div ref={scrollerRef} className=\"flex flex-row-reverse overflow-x-auto pb-1 px-10\" style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}>\n                {dates.map(date => {\n                    const dateKey = formatDateKey(date);\n                    const isSelected = dateKey === selectedDateKey;\n                    return (\n                         <button\n                            key={dateKey}\n                            ref={isSelected ? selectedButtonRef : null}\n                            className={cn(\n                                \"relative flex flex-col items-center justify-center h-auto py-1 px-2 min-w-[40px] rounded-lg transition-colors ml-2\",\n                                \"text-foreground/80 hover:text-primary\",\n                                isSelected && \"text-primary\"\n                            )}\n                            onClick={() => onDateSelect(dateKey)}\n                        >\n                            <span className=\"text-[10px] font-normal\">{format(date, \"EEE\", { locale: ar })}</span>\n                            <span className=\"font-semibold text-sm\">{format(date, 'd')}</span>\n                            {isSelected && <span className=\"absolute bottom-0 h-0.5 w-3 rounded-full bg-primary\" />}\n                        </button>\n                    )\n                })}\n            </div>\n             <Button \n                variant=\"ghost\" \n                size=\"icon\"\n                className=\"absolute left-2 top-1/2 -translate-y-1/2 h-8 w-8\"\n                onClick={() => onDateSelect(formatDateKey(subDays(new Date(selectedDateKey), 1)))}\n             >\n                <ChevronLeft className=\"h-5 w-5\" />\n             </Button>\n        </div>\n    );\n}\n\nexport function PredictionsScreen({ navigate, goBack, canGoBack, favorites, customNames, setFavorites }: ScreenProps & {setFavorites: (favorites: any) => void}) {\n    const { user } = useAuth();\n    const { isAdmin, db, isCheckingAdmin } = useAdmin();\n    const { toast } = useToast();\n\n    const [mainTab, setMainTab] = useState('voting');\n    const [leaderboard, setLeaderboard] = useState<UserScore[]>([]);\n    const [loadingLeaderboard, setLoadingLeaderboard] = useState(false);\n    const [currentUserScore, setCurrentUserScore] = useState<UserScore | null>(null);\n\n    const [pinnedMatches, setPinnedMatches] = useState<(PredictionMatch & { id: string })[]>([]);\n    const [loadingMatches, setLoadingMatches] = useState(true);\n\n    const [allUserPredictions, setAllUserPredictions] = useState<{ [key: string]: Prediction }>({});\n    const [loadingUserPredictions, setLoadingUserPredictions] = useState(true);\n\n    const [selectedDateKey, setSelectedDateKey] = useState<string>(formatDateKey(new Date()));\n    const [isUpdatingPoints, setIsUpdatingPoints] = useState(false);\n\n    const getDisplayName = React.useCallback((type: 'team' | 'league', id: number, defaultName: string) => {\n        if (!customNames) return defaultName;\n        const firestoreMap = type === 'team' ? customNames?.teams : customNames?.leagues;\n        const customName = firestoreMap?.get(id);\n        if (customName) return customName;\n    \n        const hardcodedMap = type === 'team' ? hardcodedTranslations.teams : hardcodedTranslations.leagues;\n        const hardcodedName = hardcodedMap[id as any];\n        if(hardcodedName) return hardcodedName;\n    \n        return defaultName;\n    }, [customNames]);\n\n    useEffect(() => {\n        if (isCheckingAdmin) return;\n        \n        if (!db) {\n            setLoadingMatches(false);\n            setPinnedMatches([]);\n            return;\n        }\n        \n        setLoadingMatches(true);\n        const q = query(collection(db, 'predictionFixtures'));\n        const unsub = onSnapshot(q, (snapshot) => {\n            const matches = snapshot.docs.map(doc => ({\n                id: doc.id,\n                ...(doc.data() as PredictionMatch),\n            })).filter(m => m && m.fixtureData && m.fixtureData.fixture);\n            setPinnedMatches(matches);\n            setLoadingMatches(false);\n        }, (err) => {\n            errorEmitter.emit('permission-error', new FirestorePermissionError({\n                path: 'predictionFixtures',\n                operation: 'list'\n            }));\n            setLoadingMatches(false);\n        });\n\n        return () => unsub();\n    }, [db, isAdmin, isCheckingAdmin]);\n\n\n    useEffect(() => {\n        if (!db || !user ) {\n            setLoadingUserPredictions(false);\n            return;\n        };\n        setLoadingUserPredictions(true);\n        \n        if (pinnedMatches.length === 0) {\n            setAllUserPredictions({});\n            setLoadingUserPredictions(false);\n            return;\n        }\n\n        const unsubscribes = pinnedMatches.map(match => {\n            const predictionRef = doc(db, 'predictionFixtures', match.id, 'userPredictions', user.uid);\n            return onSnapshot(predictionRef, (predDoc) => {\n                if (predDoc.exists()) {\n                    setAllUserPredictions(prev => ({ ...prev, [match.id]: predDoc.data() as Prediction }));\n                } else {\n                    setAllUserPredictions(prev => {\n                        const newPreds = {...prev};\n                        delete newPreds[match.id];\n                        return newPreds;\n                    });\n                }\n            }, e => console.warn(`Could not listen to prediction for match ${match.id}`, e));\n        });\n\n        setLoadingUserPredictions(false);\n\n        return () => unsubscribes.forEach(unsub => unsub());\n\n    }, [db, user, pinnedMatches]);\n    \n    const fetchLeaderboard = useCallback(async () => {\n        if (!db) return;\n        setLoadingLeaderboard(true);\n        \n        try {\n            const q = query(collection(db, 'leaderboard'), orderBy('rank', 'asc'), limit(100));\n            const top100Snapshot = await getDocs(q);\n            const top100Scores = top100Snapshot.docs.map(doc => ({ userId: doc.id, ...(doc.data() as Omit<UserScore, 'userId'>) }));\n            setLeaderboard(top100Scores);\n            \n            if (user) {\n                const userScoreRef = doc(db, 'leaderboard', user.uid);\n                const userScoreSnap = await getDoc(userScoreRef);\n                if (userScoreSnap.exists()) {\n                    setCurrentUserScore({ userId: user.uid, ...userScoreSnap.data() } as UserScore);\n                } else {\n                    setCurrentUserScore(null);\n                }\n            }\n        } catch (error) {\n            console.error(\"Error fetching leaderboard:\", error);\n            if (error instanceof Error && error.message.includes('permission-denied')) {\n                errorEmitter.emit('permission-error', new FirestorePermissionError({ path: 'leaderboard', operation: 'list' }));\n            }\n        } finally {\n            setLoadingLeaderboard(false);\n        }\n    }, [db, user]);\n\n    useEffect(() => {\n        if (mainTab === 'leaderboard') {\n            fetchLeaderboard();\n        }\n    }, [mainTab, fetchLeaderboard]);\n\n    const handleSavePrediction = useCallback(async (fixtureId: number, homeGoalsStr: string, awayGoalsStr: string) => {\n        if (!user || homeGoalsStr === '' || awayGoalsStr === '' || !db) return;\n        \n        // This is where the UI values are received. homeGoalsStr is from the home team's input field.\n        const homePrediction = parseInt(homeGoalsStr, 10);\n        const awayPrediction = parseInt(awayGoalsStr, 10);\n\n        if (isNaN(homePrediction) || isNaN(awayPrediction)) return;\n    \n        const predictionRef = doc(db, 'predictionFixtures', String(fixtureId), 'userPredictions', user.uid);\n        \n        // As per the requirement, we store the predictions swapped because of the UI layout.\n        const predictionData: Prediction = {\n            userId: user.uid,\n            fixtureId,\n            homeGoals: awayPrediction, // Away team's prediction goes into homeGoals\n            awayGoals: homePrediction, // Home team's prediction goes into awayGoals\n            points: allUserPredictions[String(fixtureId)]?.points || 0,\n            timestamp: new Date().toISOString()\n        };\n        \n        try {\n            await setDoc(predictionRef, predictionData, { merge: true });\n        } catch (serverError) {\n             const permissionError = new FirestorePermissionError({\n                path: predictionRef.path,\n                operation: 'write',\n                requestResourceData: predictionData\n            });\n            errorEmitter.emit('permission-error', permissionError);\n        }\n    }, [user, db, allUserPredictions]);\n\n   const handleCalculateAllPoints = useCallback(async () => {\n        if (!db || !isAdmin) return;\n        setIsUpdatingPoints(true);\n        toast({ title: \"بدء تحديث النقاط...\", description: \"قد تستغرق هذه العملية بضع لحظات.\" });\n\n        try {\n            const pinnedFixturesSnapshot = await getDocs(collection(db, \"predictionFixtures\"));\n            if (pinnedFixturesSnapshot.empty) {\n                toast({ title: 'لا توجد مباريات', description: 'لا توجد مباريات مثبتة لاحتساب نقاطها.' });\n                setIsUpdatingPoints(false);\n                return;\n            }\n\n            const fixtureIds = pinnedFixturesSnapshot.docs.map(doc => doc.id);\n            const apiFixturePromises = fixtureIds.map(id => fetch(`https://${API_FOOTBALL_HOST}/fixtures?id=${id}`, {\n                headers: {\n                    'x-rapidapi-host': API_FOOTBALL_HOST,\n                    'x-rapidapi-key': API_KEY || '',\n                },\n            }).then(res => res.json()));\n            const apiFixtureResults = await Promise.all(apiFixturePromises);\n            \n            const liveFixturesMap = new Map<number, Fixture>();\n            apiFixtureResults.forEach(result => {\n                const fixture = result.response?.[0];\n                if (fixture) {\n                    liveFixturesMap.set(fixture.fixture.id, fixture);\n                }\n            });\n\n            const finishedFixtures = Array.from(liveFixturesMap.values()).filter(f => ['FT', 'AET', 'PEN'].includes(f.fixture.status.short));\n            if (finishedFixtures.length === 0) {\n                toast({ title: 'لا توجد مباريات منتهية', description: 'لم تنته أي من المباريات المثبتة بعد.' });\n                setIsUpdatingPoints(false);\n                return;\n            }\n\n            const pointsUpdateBatch = writeBatch(db);\n            const locallyUpdatedUserPredictions: { [key: string]: Partial<Prediction> } = {};\n\n            for (const fixture of finishedFixtures) {\n                const userPredictionsSnapshot = await getDocs(collection(db, \"predictionFixtures\", String(fixture.fixture.id), \"userPredictions\"));\n                userPredictionsSnapshot.forEach(predDoc => {\n                    const pred = predDoc.data() as Prediction;\n                    const newPoints = calculatePoints(pred, fixture);\n                    if (pred.points !== newPoints) {\n                        pointsUpdateBatch.update(predDoc.ref, { points: newPoints });\n                        if (pred.userId === user?.uid) {\n                            locallyUpdatedUserPredictions[String(fixture.fixture.id)] = { ...pred, points: newPoints };\n                        }\n                    }\n                });\n            }\n            \n            await pointsUpdateBatch.commit();\n            \n            if (user && Object.keys(locallyUpdatedUserPredictions).length > 0) {\n                 setAllUserPredictions(prev => ({ ...prev, ...locallyUpdatedUserPredictions as { [key: string]: Prediction } }));\n            }\n            \n            toast({ title: \"تم تحديث نقاط التوقعات\", description: \"جاري الآن تحديث لوحة الصدارة.\" });\n\n            const userPoints = new Map<string, number>();\n            for (const fixtureDoc of pinnedFixturesSnapshot.docs) {\n                const userPredictionsSnapshot = await getDocs(collection(db, 'predictionFixtures', fixtureDoc.id, 'userPredictions'));\n                userPredictionsSnapshot.forEach(predDoc => {\n                    const pred = predDoc.data() as Prediction;\n                    if (pred.userId && typeof pred.points === 'number') {\n                        userPoints.set(pred.userId, (userPoints.get(pred.userId) || 0) + pred.points);\n                    }\n                });\n            }\n\n            const userProfiles = new Map<string, UserProfile>();\n            if (userPoints.size > 0) {\n                const allUserIds = Array.from(userPoints.keys());\n                 for (let i = 0; i < allUserIds.length; i += 30) {\n                    const batchIds = allUserIds.slice(i, i + 30);\n                    if (batchIds.length > 0) {\n                        const usersQuery = query(collection(db, \"users\"), where('__name__', 'in', batchIds));\n                        const usersSnapshot = await getDocs(usersQuery);\n                        usersSnapshot.forEach(doc => userProfiles.set(doc.id, doc.data() as UserProfile));\n                    }\n                }\n            }\n\n            const leaderboardBatch = writeBatch(db);\n            const oldLeaderboardSnapshot = await getDocs(collection(db, \"leaderboard\"));\n            oldLeaderboardSnapshot.forEach(doc => {\n                if (!userPoints.has(doc.id)) {\n                    leaderboardBatch.delete(doc.ref);\n                }\n            });\n\n            const sortedUsers = Array.from(userPoints.entries())\n                .filter(([userId]) => userProfiles.has(userId))\n                .sort((a, b) => b[1] - a[1]);\n\n            let rank = 1;\n            for (const [userId, totalPoints] of sortedUsers) {\n                const userData = userProfiles.get(userId)!;\n                leaderboardBatch.set(doc(db, \"leaderboard\", userId), {\n                    totalPoints,\n                    userName: userData.displayName || `مستخدم_${userId.substring(0, 4)}`,\n                    userPhoto: userData.photoURL || '',\n                    rank,\n                }, { merge: true });\n                rank++;\n            }\n            \n            await leaderboardBatch.commit();\n            toast({ title: \"اكتمل التحديث!\", description: \"تم تحديث لوحة الصدارة بنجاح.\" });\n            await fetchLeaderboard();\n\n        } catch (error) {\n            console.error(\"Error calculating all points:\", error);\n            if (error instanceof Error) {\n                toast({ variant: 'destructive', title: \"خطأ فادح\", description: error.message || \"حدث خطأ أثناء تحديث لوحة الصدارة.\" });\n            }\n        } finally {\n            setIsUpdatingPoints(false);\n        }\n    }, [db, isAdmin, toast, fetchLeaderboard, user?.uid]);\n\n\n    const filteredMatches = useMemo(() => {\n        return pinnedMatches.filter(match => {\n            if (!match.fixtureData || !match.fixtureData.fixture) return false;\n            const matchDateKey = format(new Date(match.fixtureData.fixture.timestamp * 1000), 'yyyy-MM-dd');\n            return matchDateKey === selectedDateKey;\n        }).sort((a,b) => a.fixtureData.fixture.timestamp - b.fixtureData.fixture.timestamp);\n    }, [pinnedMatches, selectedDateKey]);\n\n    const popularItemsForSearch = useMemo((): SearchableItem[] => {\n        if (!customNames) return [];\n        const seen = new Set<string>();\n        \n        return [...POPULAR_TEAMS, ...POPULAR_LEAGUES].map(item => {\n            const type = 'national' in item || 'type' in item ? 'teams' : 'leagues';\n            const key = `${type}-${item.id}`;\n            if (seen.has(key)) return null;\n            seen.add(key);\n    \n            return {\n                id: item.id,\n                type: type as 'teams' | 'leagues',\n                name: getDisplayName(type.slice(0, -1) as 'team' | 'league', item.id, item.name),\n                originalName: item.name,\n                logo: item.logo,\n                originalItem: item as any,\n            };\n        }).filter(Boolean) as SearchableItem[];\n    }, [customNames, getDisplayName]);\n\n    return (\n        <div className=\"flex h-full flex-col bg-background\">\n            <ScreenHeader\n                title=\"التوقعات\"\n                onBack={goBack}\n                canGoBack={canGoBack}\n                actions={\n                  <div className=\"flex items-center gap-1\">\n                      <SearchSheet navigate={navigate} favorites={favorites} customNames={customNames} setFavorites={setFavorites} popularItems={popularItemsForSearch}>\n                          <Button variant=\"ghost\" size=\"icon\">\n                              <Search className=\"h-5 w-5\" />\n                          </Button>\n                      </SearchSheet>\n                      <ProfileButton />\n                  </div>\n                }\n              />\n             <Tabs value={mainTab} onValueChange={setMainTab} className=\"w-full flex-1 flex flex-col min-h-0\">\n               <TabsList className=\"grid w-full grid-cols-2\">\n                   <TabsTrigger value=\"leaderboard\"><BarChart className=\"ml-2 h-4 w-4\" />الترتيب</TabsTrigger>\n                   <TabsTrigger value=\"voting\"><ThumbsUp className=\"ml-2 h-4 w-4\" />تصويت</TabsTrigger>\n               </TabsList>\n               \n               <TabsContent value=\"voting\" className=\"flex-1 flex flex-col mt-0 data-[state=inactive]:hidden min-h-0\">\n                    <DateScroller selectedDateKey={selectedDateKey} onDateSelect={setSelectedDateKey} />\n                    <div className=\"flex-1 overflow-y-auto p-1 space-y-4 pt-4\">\n                        {loadingMatches || isCheckingAdmin || loadingUserPredictions ? (\n                            <div className=\"flex justify-center p-8\"><Loader2 className=\"h-6 w-6 animate-spin\" /></div>\n                        ) : !user ? (\n                            <div className=\"text-center text-muted-foreground pt-10\">\n                                <p>ميزة التوقعات متاحة للمستخدمين المسجلين.</p>\n                                <Button onClick={() => navigate('Welcome')} className=\"mt-4\">تسجيل الدخول</Button>\n                             </div>\n                        ) : filteredMatches.length > 0 ? (\n                            filteredMatches.map(match => (\n                                <PredictionCard \n                                    key={match.id}\n                                    predictionMatch={match}\n                                    userPrediction={allUserPredictions[match.id!]}\n                                    onSave={handleSavePrediction}\n                                />\n                            ))\n                        ) : (\n                            <div className=\"text-center text-muted-foreground pt-10\">\n                                <p>لا توجد مباريات للتوقع في هذا اليوم.</p>\n                                {isAdmin && <p className=\"text-xs\">يمكنك تثبيت مباريات من شاشة المباريات.</p>}\n                            </div>\n                        )}\n                    </div>\n               </TabsContent>\n    \n               <TabsContent value=\"leaderboard\" className=\"mt-4 flex-1 overflow-y-auto\">\n                   <Card>\n                      <CardHeader className=\"flex-row items-center justify-between\">\n                           <CardTitle>لوحة الصدارة</CardTitle>\n                           {isAdmin && (\n                               <Button onClick={handleCalculateAllPoints} disabled={isUpdatingPoints} size=\"sm\">\n                                   {isUpdatingPoints ? <Loader2 className=\"h-4 w-4 animate-spin\"/> : <RefreshCw className=\"h-4 w-4\"/>}\n                                   <span className=\"mr-2\">تحديث النتائج</span>\n                               </Button>\n                           )}\n                      </CardHeader>\n                      <CardContent className=\"p-0\">\n                           <LeaderboardDisplay leaderboard={leaderboard} loadingLeaderboard={loadingLeaderboard} userScore={currentUserScore} userId={user?.uid}/>\n                      </CardContent>\n                   </Card>\n               </TabsContent>\n            </Tabs>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 12309, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/FavoriteSelectionScreen.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { NabdAlMalaebLogo } from '@/components/icons/NabdAlMalaebLogo';\nimport { useAuth, useFirestore } from '@/firebase/provider';\nimport { doc, setDoc, updateDoc, deleteField } from 'firebase/firestore';\nimport type { Favorites } from '@/lib/types';\nimport { POPULAR_TEAMS, POPULAR_LEAGUES } from '@/lib/popular-data';\nimport { Star, Check } from 'lucide-react';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { cn } from '@/lib/utils';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { getLocalFavorites, clearLocalFavorites, setLocalFavorites } from '@/lib/local-favorites';\n\ninterface FavoriteSelectionScreenProps {\n  onOnboardingComplete: () => void;\n}\n\nconst ItemGrid = ({ items, onSelect, selectedIds, itemType }: { items: any[], onSelect: (item: any) => void, selectedIds: Set<number>, itemType: 'team' | 'league' }) => {\n  return (\n    <div className=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4\">\n      {items.map(item => (\n        <div \n          key={item.id} \n          className=\"relative flex flex-col items-center justify-start gap-1 text-center cursor-pointer h-[88px]\"\n          onClick={() => onSelect(item)}\n        >\n          <Avatar className={cn(\"h-14 w-14 border-2 border-transparent transition-all\", selectedIds.has(item.id) && 'border-primary')}>\n            <AvatarImage src={item.logo} alt={item.name} className={cn(itemType === 'league' && 'object-contain p-1')} />\n            <AvatarFallback>{item.name.charAt(0)}</AvatarFallback>\n          </Avatar>\n          <span className=\"text-[11px] font-medium truncate w-full\">{item.name}</span>\n          {selectedIds.has(item.id) && (\n            <div className=\"absolute top-0 right-0 h-5 w-5 bg-primary rounded-full flex items-center justify-center border-2 border-background\">\n              <Check className=\"h-3 w-3 text-primary-foreground\" />\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n\n\nexport function FavoriteSelectionScreen({ onOnboardingComplete }: FavoriteSelectionScreenProps) {\n  const { user } = useAuth();\n  const { db } = useFirestore();\n  const [selectedTeams, setSelectedTeams] = useState<Set<number>>(new Set());\n  const [selectedLeagues, setSelectedLeagues] = useState<Set<number>>(new Set());\n\n  // Al Nassr's ID is 605, preset it as a default selection\n  const AL_NASSR_ID = 605;\n\n  useEffect(() => {\n    const localFavs = getLocalFavorites();\n    const initialTeams = new Set<number>([AL_NASSR_ID]);\n    \n    if (localFavs.teams) {\n      Object.keys(localFavs.teams).map(Number).forEach(id => initialTeams.add(id));\n    }\n    setSelectedTeams(initialTeams);\n\n    const initialLeagues = new Set<number>();\n    if (localFavs.leagues) {\n      Object.keys(localFavs.leagues).map(Number).forEach(id => initialLeagues.add(id));\n    }\n    setSelectedLeagues(initialLeagues);\n\n  }, []);\n\n  const handleSelect = useCallback((item: any, type: 'team' | 'league') => {\n    const updater = type === 'team' ? setSelectedTeams : setSelectedLeagues;\n    updater(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(item.id)) {\n        newSet.delete(item.id);\n      } else {\n        newSet.add(item.id);\n      }\n      return newSet;\n    });\n  }, []);\n  \n  const handleContinue = async () => {\n    const favoritesToSave: Partial<Favorites> = {\n        teams: {},\n        leagues: {}\n    };\n\n    POPULAR_TEAMS.forEach(team => {\n        if (selectedTeams.has(team.id) && favoritesToSave.teams) {\n            favoritesToSave.teams[team.id] = {\n                teamId: team.id,\n                name: team.name,\n                logo: team.logo,\n                type: team.type as 'Club' | 'National',\n            };\n        }\n    });\n\n    POPULAR_LEAGUES.forEach(league => {\n        if (selectedLeagues.has(league.id) && favoritesToSave.leagues) {\n            favoritesToSave.leagues[league.id] = {\n                leagueId: league.id,\n                name: league.name,\n                logo: league.logo,\n            };\n        }\n    });\n    \n    if (user && db) {\n        const favRef = doc(db, 'users', user.uid, 'favorites', 'data');\n        try {\n            await setDoc(favRef, { ...favoritesToSave, userId: user.uid }, { merge: true });\n            clearLocalFavorites();\n        } catch (error) {\n             const permissionError = new FirestorePermissionError({\n                path: favRef.path,\n                operation: 'write',\n                requestResourceData: favoritesToSave\n            });\n            errorEmitter.emit('permission-error', permissionError);\n        }\n    } else {\n        setLocalFavorites(favoritesToSave);\n    }\n    \n    onOnboardingComplete();\n  };\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n        <div className=\"p-4 flex justify-end\">\n            <Button variant=\"ghost\" onClick={onOnboardingComplete}>تخطي</Button>\n        </div>\n        <div className=\"flex-1 flex flex-col items-center p-4 pt-0 text-center\">\n            <NabdAlMalaebLogo className=\"h-16 w-16 mb-4\" />\n            <h1 className=\"text-2xl font-bold mb-2 font-headline\">خصص تجربتك</h1>\n            <p className=\"text-muted-foreground mb-6\">اختر فرقك وبطولاتك المفضلة لتبقى على اطلاع دائم.</p>\n        \n            <Tabs defaultValue=\"teams\" className=\"w-full flex-1 flex flex-col min-h-0\">\n                <TabsList className=\"grid w-full grid-cols-2\">\n                    <TabsTrigger value=\"teams\">الفرق</TabsTrigger>\n                    <TabsTrigger value=\"leagues\">البطولات</TabsTrigger>\n                </TabsList>\n                <ScrollArea className=\"flex-1 mt-4\">\n                    <TabsContent value=\"teams\">\n                        <ItemGrid items={POPULAR_TEAMS} onSelect={(item) => handleSelect(item, 'team')} selectedIds={selectedTeams} itemType=\"team\" />\n                    </TabsContent>\n                    <TabsContent value=\"leagues\">\n                        <ItemGrid items={POPULAR_LEAGUES} onSelect={(item) => handleSelect(item, 'league')} selectedIds={selectedLeagues} itemType=\"league\" />\n                    </TabsContent>\n                </ScrollArea>\n            </Tabs>\n        </div>\n        <div className=\"p-4 border-t sticky bottom-0 bg-background/90 backdrop-blur-sm\">\n             <Button onClick={handleContinue} className=\"w-full\" size=\"lg\">متابعة</Button>\n        </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 12676, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/screens/WelcomeScreen.tsx"],"sourcesContent":["\n\"use client\";\nimport React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { NabdAlMalaebLogo } from '@/components/icons/NabdAlMalaebLogo';\nimport { GoogleIcon } from '@/components/icons/GoogleIcon';\nimport { useFirestore } from '@/firebase';\nimport { useToast } from '@/hooks/use-toast';\nimport { Loader2 } from 'lucide-react';\nimport { handleNewUser } from '@/lib/firebase-client';\nimport { Capacitor } from '@capacitor/core';\nimport { \n  FirebaseAuthentication, \n  SignInWithGoogleResult,\n} from '@capacitor-firebase/authentication';\nimport { getAuth, signInWithCredential, GoogleAuthProvider } from 'firebase/auth';\n\nexport const GUEST_MODE_KEY = 'goalstack_guest_mode_active';\n\nexport function WelcomeScreen() {\n  const { toast } = useToast();\n  const { db } = useFirestore();\n  const [isLoading, setIsLoading] = useState<'google' | 'guest' | false>(false);\n\n  const handleGoogleLogin = async () => {\n    if (!db) {\n        toast({ variant: 'destructive', title: 'خطأ', description: 'خدمة قاعدة البيانات غير متاحة.' });\n        return;\n    }\n    setIsLoading('google');\n    \n    try {\n      const result = await FirebaseAuthentication.signInWithGoogle();\n      const credential = GoogleAuthProvider.credential(result.credential?.idToken);\n      const auth = getAuth();\n      const userCredential = await signInWithCredential(auth, credential);\n      await handleNewUser(userCredential.user, db);\n    } catch (error: any) {\n        console.error(\"Google Sign-In Error\", error);\n        toast({\n            variant: 'destructive',\n            title: 'فشل تسجيل الدخول',\n            description: error.message || 'حدث خطأ أثناء محاولة تسجيل الدخول بحساب جوجل.',\n        });\n    } finally {\n        setIsLoading(false);\n    }\n  };\n\n  const handleGuestLogin = () => {\n    setIsLoading('guest');\n    try {\n        localStorage.setItem(GUEST_MODE_KEY, 'true');\n        window.location.reload();\n    } catch(e: any) {\n        console.error(\"Guest mode error:\", e);\n        toast({\n            variant: 'destructive',\n            title: 'خطأ',\n            description: 'فشل تفعيل وضع الزائر. يرجى المحاولة مرة أخرى.',\n        });\n        setIsLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <div className=\"flex flex-1 flex-col items-center justify-center p-8 text-center\">\n        <NabdAlMalaebLogo className=\"h-24 w-24 mb-4\" />\n        <h1 className=\"text-3xl font-bold mb-2 font-headline text-primary\">أهلاً بك في نبض الملاعب</h1>\n        <p className=\"text-muted-foreground mb-8\">عالم كرة القدم بين يديك. سجل الدخول لمزامنة مفضلاتك، أو تصفح كزائر.</p>\n        \n        <div className=\"w-full max-w-xs space-y-4\">\n            <Button \n              onClick={handleGoogleLogin} \n              className=\"w-full\" \n              size=\"lg\"\n              disabled={!!isLoading}\n            >\n              {isLoading === 'google' ? (\n                <Loader2 className=\"h-5 w-5 animate-spin\" />\n              ) : (\n                <>\n                  <GoogleIcon className=\"h-5 w-5 mr-2\" />\n                  المتابعة باستخدام جوجل\n                </>\n              )}\n            </Button>\n            <Button\n                variant=\"ghost\"\n                onClick={handleGuestLogin}\n                className=\"w-full\"\n                disabled={!!isLoading}\n            >\n               {isLoading === 'guest' ? <Loader2 className=\"h-5 w-5 animate-spin\"/> : 'تصفح كزائر'}\n            </Button>\n        </div>\n\n        <p className=\"mt-8 text-xs text-muted-foreground/80 px-4\">\n          بالاستمرار، أنت توافق على شروط الخدمة و سياسة الخصوصية.\n        </p>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAIA;AAAA;AAAA;AAAA;;;AAdA;;;;;;;;;;;AAgBO,MAAM,iBAAiB;AAEvB,SAAS;;IACd,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,WAAQ,AAAD;IACzB,MAAM,EAAE,EAAE,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,eAAY,AAAD;IAC1B,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAA8B;IAEvE,MAAM,oBAAoB;QACxB,IAAI,CAAC,IAAI;YACL,MAAM;gBAAE,SAAS;gBAAe,OAAO;gBAAO,aAAa;YAAiC;YAC5F;QACJ;QACA,aAAa;QAEb,IAAI;YACF,MAAM,SAAS,MAAM,oMAAA,CAAA,yBAAsB,CAAC,gBAAgB;YAC5D,MAAM,aAAa,oPAAA,CAAA,qBAAkB,CAAC,UAAU,CAAC,OAAO,UAAU,EAAE;YACpE,MAAM,OAAO,CAAA,GAAA,yOAAA,CAAA,UAAO,AAAD;YACnB,MAAM,iBAAiB,MAAM,CAAA,GAAA,uPAAA,CAAA,uBAAoB,AAAD,EAAE,MAAM;YACxD,MAAM,CAAA,GAAA,mIAAA,CAAA,gBAAa,AAAD,EAAE,eAAe,IAAI,EAAE;QAC3C,EAAE,OAAO,OAAY;YACjB,QAAQ,KAAK,CAAC,wBAAwB;YACtC,MAAM;gBACF,SAAS;gBACT,OAAO;gBACP,aAAa,MAAM,OAAO,IAAI;YAClC;QACJ,SAAU;YACN,aAAa;QACjB;IACF;IAEA,MAAM,mBAAmB;QACvB,aAAa;QACb,IAAI;YACA,aAAa,OAAO,CAAC,gBAAgB;YACrC,OAAO,QAAQ,CAAC,MAAM;QAC1B,EAAE,OAAM,GAAQ;YACZ,QAAQ,KAAK,CAAC,qBAAqB;YACnC,MAAM;gBACF,SAAS;gBACT,OAAO;gBACP,aAAa;YACjB;YACA,aAAa;QACjB;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC,kJAAA,CAAA,mBAAgB;oBAAC,WAAU;;;;;;8BAC5B,6LAAC;oBAAG,WAAU;8BAAqD;;;;;;8BACnE,6LAAC;oBAAE,WAAU;8BAA6B;;;;;;8BAE1C,6LAAC;oBAAI,WAAU;;sCACX,6LAAC,qIAAA,CAAA,SAAM;4BACL,SAAS;4BACT,WAAU;4BACV,MAAK;4BACL,UAAU,CAAC,CAAC;sCAEX,cAAc,yBACb,6LAAC,oNAAA,CAAA,UAAO;gCAAC,WAAU;;;;;qDAEnB;;kDACE,6LAAC,4IAAA,CAAA,aAAU;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;;sCAK7C,6LAAC,qIAAA,CAAA,SAAM;4BACH,SAAQ;4BACR,SAAS;4BACT,WAAU;4BACV,UAAU,CAAC,CAAC;sCAEZ,cAAc,wBAAU,6LAAC,oNAAA,CAAA,UAAO;gCAAC,WAAU;;;;;uCAA2B;;;;;;;;;;;;8BAI9E,6LAAC;oBAAE,WAAU;8BAA6C;;;;;;;;;;;;;;;;;AAMlE;GArFgB;;QACI,+HAAA,CAAA,WAAQ;QACX,+HAAA,CAAA,eAAY;;;KAFb","debugId":null}}]
}